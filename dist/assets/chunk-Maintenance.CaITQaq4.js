import{_ as e,u as l,d as a,b as t,M as s}from"./entry-index.D92NaooR.js";import{e as i,f as d,g as n,at as u,aa as o,k as r,V as c,j as v,v as m,o as p,z as _,A as f,S as y,w as g,q as h,r as k,a0 as w,$ as b,_ as x,T as V,af as $,W as I,Z as D,ab as C,h as S,l as U}from"./chunk-vue-core.CxEQweee.js";import{d as z,ae as M,ac as q,ad as T,H as j,a4 as A,ab as B,F,ag as O,K as Y,X as E,J as R,r as N,w as P,N as J}from"./chunk-vendors.D0_dqILu.js";import{_ as L}from"./chunk-MetricsDialog.CtvwZDTF.js";import"./chunk-utils-vendor.DVew6AbD.js";import"./chunk-chart-core.HkgdsJMe.js";const W=e({__name:"MaintenanceCalendar",props:{selectedDate:{type:String,required:!0},selectedMonth:{type:Number,required:!0},tasks:{type:Array,default:()=>[]}},emits:["update:selectedDate","update:selectedMonth"],setup(e,{emit:l}){const a=e,t=l,s=z({get:()=>a.selectedMonth,set:e=>t("update:selectedMonth",e)}),v=[{title:"1月",value:1},{title:"2月",value:2},{title:"3月",value:3},{title:"4月",value:4},{title:"5月",value:5},{title:"6月",value:6},{title:"7月",value:7},{title:"8月",value:8},{title:"9月",value:9},{title:"10月",value:10},{title:"11月",value:11},{title:"12月",value:12}],m=z((()=>{const e=(new Date).getFullYear();return new Date(e,s.value,0).getDate()})),p=z((()=>{const e=(new Date).getFullYear();return new Date(e,s.value-1,1).getDay()})),_=e=>{if(!a.selectedDate)return!1;try{const l=a.selectedDate.split("-");if(3!==l.length)return!1;const t=parseInt(l[2]),i=parseInt(l[1]);return e===t&&s.value===i}catch(l){return!1}},f=e=>{const l=`${(new Date).getFullYear()}-${s.value.toString().padStart(2,"0")}-${e.toString().padStart(2,"0")}`;return a.tasks.some((e=>e.date===l))};return(e,l)=>(q(),M(c,{class:"elevation-2",style:{height:"100%"}},{default:T((()=>[j(i,{class:"d-flex align-center"},{default:T((()=>[j(d,{class:"mr-2"},{default:T((()=>l[1]||(l[1]=[A(" mdi-calendar ")]))),_:1,__:[1]}),l[2]||(l[2]=A(" 设备维修日历 "))])),_:1,__:[2]}),j(n,null,{default:T((()=>[j(u,{class:"mb-4"},{default:T((()=>[j(o,{modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=e=>s.value=e),items:v,label:"选择月份",variant:"outlined",density:"compact","hide-details":"",class:"mb-4"},null,8,["modelValue"]),j(u,{class:"calendar-grid"},{default:T((()=>[(q(),B(F,null,O(["日","一","二","三","四","五","六"],(e=>Y("div",{key:e,class:"calendar-header"},E(e),1))),64)),(q(!0),B(F,null,O(p.value,(e=>(q(),B("div",{key:`empty-${e}`,class:"calendar-day empty"})))),128)),(q(!0),B(F,null,O(m.value,(e=>(q(),M(r,{key:e,color:_(e)?"primary":f(e)?"info":"",variant:_(e)?"flat":f(e)?"outlined":"text",class:"calendar-day-btn",size:"small",width:"36",height:"36",onClick:l=>(e=>{const l=(new Date).getFullYear(),a=s.value.toString().padStart(2,"0"),i=e.toString().padStart(2,"0");t("update:selectedDate",`${l}-${a}-${i}`)})(e)},{default:T((()=>[A(E(e),1)])),_:2},1032,["color","variant","onClick"])))),128))])),_:1})])),_:1}),j(u,{class:"mt-4 d-flex justify-space-between align-center"},{default:T((()=>l[3]||(l[3]=[Y("div",null,[Y("span",{class:"text-subtitle-1"},"MTTR: "),Y("span",{class:"text-h6 font-weight-bold"},"3.2"),Y("span",{class:"text-caption ml-1"},"小时")],-1),Y("div",null,[Y("span",{class:"text-subtitle-1"},"MTBF: "),Y("span",{class:"text-h6 font-weight-bold"},"278.5"),Y("span",{class:"text-caption ml-1"},"小时")],-1)]))),_:1,__:[3]})])),_:1})])),_:1}))}},[["__scopeId","data-v-644a39c5"]]),H={class:"text-white"},K={class:"d-flex justify-space-between"},X={class:"text-center"},Z={class:"text-h5 font-weight-bold"},G={class:"text-center"},Q={class:"text-h5 font-weight-bold"},ee={class:"d-flex align-center"},le=e({__name:"DailyTasksList",props:{tasks:{type:Array,required:!0},loading:{type:Boolean,default:!1},date:{type:String,required:!0}},emits:["add-task","edit-task","delete-task","update-status"],setup(e){const l=e,a=z((()=>l.tasks.filter((e=>e.solved)).length)),t=z((()=>0===l.tasks.length?0:Math.round(a.value/l.tasks.length*100)));z((()=>2*l.tasks.length));const s=e=>{if(!e)return"";const l=new Date(e);return`${l.getFullYear()}年${l.getMonth()+1}月${l.getDate()}日`},u=e=>{const l=[{value:1,label:"定期维护"},{value:2,label:"设备调试"},{value:3,label:"故障维修"},{value:4,label:"备件更换"},{value:5,label:"预防性维护"}].find((l=>l.value===parseInt(e)));return l?l.label:"未知类型"},o=e=>{switch(parseInt(e)){case 1:return"primary";case 2:return"info";case 3:return"error";case 4:return"warning";case 5:return"success";default:return"grey"}};return(l,V)=>(q(),M(c,{class:"elevation-2 maintenance-card h-100"},{default:T((()=>[j(i,{class:"d-flex align-center"},{default:T((()=>[j(d,{class:"mr-2"},{default:T((()=>V[2]||(V[2]=[A(" mdi-clipboard-text ")]))),_:1,__:[2]}),A(" "+E(s(e.date))+" 维修工作 ",1),j(v),j(r,{color:"primary","prepend-icon":"mdi-plus",size:"small",onClick:V[0]||(V[0]=e=>l.$emit("add-task"))},{default:T((()=>V[3]||(V[3]=[A(" 添加工作 ")]))),_:1,__:[3]})])),_:1}),j(m),e.loading?(q(),M(n,{key:0,class:"text-center py-8"},{default:T((()=>[j(p,{indeterminate:"",color:"primary",size:"64"}),V[4]||(V[4]=Y("div",{class:"mt-4 text-subtitle-1"}," 加载中... ",-1))])),_:1,__:[4]})):e.tasks.length>0?(q(),M(n,{key:1,class:"pt-4"},{default:T((()=>[j(_,null,{default:T((()=>[j(f,{cols:"12",md:"6"},{default:T((()=>[V[5]||(V[5]=Y("div",{class:"text-subtitle-1 font-weight-medium"}," 今日工作完成情况 ",-1)),j(y,{"model-value":t.value,color:"success",height:"20",class:"mt-2"},{default:T((()=>[Y("span",H,E(t.value)+"%",1)])),_:1},8,["model-value"])])),_:1,__:[5]}),j(f,{cols:"12",md:"6"},{default:T((()=>[Y("div",K,[Y("div",X,[Y("div",Z,E(e.tasks.length),1),V[6]||(V[6]=Y("div",{class:"text-caption"}," 总任务数 ",-1))]),Y("div",G,[Y("div",Q,E(a.value),1),V[7]||(V[7]=Y("div",{class:"text-caption"}," 已完成 ",-1))])])])),_:1})])),_:1}),j(g,{class:"mt-4 task-list"},{default:T((()=>[(q(!0),B(F,null,O(e.tasks,((e,a)=>(q(),M(h,{key:a,class:R([{"completed-task":e.solved},"task-item"])},{prepend:T((()=>[j(x,{modelValue:e.solved,"onUpdate:modelValue":l=>e.solved=l,density:"compact",onChange:a=>l.$emit("update-status",e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),append:T((()=>[Y("div",ee,[j(r,{icon:"mdi-pencil",variant:"text",size:"small",onClick:a=>l.$emit("edit-task",e)},null,8,["onClick"]),j(r,{icon:"mdi-delete",variant:"text",size:"small",onClick:a=>l.$emit("delete-task",e)},null,8,["onClick"])])])),default:T((()=>[j(k,{class:R({"text-decoration-line-through":e.solved})},{default:T((()=>[A(E(e.title),1)])),_:2},1032,["class"]),j(w,null,{default:T((()=>[j(b,{color:o(e.type),size:"small",class:"mr-2","text-color":"white"},{default:T((()=>[A(E(u(e.type)),1)])),_:2},1032,["color"]),Y("span",null,E(e.wheres),1)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1})])),_:1})):(q(),M(n,{key:2,class:"text-center py-8"},{default:T((()=>[j(d,{size:"64",color:"grey-lighten-1"},{default:T((()=>V[8]||(V[8]=[A(" mdi-calendar-blank ")]))),_:1,__:[8]}),V[10]||(V[10]=Y("div",{class:"mt-4 text-subtitle-1 text-grey"}," 当天没有维修任务 ",-1)),j(r,{color:"primary",class:"mt-4","prepend-icon":"mdi-plus",onClick:V[1]||(V[1]=e=>l.$emit("add-task"))},{default:T((()=>V[9]||(V[9]=[A(" 添加工作 ")]))),_:1,__:[9]})])),_:1,__:[10]}))])),_:1}))}},[["__scopeId","data-v-3590b777"]]),ae={class:"text-center py-4"},te={__name:"WeeklyPlan",props:{tasks:{type:Array,required:!0}},emits:["export"],setup(e){const l=N([{title:"日期",key:"date",align:"start"},{title:"设备",key:"wheres",align:"start"},{title:"工作内容",key:"content_daily",align:"start"},{title:"类型",key:"type",align:"center"},{title:"状态",key:"solved",align:"center"}]),a=e=>{if(!e)return"";const l=new Date(e);return`${l.getMonth()+1}月${l.getDate()}日`},t=e=>{const l=[{value:1,label:"定期维护"},{value:2,label:"设备调试"},{value:3,label:"故障维修"},{value:4,label:"备件更换"},{value:5,label:"预防性维护"}].find((l=>l.value===parseInt(e)));return l?l.label:"未知类型"},s=e=>{switch(parseInt(e)){case 1:return"primary";case 2:return"info";case 3:return"error";case 4:return"warning";case 5:return"success";default:return"grey"}};return(n,u)=>(q(),M(c,{class:"h-100 elevation-2"},{default:T((()=>[j(i,{class:"d-flex align-center"},{default:T((()=>[j(d,{class:"mr-2"},{default:T((()=>u[1]||(u[1]=[A(" mdi-calendar-week ")]))),_:1,__:[1]}),u[3]||(u[3]=A(" 本周维修计划 ")),j(v),j(r,{color:"success",size:"small","prepend-icon":"mdi-file-export",onClick:u[0]||(u[0]=e=>n.$emit("export"))},{default:T((()=>u[2]||(u[2]=[A(" 导出 ")]))),_:1,__:[2]})])),_:1,__:[3]}),j(m),j(V,{headers:l.value,items:e.tasks,class:"elevation-0",density:"compact"},{"item.date":T((({item:e})=>[A(E(a(e.date)),1)])),"item.type":T((({item:e})=>[j(b,{color:s(e.type),size:"small","text-color":"white"},{default:T((()=>[A(E(t(e.type)),1)])),_:2},1032,["color"])])),"item.solved":T((({item:e})=>[j(d,{color:e.solved?"success":"grey"},{default:T((()=>[A(E(e.solved?"mdi-check-circle":"mdi-clock-outline"),1)])),_:2},1032,["color"])])),"no-data":T((()=>[Y("div",ae,[j(d,{size:"40",color:"grey-lighten-1"},{default:T((()=>u[4]||(u[4]=[A(" mdi-calendar-blank ")]))),_:1,__:[4]}),u[5]||(u[5]=Y("div",{class:"mt-2 text-body-2 text-grey"}," 本周没有维修计划 ",-1))])])),_:1},8,["headers","items"])])),_:1}))}},se={class:"d-flex align-center mb-3"},ie={class:"text-caption"},de={class:"d-flex align-center"},ne=e({__name:"IssuesList",props:{issues:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["add-issue","edit-issue","delete-issue","toggle-status"],setup(e){const l=e,a=N("all"),t=z((()=>"all"===a.value?l.issues:"open"===a.value?l.issues.filter((e=>!e.resolved)):"resolved"===a.value?l.issues.filter((e=>e.resolved)):l.issues)),s=z((()=>l.issues.filter((e=>!e.resolved)).length)),u=z((()=>l.issues.filter((e=>e.resolved)).length)),o=e=>{if(!e)return"";const l=new Date(e);return`${l.getMonth()+1}月${l.getDate()}日`},_=e=>{switch(e){case"严重":return"error";case"中等":return"warning";case"轻微":return"info";default:return"grey"}};return(l,f)=>(q(),M(c,{class:"h-100 elevation-2"},{default:T((()=>[j(i,{class:"d-flex align-center"},{default:T((()=>[j(d,{class:"mr-2",color:"error"},{default:T((()=>f[5]||(f[5]=[A(" mdi-alert-circle ")]))),_:1,__:[5]}),f[7]||(f[7]=A(" 问题记录 ")),j(v),j(r,{color:"error",size:"small",variant:"flat","prepend-icon":"mdi-plus-circle",onClick:f[0]||(f[0]=e=>l.$emit("add-issue"))},{default:T((()=>f[6]||(f[6]=[A(" 记录问题 ")]))),_:1,__:[6]})])),_:1,__:[7]}),j(m),e.loading?(q(),M(n,{key:0,class:"text-center py-8"},{default:T((()=>[j(p,{indeterminate:"",color:"primary",size:"64"}),f[8]||(f[8]=Y("div",{class:"mt-4 text-subtitle-1"}," 加载中... ",-1))])),_:1,__:[8]})):e.issues.length>0?(q(),M(n,{key:1,class:"pa-2 issues-container"},{default:T((()=>[Y("div",se,[j($,null,{default:T((()=>[j(b,{variant:"outlined",size:"small",color:"all"===a.value?"primary":"",onClick:f[1]||(f[1]=e=>a.value="all")},{default:T((()=>[A(" 全部 ("+E(e.issues.length)+") ",1)])),_:1},8,["color"]),j(b,{variant:"outlined",size:"small",color:"open"===a.value?"error":"",onClick:f[2]||(f[2]=e=>a.value="open")},{default:T((()=>[A(" 未解决 ("+E(s.value)+") ",1)])),_:1},8,["color"]),j(b,{variant:"outlined",size:"small",color:"resolved"===a.value?"success":"",onClick:f[3]||(f[3]=e=>a.value="resolved")},{default:T((()=>[A(" 已解决 ("+E(u.value)+") ",1)])),_:1},8,["color"])])),_:1})]),j(g,{density:"compact"},{default:T((()=>[(q(!0),B(F,null,O(t.value,((e,a)=>(q(),M(h,{key:a,class:R([{"issue-resolved":e.resolved},"mb-2 rounded issue-item"])},{prepend:T((()=>[j(d,{color:e.resolved?"success":"error",size:"24"},{default:T((()=>[A(E(e.resolved?"mdi-check-circle":"mdi-alert-circle"),1)])),_:2},1032,["color"])])),append:T((()=>[Y("div",de,[j(r,{color:e.resolved?"error":"success",icon:"",variant:"text",size:"small",class:"mr-1",onClick:a=>l.$emit("toggle-status",e)},{default:T((()=>[j(d,null,{default:T((()=>[A(E(e.resolved?"mdi-close-circle":"mdi-check-circle"),1)])),_:2},1024)])),_:2},1032,["color","onClick"]),j(r,{icon:"mdi-pencil",variant:"text",size:"small",onClick:a=>l.$emit("edit-issue",e)},null,8,["onClick"]),j(r,{icon:"mdi-delete",variant:"text",size:"small",onClick:a=>l.$emit("delete-issue",e)},null,8,["onClick"])])])),default:T((()=>[j(k,{class:R([{"text-decoration-line-through":e.resolved},"font-weight-medium"])},{default:T((()=>[A(E(e.description),1)])),_:2},1032,["class"]),j(w,{class:"mt-1"},{default:T((()=>[j(b,{color:_(e.severity),size:"x-small",class:"mr-2","text-color":"white"},{default:T((()=>[A(E(e.severity),1)])),_:2},1032,["color"]),Y("span",ie,E(o(e.date)),1)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1})])),_:1})):(q(),M(n,{key:2,class:"text-center py-8"},{default:T((()=>[j(d,{size:"64",color:"grey-lighten-1"},{default:T((()=>f[9]||(f[9]=[A(" mdi-clipboard-check-outline ")]))),_:1,__:[9]}),f[11]||(f[11]=Y("div",{class:"mt-4 text-subtitle-1 text-grey"}," 暂无问题记录 ",-1)),j(r,{color:"error",class:"mt-4",variant:"flat","prepend-icon":"mdi-plus-circle",onClick:f[4]||(f[4]=e=>l.$emit("add-issue"))},{default:T((()=>f[10]||(f[10]=[A(" 记录问题 ")]))),_:1,__:[10]})])),_:1,__:[11]}))])),_:1}))}},[["__scopeId","data-v-39ac7cb6"]]),ue={class:"text-h5"},oe={__name:"TaskDialog",props:{modelValue:{type:Boolean,required:!0},task:{type:Object,required:!0},isNew:{type:Boolean,default:!0},loading:{type:Boolean,default:!1}},emits:["update:modelValue","update:task","save","close"],setup(e,{emit:l}){const a=e,t=l,s=N(null),d=z({get:()=>a.task,set:e=>t("update:task",e)}),u=[{value:1,label:"定期维护"},{value:2,label:"设备调试"},{value:3,label:"故障维修"},{value:4,label:"备件更换"},{value:5,label:"预防性维护"}],m=async()=>{var e;const l=await(null==(e=s.value)?void 0:e.validate());(null==l?void 0:l.valid)&&t("save")};return P((()=>a.modelValue),(e=>{e&&setTimeout((()=>{var e;null==(e=s.value)||e.resetValidation()}),50)})),(l,a)=>(q(),M(U,{"model-value":e.modelValue,"max-width":"600px","onUpdate:modelValue":a[6]||(a[6]=e=>l.$emit("update:modelValue",e))},{default:T((()=>[j(c,null,{default:T((()=>[j(i,null,{default:T((()=>[Y("span",ue,E(e.isNew?"创建新任务":"编辑任务"),1)])),_:1}),j(n,null,{default:T((()=>[j(I,{ref_key:"formRef",ref:s},{default:T((()=>[j(D,{modelValue:d.value.title,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value.title=e),label:"任务标题",variant:"outlined",class:"mb-4",rules:[e=>!!e||"请输入任务标题"]},null,8,["modelValue","rules"]),j(D,{modelValue:d.value.wheres,"onUpdate:modelValue":a[1]||(a[1]=e=>d.value.wheres=e),label:"设备/位置",variant:"outlined",class:"mb-4",rules:[e=>!!e||"请输入设备或位置"]},null,8,["modelValue","rules"]),j(o,{modelValue:d.value.type,"onUpdate:modelValue":a[2]||(a[2]=e=>d.value.type=e),items:u,"item-title":"label","item-value":"value",label:"任务类型",variant:"outlined",class:"mb-4",rules:[e=>!!e||"请选择任务类型"]},null,8,["modelValue","rules"]),j(C,{modelValue:d.value.content_daily,"onUpdate:modelValue":a[3]||(a[3]=e=>d.value.content_daily=e),label:"工作内容",variant:"outlined",class:"mb-4",rows:"3",rules:[e=>!!e||"请输入工作内容"]},null,8,["modelValue","rules"]),j(x,{modelValue:d.value.solved,"onUpdate:modelValue":a[4]||(a[4]=e=>d.value.solved=e),label:"标记为已完成","hide-details":""},null,8,["modelValue"])])),_:1},512)])),_:1}),j(S,null,{default:T((()=>[j(v),j(r,{color:"grey",text:"",onClick:a[5]||(a[5]=e=>l.$emit("close"))},{default:T((()=>a[7]||(a[7]=[A(" 取消 ")]))),_:1,__:[7]}),j(r,{color:"primary",loading:e.loading,disabled:e.loading,onClick:m},{default:T((()=>a[8]||(a[8]=[A(" 保存 ")]))),_:1,__:[8]},8,["loading","disabled"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}},re={class:"text-h5"},ce={__name:"IssueDialog",props:{modelValue:{type:Boolean,required:!0},issue:{type:Object,required:!0},loading:{type:Boolean,default:!1}},emits:["update:modelValue","update:issue","save","close"],setup(e,{emit:l}){const a=e,t=l,s=N(null),u=z((()=>!!p.value.description)),p=z({get:()=>a.issue,set:e=>t("update:issue",e)}),_=["严重","中等","轻微"],f=e=>{const l=e.raw;let a="grey";switch(l){case"严重":a="error";break;case"中等":a="warning";break;case"轻微":a="info"}return{color:a,prependIcon:"严重"===l?"mdi-alert-circle":"中等"===l?"mdi-alert":"mdi-information"}},y=async()=>{var e;const l=await(null==(e=s.value)?void 0:e.validate());(null==l?void 0:l.valid)&&t("save")};return P((()=>a.modelValue),(e=>{e&&setTimeout((()=>{var e;null==(e=s.value)||e.resetValidation()}),50)})),(l,a)=>(q(),M(U,{"model-value":e.modelValue,"max-width":"500px",transition:"dialog-bottom-transition","onUpdate:modelValue":a[4]||(a[4]=e=>l.$emit("update:modelValue",e))},{default:T((()=>[j(c,null,{default:T((()=>[j(i,{class:"d-flex align-center pb-2"},{default:T((()=>[j(d,{class:"mr-2",color:"error"},{default:T((()=>[A(E(p.value.id?"mdi-pencil-circle":"mdi-plus-circle"),1)])),_:1}),Y("span",re,E(p.value.id?"编辑问题":"记录问题"),1)])),_:1}),j(m),j(n,{class:"pt-4"},{default:T((()=>[j(I,{ref_key:"formRef",ref:s},{default:T((()=>[j(C,{modelValue:p.value.description,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value.description=e),label:"问题描述",variant:"outlined",class:"mb-4",rows:"3",rules:[e=>!!e||"请输入问题描述"],placeholder:"请详细描述问题的情况...",autofocus:""},null,8,["modelValue","rules"]),j(o,{modelValue:p.value.severity,"onUpdate:modelValue":a[1]||(a[1]=e=>p.value.severity=e),items:_,label:"严重程度",variant:"outlined",class:"mb-4","item-props":f,density:"comfortable","prepend-inner-icon":"mdi-alert"},null,8,["modelValue"]),j(x,{modelValue:p.value.resolved,"onUpdate:modelValue":a[2]||(a[2]=e=>p.value.resolved=e),label:"已解决","hide-details":"",color:"success"},null,8,["modelValue"])])),_:1},512)])),_:1}),j(S,{class:"pa-4 pt-0"},{default:T((()=>[j(v),j(r,{variant:"outlined",color:"grey",onClick:a[3]||(a[3]=e=>l.$emit("close"))},{default:T((()=>a[5]||(a[5]=[A(" 取消 ")]))),_:1,__:[5]}),j(r,{color:"primary",variant:"elevated",loading:e.loading,disabled:e.loading||!u.value,"append-icon":"mdi-check",onClick:y},{default:T((()=>a[6]||(a[6]=[A(" 保存 ")]))),_:1,__:[6]},8,["loading","disabled"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}},ve=e({__name:"Maintenance",setup(e){const i=l(),d=N((new Date).getMonth()+1),n=N((new Date).toISOString().split("T")[0]),u=N(!1),o=N(!1),c=N([]),v=N([]),m=z((()=>n.value?c.value.filter((e=>e.date===n.value)):[])),p=N([]),y=N(!1),g=N(!1),h=N(!1),k=N([]),w=N(!1),b=N(!1),x=N(-1),V=N({id:null,equipment_type:"",date:"",downtime_count:0,downtime_minutes:0,parts_produced:0,user_id:null}),$=N(-1),I=N({id:null,title:"",wheres:"",date:"",type:1,content_daily:"",solved:!1}),D=N(!1),C=N(!1),S=N({id:null,date:"",description:"",severity:"中等",resolved:!1,user_id:i.userId}),U=async()=>{try{u.value=!0;const e=parseInt(i.userId),l=await t.get("/maint/daily",{params:{user_id:e}});c.value=l.data,F()}catch(e){s.error("加载任务失败")}finally{u.value=!1}},B=async()=>{try{w.value=!0;const e=parseInt(i.userId),l=await t.get("/maint/metrics",{params:{user_id:e}});k.value=l.data}catch(e){s.error("加载维修数据指标失败")}finally{w.value=!1}},F=()=>{const e=new Date,l=e.getDay(),a=new Date(e);a.setDate(e.getDate()-l);const t=new Date(a);t.setDate(a.getDate()+6);const s=e=>e.toISOString().split("T")[0],i=s(a),d=s(t);v.value=c.value.filter((e=>{const l=e.date>=i&&e.date<=d,a=!e.solved&&e.date<i;return l||a})),v.value.sort(((e,l)=>e.date<l.date?-1:e.date>l.date?1:0))},O=async()=>{await Promise.all([U(),X(),B()])},Y=async()=>{try{if(o.value=!0,!I.value.title||!I.value.wheres||!I.value.content_daily)return void s.warning("请填写所有必填字段");const e={title:I.value.title,wheres:I.value.wheres,date:I.value.date,type:parseInt(I.value.type),content_daily:I.value.content_daily,solved:I.value.solved,user_id:parseInt(i.userId)};-1===$.value?await t.post("/maint/daily",e):await t.put(`/maint/daily/${I.value.id}`,e),y.value=!1,await O(),s.success(-1===$.value?"任务创建成功":"任务更新成功")}catch(e){s.error("保存任务失败")}finally{o.value=!1}},E=async e=>{try{const l={solved:e.solved};await t.put(`/maint/daily/${e.id}`,l),await O()}catch(l){s.error("更新状态失败"),e.solved=!e.solved}},R=async e=>{try{await t.delete(`/maint/daily/${e.id}`);const l=c.value.indexOf(e);l>-1&&c.value.splice(l,1),s.success("任务已删除"),await U()}catch(l){s.error("删除任务失败")}},H=()=>{let e="data:text/csv;charset=utf-8,日期,设备,工作内容,类型,状态\n";v.value.forEach((l=>{const a=l.solved?"已完成":"待完成",t=K(l.type),s=`${l.date},${l.wheres},${l.content_daily},${t},${a}`;e+=s+"\n"}));const l=encodeURI(e),a=document.createElement("a");a.setAttribute("href",l),a.setAttribute("download","维修周计划.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},K=e=>{const l=[{value:1,label:"定期维护"},{value:2,label:"设备调试"},{value:3,label:"故障维修"},{value:4,label:"备件更换"},{value:5,label:"预防性维护"}].find((l=>l.value===parseInt(e)));return l?l.label:"未知类型"},X=async()=>{try{D.value=!0;const e=parseInt(i.userId),l=await t.get("/maint/weekly",{params:{user_id:e}});p.value=l.data.map((e=>{const l=void 0!==e.solved_flag?e.solved_flag:void 0!==e.solved?e.solved:void 0!==e.isSolved?e.isSolved:0;return{id:e.id,date:e.DateTime||e.date_time||e.date,description:e.content||e.description||e.title,severity:e.degree||e.severity||"中等",resolved:1===l||!0===l,user_id:e.user_id}}))}catch(e){s.error("加载问题记录失败")}finally{D.value=!1}},Z=async e=>{try{const l={solved_flag:e.solved};await t.put(`/maint/weekly/${e.id}`,l)}catch(l){s.error("更新状态失败"),e.solved=!e.solved}},G=async()=>{try{if(C.value=!0,!S.value.description||!S.value.date)return void s.warning("请填写所有必填字段");const e={date:S.value.date,description:S.value.description,severity:S.value.severity,solved_flag:S.value.resolved,user_id:parseInt(i.userId)};S.value.id?await t.put(`/maint/weekly/${S.value.id}`,e):await t.post("/maint/weekly",e),g.value=!1,await X(),s.success(S.value.id?"问题记录更新成功":"问题记录创建成功")}catch(e){s.error("保存问题记录失败")}finally{C.value=!1}},Q=async e=>{try{await t.delete(`/maint/weekly/${e.id}`);const l=p.value.indexOf(e);l>-1&&p.value.splice(l,1),s.success("问题记录已删除")}catch(l){s.error("删除问题记录失败")}},ee=()=>{$.value=-1,I.value={id:null,title:"",wheres:"",date:n.value,type:1,content_daily:"",solved:!1},y.value=!0},ae=()=>{y.value=!1},se=e=>{$.value=c.value.indexOf(e),I.value={...e},y.value=!0},ie=(e=null)=>{S.value=e?{...e}:{id:null,date:n.value,description:"",severity:"中等",resolved:!1,user_id:parseInt(i.userId)},g.value=!0},de=()=>{g.value=!1},ue=()=>{h.value=!1},re=async()=>{try{if(b.value=!0,!V.value.equipment_type||!V.value.date)return void s.warning("请填写所有必填字段");const e={equipment_type:V.value.equipment_type,date:V.value.date,downtime_count:parseInt(V.value.downtime_count),downtime_minutes:parseInt(V.value.downtime_minutes),parts_produced:parseInt(V.value.parts_produced),user_id:parseInt(i.userId)};-1===x.value?await t.post("/maint/metrics",e):await t.put(`/maint/metrics/${V.value.id}`,e),h.value=!1,await B(),s.success(-1===x.value?"维修指标创建成功":"维修指标更新成功")}catch(e){s.error("保存维修指标失败")}finally{b.value=!1}};return J((()=>{O()})),P(n,(()=>{})),P(d,(()=>{const e=n.value.split("-");if(3===e.length){if(parseInt(e[1])!==d.value){const e=(new Date).getFullYear();n.value=`${e}-${d.value.toString().padStart(2,"0")}-01`}}})),(e,l)=>(q(),M(a,{title:"维修管理",icon:"mdi-wrench",color:"primary"},{"header-actions":T((()=>[j(r,{color:"info",variant:"outlined","prepend-icon":"mdi-file-document-multiple",class:"me-2",to:"/pr-management"},{default:T((()=>l[9]||(l[9]=[A(" PR管理 ")]))),_:1,__:[9]}),j(r,{color:"primary",variant:"outlined","prepend-icon":"mdi-chart-line",class:"me-2",to:"/maintenance/metrics"},{default:T((()=>l[10]||(l[10]=[A(" 查看维修指标 ")]))),_:1,__:[10]}),j(r,{color:"primary","prepend-icon":"mdi-plus",onClick:ee},{default:T((()=>l[11]||(l[11]=[A(" 添加任务 ")]))),_:1,__:[11]})])),default:T((()=>[j(_,null,{default:T((()=>[j(f,{cols:"12",md:"5",lg:"4"},{default:T((()=>[j(W,{"selected-date":n.value,"onUpdate:selectedDate":l[0]||(l[0]=e=>n.value=e),"selected-month":d.value,"onUpdate:selectedMonth":l[1]||(l[1]=e=>d.value=e),tasks:c.value},null,8,["selected-date","selected-month","tasks"])])),_:1}),j(f,{cols:"12",md:"7",lg:"8"},{default:T((()=>[j(le,{tasks:m.value,loading:u.value,date:n.value,onAddTask:ee,onEditTask:se,onDeleteTask:R,onUpdateStatus:E},null,8,["tasks","loading","date"])])),_:1})])),_:1}),j(_,{class:"mt-6 match-height"},{default:T((()=>[j(f,{cols:"12",md:"7"},{default:T((()=>[j(te,{tasks:v.value,onExport:H},null,8,["tasks"])])),_:1}),j(f,{cols:"12",md:"5"},{default:T((()=>[j(ne,{issues:p.value,loading:D.value,onAddIssue:l[2]||(l[2]=e=>ie()),onEditIssue:ie,onDeleteIssue:Q,onToggleStatus:Z},null,8,["issues","loading"])])),_:1})])),_:1}),j(oe,{modelValue:y.value,"onUpdate:modelValue":l[3]||(l[3]=e=>y.value=e),task:I.value,"onUpdate:task":l[4]||(l[4]=e=>I.value=e),"is-new":-1===$.value,loading:o.value,onSave:Y,onClose:ae},null,8,["modelValue","task","is-new","loading"]),j(ce,{modelValue:g.value,"onUpdate:modelValue":l[5]||(l[5]=e=>g.value=e),issue:S.value,"onUpdate:issue":l[6]||(l[6]=e=>S.value=e),loading:C.value,onSave:G,onClose:de},null,8,["modelValue","issue","loading"]),j(L,{modelValue:h.value,"onUpdate:modelValue":l[7]||(l[7]=e=>h.value=e),metric:V.value,"onUpdate:metric":l[8]||(l[8]=e=>V.value=e),"is-new":-1===x.value,loading:b.value,onSave:re,onClose:ue},null,8,["modelValue","metric","is-new","loading"])])),_:1}))}},[["__scopeId","data-v-d29085a3"]]);export{ve as default};
