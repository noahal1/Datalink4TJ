import{V as e,e as l,g as a,W as t,aa as u,Z as o,ac as n,ad as s,v as d,_ as i,a1 as m,h as v,j as r,k as _,l as p}from"./chunk-vue-core.CxEQweee.js";import{r as c,d as b,w as f,ae as V,ac as h,ad as w,H as x,K as y,X as F,a4 as g}from"./chunk-vendors.D0_dqILu.js";const U={class:"text-h5"},N={class:"d-flex flex-wrap"},C={class:"text-h6"},R={class:"text-h6"},T={class:"d-flex flex-wrap mt-2"},W={class:"text-h6"},k={class:"text-h6"},B={class:"mt-4"},I={__name:"MetricsDialog",props:{modelValue:{type:Boolean,required:!0},metric:{type:Object,required:!0},isNew:{type:Boolean,default:!0},loading:{type:Boolean,default:!1}},emits:["update:modelValue","update:metric","save","close"],setup(I,{emit:M}){const j=I,E=M,H=c(null),L=c(!0),O=c(!0),q=c(!0),S=c(!0),$=b({get:()=>{const e=j.metric||{};return{...e,shift_code:e.shift_code||1,plan_down_time:e.plan_down_time||0,out_plan_down_time:e.out_plan_down_time||0,oee:e.oee||0,amount:e.amount||0,issue_count:e.issue_count||0,availability_rate:e.availability_rate||0,mttr:e.mttr||0,mtbf:e.mtbf||0}},set:e=>E("update:metric",e)}),D=["SWI-L","SWI-R","RWH-L","RWH-R","W01","HF","LC"],K=b((()=>{const e=Number($.value.plan_down_time)||0,l=Number($.value.out_plan_down_time)||0,a=720-e;if(a<=0)return"0.00";const t=a-l;return t<0?"0.00":(t/720*100).toFixed(2)})),X=b((()=>{const e=Number($.value.plan_down_time)||0,l=Number($.value.out_plan_down_time)||0,a=720-e;if(a<=0)return"0.00";const t=a-l;return t<0?"0.00":(t/a*100).toFixed(2)})),Z=b((()=>{const e=Number($.value.out_plan_down_time)||0,l=Number($.value.issue_count)||0;return l<=0?"0.00":(e/l).toFixed(2)})),z=b((()=>{const e=Number($.value.plan_down_time)||0,l=Number($.value.out_plan_down_time)||0,a=Number($.value.issue_count)||0,t=720-e;if(t<=0)return"0.00";const u=t-l;return u<0?"0.00":a<=0?u.toFixed(2):(u/a).toFixed(2)})),A=()=>{L.value&&($.value.oee=parseFloat(K.value)/100)},G=()=>{O.value&&($.value.availability_rate=parseFloat(X.value)/100)},J=()=>{q.value&&($.value.mttr=parseFloat(Z.value)),S.value&&($.value.mtbf=parseFloat(z.value))};f(K,(e=>{L.value&&($.value.oee=parseFloat(e)/100)})),f(X,(e=>{O.value&&($.value.availability_rate=parseFloat(e)/100)})),f(Z,(e=>{q.value&&($.value.mttr=parseFloat(e))})),f(z,(e=>{S.value&&($.value.mtbf=parseFloat(e))}));const P=async()=>{var e;const l=await(null==(e=H.value)?void 0:e.validate());(null==l?void 0:l.valid)&&(L.value&&($.value.oee=parseFloat(K.value)/100),O.value&&($.value.availability_rate=parseFloat(X.value)/100),q.value&&($.value.mttr=parseFloat(Z.value)),S.value&&($.value.mtbf=parseFloat(z.value)),$.value.shift_date=$.value.shift_date,E("save"))};return f((()=>j.modelValue),(e=>{e&&setTimeout((()=>{var e;null==(e=H.value)||e.resetValidation(),L.value&&A(),O.value&&G(),(q.value||S.value)&&J()}),50)})),(c,b)=>(h(),V(p,{"model-value":I.modelValue,"max-width":"600px","onUpdate:modelValue":b[12]||(b[12]=e=>c.$emit("update:modelValue",e))},{default:w((()=>[x(e,null,{default:w((()=>[x(l,null,{default:w((()=>[y("span",U,F(I.isNew?"添加维修数据":"编辑维修数据"),1)])),_:1}),x(a,null,{default:w((()=>[x(t,{ref:"formRef"},{default:w((()=>[x(u,{modelValue:$.value.line,"onUpdate:modelValue":b[0]||(b[0]=e=>$.value.line=e),items:D,label:"线体",variant:"outlined",class:"mb-4",rules:[e=>!!e||"请选择线体"]},null,8,["modelValue","rules"]),x(o,{modelValue:$.value.shift_date,"onUpdate:modelValue":b[1]||(b[1]=e=>$.value.shift_date=e),label:"日期",variant:"outlined",class:"mb-4",type:"date",rules:[e=>!!e||"请选择日期"]},null,8,["modelValue","rules"]),x(n,{modelValue:$.value.shift_code,"onUpdate:modelValue":b[2]||(b[2]=e=>$.value.shift_code=e),label:"班次",class:"mb-4",rules:[e=>!!e||"请选择班次"],inline:""},{default:w((()=>[x(s,{value:1,label:"白班"}),x(s,{value:2,label:"夜班"})])),_:1},8,["modelValue","rules"]),x(o,{modelValue:$.value.plan_down_time,"onUpdate:modelValue":b[3]||(b[3]=e=>$.value.plan_down_time=e),label:"计划停机时间(分钟)",variant:"outlined",class:"mb-4",type:"number",min:"0",rules:[e=>e>=0||"计划停机时间不能为负数"],hint:"每班总工作时间为720分钟","persistent-hint":"",onInput:A},null,8,["modelValue","rules"]),x(o,{modelValue:$.value.out_plan_down_time,"onUpdate:modelValue":b[4]||(b[4]=e=>$.value.out_plan_down_time=e),label:"非计划停机时间(分钟)",variant:"outlined",class:"mb-4",type:"number",min:"0",rules:[e=>e>=0||"非计划停机时间不能为负数"],onInput:A},null,8,["modelValue","rules"]),x(o,{modelValue:$.value.issue_count,"onUpdate:modelValue":b[5]||(b[5]=e=>$.value.issue_count=e),label:"问题数量",variant:"outlined",class:"mb-4",type:"number",min:"0",rules:[e=>e>=0||"问题数量不能为负数"],onInput:J},null,8,["modelValue","rules"]),x(o,{modelValue:$.value.amount,"onUpdate:modelValue":b[6]||(b[6]=e=>$.value.amount=e),label:"生产数量",variant:"outlined",class:"mb-4",type:"number",min:"0",rules:[e=>e>=0||"生产数量不能为负数"]},null,8,["modelValue","rules"]),x(d,{class:"my-4"}),y("div",N,[x(e,{variant:"outlined",class:"mb-2 me-2 pa-2 flex-grow-1"},{default:w((()=>[b[13]||(b[13]=y("div",{class:"text-subtitle-2"}," 设备综合效率(OEE) ",-1)),y("div",C,F(K.value)+"% ",1),x(i,{modelValue:L.value,"onUpdate:modelValue":b[7]||(b[7]=e=>L.value=e),label:"使用计算值",density:"compact","hide-details":"",onChange:A},null,8,["modelValue"])])),_:1,__:[13]}),x(e,{variant:"outlined",class:"mb-2 me-2 pa-2 flex-grow-1"},{default:w((()=>[b[14]||(b[14]=y("div",{class:"text-subtitle-2"}," 设备可动率 ",-1)),y("div",R,F(X.value)+"% ",1),x(i,{modelValue:O.value,"onUpdate:modelValue":b[8]||(b[8]=e=>O.value=e),label:"使用计算值",density:"compact","hide-details":"",onChange:G},null,8,["modelValue"])])),_:1,__:[14]})]),y("div",T,[x(e,{variant:"outlined",class:"mb-2 me-2 pa-2 flex-grow-1"},{default:w((()=>[b[15]||(b[15]=y("div",{class:"text-subtitle-2"}," MTTR (平均修复时间) ",-1)),y("div",W,F(Z.value)+"分钟 ",1),x(i,{modelValue:q.value,"onUpdate:modelValue":b[9]||(b[9]=e=>q.value=e),label:"使用计算值",density:"compact","hide-details":"",onChange:J},null,8,["modelValue"])])),_:1,__:[15]}),x(e,{variant:"outlined",class:"mb-2 me-2 pa-2 flex-grow-1"},{default:w((()=>[b[16]||(b[16]=y("div",{class:"text-subtitle-2"}," MTBF (平均故障间隔时间) ",-1)),y("div",k,F(z.value)+"分钟 ",1),x(i,{modelValue:S.value,"onUpdate:modelValue":b[10]||(b[10]=e=>S.value=e),label:"使用计算值",density:"compact","hide-details":"",onChange:J},null,8,["modelValue"])])),_:1,__:[16]})]),y("div",B,[x(m,{type:"info",density:"compact",variant:"tonal",border:"start",icon:"mdi-information-outline"},{default:w((()=>b[17]||(b[17]=[y("strong",null,"计算说明:",-1),y("div",{class:"mt-1"}," 总工作时间: 720分钟 (12小时/班) ",-1),y("div",null,"可用时间 = 总时间(720分钟) - 计划停机时间",-1),y("div",null,"实际运行时间 = 可用时间 - 非计划停机时间",-1),y("div",null,"OEE = 实际运行时间 / 总时间",-1),y("div",null,"可动率 = 实际运行时间 / 可用时间",-1),y("div",null,"MTTR = 非计划停机时间 / 问题数量",-1),y("div",null,"MTBF = 实际运行时间 / 问题数量",-1)]))),_:1,__:[17]})])])),_:1},512)])),_:1}),x(v,null,{default:w((()=>[x(r),x(_,{color:"grey",text:"",onClick:b[11]||(b[11]=e=>c.$emit("close"))},{default:w((()=>b[18]||(b[18]=[g(" 取消 ")]))),_:1,__:[18]}),x(_,{color:"primary",loading:I.loading,disabled:I.loading,onClick:P},{default:w((()=>b[19]||(b[19]=[g(" 保存 ")]))),_:1,__:[19]},8,["loading","disabled"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}};export{I as _};
