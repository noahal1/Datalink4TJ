import{b as e,U as l,f as a}from"./entry-index.D92NaooR.js";import{u as t}from"./chunk-useNotification.BHip036b.js";import{A as u,k as o,f as i,j as d,Z as n,z as r,V as s,e as c,g as m,ab as v,h as p,l as _,F as f}from"./chunk-vue-core.CxEQweee.js";import{r as y,d as h,N as V,ab as b,ac as g,H as k,ad as w,a4 as x,K as C,X as U}from"./chunk-vendors.D0_dqILu.js";import"./chunk-utils-vendor.DVew6AbD.js";import"./chunk-chart-core.HkgdsJMe.js";const j={class:"text-caption text-grey"},L={__name:"Departments",setup(L){const{showSuccess:A,showError:z}=t(),q=[{title:"部门代码",key:"id",align:"start",sortable:!0},{title:"部门名称",key:"name",align:"start",sortable:!0},{title:"部门描述",key:"description",align:"start",sortable:!0},{title:"操作",key:"actions",align:"center",sortable:!1}],D=y([]);y([]);const H=y([]),I=y(!1),N=y(!1),S=y(!1),$=y(""),E=y(!1),F=y({id:"",name:"",description:""}),K=y(!1),R=y(!1),T=y(-1),X=y({id:"",name:"",description:""}),Z={id:"",name:"",description:""},B={required:e=>null!=e&&""!==e||"此字段为必填项"},G=h((()=>-1===T.value?"添加部门":"编辑部门"));V((()=>{J()}));const J=async()=>{try{I.value=!0;const l=await e.get("/departments/");l&&l.data&&Array.isArray(l.data)?(D.value=l.data,H.value=[...l.data]):l&&Array.isArray(l)?(D.value=l,H.value=[...l]):(D.value=[],H.value=[],z("部门数据格式不正确"))}catch(l){z("获取部门数据失败"),D.value=[],H.value=[]}finally{I.value=!1}},M=()=>{T.value=-1,X.value={...Z},K.value=!0},O=()=>{K.value=!1,setTimeout((()=>{X.value={...Z}}),300)},P=async()=>{var l,a;if(X.value.id&&X.value.name)try{N.value=!0,-1===T.value?(await e.post("/departments/",X.value),A("部门创建成功")):(await e.put(`/departments/${X.value.id}`,X.value),A("部门更新成功")),O(),J()}catch(t){z("保存部门失败: "+((null==(a=null==(l=t.response)?void 0:l.data)?void 0:a.detail)||t.message))}finally{N.value=!1}else z("请填写必填字段")},Q=async()=>{var l,a;try{S.value=!0,await e.delete(`/departments/${X.value.id}`),A("部门删除成功"),R.value=!1,J()}catch(t){z("删除部门失败: "+((null==(a=null==(l=t.response)?void 0:l.data)?void 0:a.detail)||t.message))}finally{S.value=!1}},W=()=>{E.value=!1;const e=H.value.filter((e=>{let l=!0;return F.value.id&&!e.id.toString().toLowerCase().includes(F.value.id.toLowerCase())&&(l=!1),F.value.name&&!e.name.toLowerCase().includes(F.value.name.toLowerCase())&&(l=!1),F.value.description&&e.description&&!e.description.toLowerCase().includes(F.value.description.toLowerCase())&&(l=!1),l}));D.value=e},Y=()=>{F.value={id:"",name:"",description:""},D.value=[...H.value]};return(e,t)=>(g(),b("div",null,[k(r,null,{default:w((()=>[k(u,{cols:"12"},{default:w((()=>[k(l,{title:"部门管理",icon:"mdi-domain",headers:q,items:D.value,loading:I.value,search:$.value,"items-per-page":10},{title:w((()=>[t[13]||(t[13]=C("span",null,"部门管理",-1)),k(d),k(n,{modelValue:$.value,"onUpdate:modelValue":t[0]||(t[0]=e=>$.value=e),"append-icon":"mdi-magnify",label:"搜索","single-line":"","hide-details":"",density:"compact",class:"ml-4",style:{"max-width":"300px"}},null,8,["modelValue"])])),"item.actions":w((({item:e})=>[k(o,{size:"small",variant:"text",color:"primary",class:"mr-1",onClick:l=>(e=>{T.value=D.value.findIndex((l=>l.id===e.id)),X.value={...e},K.value=!0})(e)},{default:w((()=>[k(i,null,{default:w((()=>t[14]||(t[14]=[x("mdi-pencil")]))),_:1,__:[14]}),t[15]||(t[15]=x(" 编辑 "))])),_:2,__:[15]},1032,["onClick"]),k(o,{size:"small",variant:"text",color:"error",onClick:l=>(e=>{X.value={...e},R.value=!0})(e)},{default:w((()=>[k(i,null,{default:w((()=>t[16]||(t[16]=[x("mdi-delete")]))),_:1,__:[16]}),t[17]||(t[17]=x(" 删除 "))])),_:2,__:[17]},1032,["onClick"])])),actions:w((()=>[k(o,{color:"primary","prepend-icon":"mdi-plus",onClick:M},{default:w((()=>t[18]||(t[18]=[x(" 添加部门 ")]))),_:1,__:[18]}),k(o,{class:"ml-2",color:"secondary","prepend-icon":"mdi-refresh",onClick:J},{default:w((()=>t[19]||(t[19]=[x(" 刷新 ")]))),_:1,__:[19]}),k(o,{class:"ml-2",color:"info","prepend-icon":"mdi-filter",onClick:t[1]||(t[1]=e=>E.value=!0)},{default:w((()=>t[20]||(t[20]=[x(" 筛选 ")]))),_:1,__:[20]})])),_:1},8,["items","loading","search"])])),_:1})])),_:1}),k(_,{modelValue:K.value,"onUpdate:modelValue":t[5]||(t[5]=e=>K.value=e),"max-width":"500px"},{default:w((()=>[k(s,null,{default:w((()=>[k(c,{class:"text-h5 bg-primary text-white"},{default:w((()=>[x(U(G.value),1)])),_:1}),k(m,{class:"pt-4"},{default:w((()=>[k(a,{ref:"formRef","show-default-actions":!1},{default:w((()=>[k(n,{modelValue:X.value.id,"onUpdate:modelValue":t[2]||(t[2]=e=>X.value.id=e),label:"部门代码",placeholder:"请输入部门代码",variant:"outlined",density:"comfortable",disabled:-1!==T.value,rules:[B.required]},null,8,["modelValue","disabled","rules"]),k(n,{modelValue:X.value.name,"onUpdate:modelValue":t[3]||(t[3]=e=>X.value.name=e),label:"部门名称",placeholder:"请输入部门名称",variant:"outlined",density:"comfortable",rules:[B.required]},null,8,["modelValue","rules"]),k(v,{modelValue:X.value.description,"onUpdate:modelValue":t[4]||(t[4]=e=>X.value.description=e),label:"部门描述",placeholder:"请输入部门描述",variant:"outlined",density:"comfortable",rows:"3"},null,8,["modelValue"])])),_:1},512)])),_:1}),k(p,null,{default:w((()=>[k(d),k(o,{color:"grey",variant:"text",onClick:O},{default:w((()=>t[21]||(t[21]=[x(" 取消 ")]))),_:1,__:[21]}),k(o,{color:"primary",loading:N.value,onClick:P},{default:w((()=>t[22]||(t[22]=[x(" 确定 ")]))),_:1,__:[22]},8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),k(_,{modelValue:R.value,"onUpdate:modelValue":t[7]||(t[7]=e=>R.value=e),"max-width":"500px"},{default:w((()=>[k(s,null,{default:w((()=>[k(c,{class:"text-h5 bg-error text-white"},{default:w((()=>t[23]||(t[23]=[x(" 确认删除 ")]))),_:1,__:[23]}),k(m,{class:"pt-4"},{default:w((()=>[C("p",null,[t[24]||(t[24]=x("您确定要删除部门 ")),C("strong",null,U(X.value.name),1),t[25]||(t[25]=x(" 吗？此操作不可撤销。"))]),C("p",j," 部门ID: "+U(X.value.id),1)])),_:1}),k(p,null,{default:w((()=>[k(d),k(o,{color:"grey",variant:"text",onClick:t[6]||(t[6]=e=>R.value=!1)},{default:w((()=>t[26]||(t[26]=[x(" 取消 ")]))),_:1,__:[26]}),k(o,{color:"error",loading:S.value,onClick:Q},{default:w((()=>t[27]||(t[27]=[x(" 删除 ")]))),_:1,__:[27]},8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),k(f,{modelValue:E.value,"onUpdate:modelValue":t[12]||(t[12]=e=>E.value=e),location:"right",temporary:"",width:"300"},{default:w((()=>[k(s,{class:"h-100"},{default:w((()=>[k(c,{class:"bg-primary text-white"},{default:w((()=>[k(i,{class:"mr-2",color:"white"},{default:w((()=>t[28]||(t[28]=[x(" mdi-filter ")]))),_:1,__:[28]}),t[30]||(t[30]=x(" 筛选条件 ")),k(d),k(o,{icon:"",variant:"text",color:"white",size:"small",onClick:t[8]||(t[8]=e=>E.value=!1)},{default:w((()=>[k(i,null,{default:w((()=>t[29]||(t[29]=[x("mdi-close")]))),_:1,__:[29]})])),_:1})])),_:1,__:[30]}),k(m,{class:"pt-4"},{default:w((()=>[k(a,null,{default:w((()=>[k(n,{modelValue:F.value.id,"onUpdate:modelValue":t[9]||(t[9]=e=>F.value.id=e),label:"部门代码",variant:"outlined",density:"comfortable",clearable:""},null,8,["modelValue"]),k(n,{modelValue:F.value.name,"onUpdate:modelValue":t[10]||(t[10]=e=>F.value.name=e),label:"部门名称",variant:"outlined",density:"comfortable",clearable:""},null,8,["modelValue"]),k(n,{modelValue:F.value.description,"onUpdate:modelValue":t[11]||(t[11]=e=>F.value.description=e),label:"部门描述",variant:"outlined",density:"comfortable",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),k(p,{class:"py-3"},{default:w((()=>[k(d),k(o,{variant:"text",color:"grey",onClick:Y},{default:w((()=>t[31]||(t[31]=[x(" 清除筛选 ")]))),_:1,__:[31]}),k(o,{color:"primary",onClick:W},{default:w((()=>t[32]||(t[32]=[x(" 应用筛选 ")]))),_:1,__:[32]})])),_:1})])),_:1})])),_:1},8,["modelValue"])]))}};export{L as default};
