import{_ as e,e as a,U as l,d as t,i,M as n,p as s}from"./entry-index.D92NaooR.js";import{o as r,Z as d,k as o,z as u,A as m,f as c}from"./chunk-vue-core.CxEQweee.js";import{ab as v,ac as p,H as f,K as w,X as y,r as g,d as h,N as k,a1 as b,ae as _,ad as x,af as D,a4 as L,u as W}from"./chunk-vendors.D0_dqILu.js";import{g as S,s as V,e as M,f as j}from"./chunk-date-vendor.DjLOnOdQ.js";import{d as A}from"./chunk-utils-vendor.DVew6AbD.js";import"./chunk-chart-core.HkgdsJMe.js";const O={class:"app-loader"},I={class:"app-loader-text mt-4"},N=e({__name:"AppLoader",props:{message:{type:String,default:"加载中..."}},setup:e=>(a,l)=>(p(),v("div",O,[f(r,{indeterminate:"",color:"primary",size:"64",width:"4"}),w("div",I,y(e.message),1)]))},[["__scopeId","data-v-06d64766"]]),U={class:"week-filter d-flex align-center justify-center mb-6"},J={style:{height:"300px"}},R=e({__name:"EHS",setup(e){const r=[{title:"周",key:"week",align:"center",width:100},{title:"日期范围",key:"dateRange",align:"center",width:200},{title:"LWD数量",key:"lwd",align:"center",width:150}],v=g([]),O=g([]),I=g(!1),R=g(!1),z=g(!1),C=g(1),F=g(52),$=g([]),B=h((()=>$.value.reduce(((e,a)=>e+(a.lwd||0)),0))),E=h((()=>{const e=$.value.filter((e=>void 0!==e.lwd&&null!==e.lwd));return 0===e.length?0:B.value/e.length})),H=h((()=>{const e=S(new Date),a=v.value.find((a=>a.week===e));return a?a.lwd:0})),K=h((()=>({tooltip:{trigger:"axis",formatter:"{b}: {c} LWD"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:$.value.map((e=>`第${e.week}周`))},yAxis:{type:"value",name:"LWD数量"},series:[{name:"LWD",type:"line",data:$.value.map((e=>e.lwd||0)),markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},itemStyle:{color:"#FB8C00"},lineStyle:{width:3}}]}))),P=A((()=>{I.value=!0}),500),X=()=>{C.value>F.value?n.warning("起始周不能大于结束周"):$.value=v.value.filter((e=>e.week>=C.value&&e.week<=F.value))},Y=async()=>{if(I.value){R.value=!0;try{const e=v.value.filter(((e,a)=>{const l=O.value[a];return e.lwd!==l.lwd}));if(0===e.length)return n.info("没有数据变更"),void(R.value=!1);const a=e.map((e=>({week:e.week,lwd:e.lwd})));await s("/ehs/lwd",a),O.value=JSON.parse(JSON.stringify(v.value)),I.value=!1,n.success("数据保存成功")}catch(e){n.error("保存失败: "+(e.message||"未知错误"))}finally{R.value=!1}}else n.info("没有数据需要保存")};return k((()=>{(async()=>{z.value=!0;try{const e=await i("/ehs/lwd"),a=(new Date).getFullYear(),l=Array.from({length:53},((e,l)=>{if(0===l)return null;const t=V(new Date(a,0,7*l-3),{weekStartsOn:1}),i=M(new Date(a,0,7*l-3),{weekStartsOn:1});return{week:l,dateRange:`${j(t,"MM/dd")} - ${j(i,"MM/dd")}`,lwd:0}})).filter(Boolean);e&&Array.isArray(e)&&e.forEach((e=>{const a=l.find((a=>a.week===parseInt(e.week)));a&&(a.lwd=e.lwd)})),v.value=l,O.value=JSON.parse(JSON.stringify(l)),X()}catch(e){n.error("加载LWD数据失败: "+(e.message||"未知错误"))}finally{z.value=!1}})()})),(e,i)=>{const n=a,s=b("v-chart"),v=l,g=t;return p(),_(g,{title:"LWD数据管理",icon:"mdi-security",color:"success"},{default:x((()=>[w("div",U,[f(d,{modelValue:C.value,"onUpdate:modelValue":i[0]||(i[0]=e=>C.value=e),modelModifiers:{number:!0},label:"起始周",type:"number",min:"1",max:"52",variant:"outlined",density:"comfortable",class:"mr-2",style:{"max-width":"120px"}},null,8,["modelValue"]),f(d,{modelValue:F.value,"onUpdate:modelValue":i[1]||(i[1]=e=>F.value=e),modelModifiers:{number:!0},label:"结束周",type:"number",min:"1",max:"52",variant:"outlined",density:"comfortable",class:"mr-2",style:{"max-width":"120px"}},null,8,["modelValue"]),f(o,{color:"primary",class:"ml-2",variant:"elevated",onClick:X},{default:x((()=>i[2]||(i[2]=[L(" 应用筛选 ")]))),_:1,__:[2]})]),f(u,{class:"mb-6"},{default:x((()=>[f(m,{cols:"12",md:"4"},{default:x((()=>[f(n,{title:"总 LWD 数量",value:B.value,icon:"mdi-counter",color:"primary"},null,8,["value"])])),_:1}),f(m,{cols:"12",md:"4"},{default:x((()=>[f(n,{title:"平均每周 LWD",value:E.value.toFixed(2),icon:"mdi-chart-bar",color:"success"},null,8,["value"])])),_:1}),f(m,{cols:"12",md:"4"},{default:x((()=>[f(n,{title:"当前周 LWD",value:H.value,icon:"mdi-calendar-week",color:"warning"},null,8,["value"])])),_:1})])),_:1}),f(v,{title:"LWD 数据趋势",icon:"mdi-chart-line",headers:[],items:[],"hide-default-footer":"",loading:!1,class:"mb-6"},{"pre-table":x((()=>[w("div",J,[f(s,{class:"chart",option:K.value,autoresize:""},null,8,["option"])])])),_:1}),f(v,{title:"LWD 周数据",icon:"mdi-table",headers:r,items:$.value,"disable-pagination":"","hide-default-footer":"","fixed-header":"",height:"50vh",loading:z.value},{"item.dateRange":x((({item:e})=>[L(y(e.dateRange),1)])),"item.lwd":x((({item:e})=>[f(d,{modelValue:e.lwd,"onUpdate:modelValue":a=>e.lwd=a,modelModifiers:{number:!0},type:"number",min:"0","single-line":"",density:"compact","hide-details":"",variant:"outlined",onInput:W(P)},null,8,["modelValue","onUpdate:modelValue","onInput"])])),_:1},8,["items","loading"]),I.value?(p(),_(o,{key:0,fab:"",dark:"",color:"primary",class:"floating-button",loading:R.value,onClick:Y},{default:x((()=>[f(c,{dark:""},{default:x((()=>i[3]||(i[3]=[L(" mdi-content-save ")]))),_:1,__:[3]})])),_:1},8,["loading"])):D("",!0),z.value?(p(),_(N,{key:1,message:"加载数据中..."})):D("",!0)])),_:1})}}},[["__scopeId","data-v-5fbe1b58"]]);export{R as default};
