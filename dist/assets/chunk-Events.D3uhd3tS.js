import{_ as e,u as a,c as l,U as t,d as i,M as n,b as r}from"./entry-index.D92NaooR.js";import{r as d,d as u,N as s,ae as o,ac as m,ad as c,H as v,K as _,a4 as f,X as p,a9 as y}from"./chunk-vendors.D0_dqILu.js";import{f as h,k as g,$ as k,l as w,V as x,a3 as V,a4 as b,j as C,g as j,W as U,y as z,z as M,A as S,Z as T,v as $,h as q,e as D}from"./chunk-vue-core.CxEQweee.js";import{p as I,a as A,b as E,c as F,f as H}from"./chunk-date-vendor.DjLOnOdQ.js";import"./chunk-utils-vendor.DVew6AbD.js";import"./chunk-chart-core.HkgdsJMe.js";const K={class:"d-flex align-center"},N={class:"d-flex align-center"},O={class:"d-flex justify-center"},R={class:"text-center pa-6"},W=e({__name:"Events",setup(e){const W=a(),X=d(!1),Z=d("添加事件"),B=u((()=>J.value.id?"primary":"success")),G=d(null),J=d({id:null,name:"",department:"",start_time:"",end_time:"",importance:"medium"}),L=d([]),P=d(!0),Q=d(""),Y=d(!1),ee=d(null),ae=d(!1),le=[{title:"高",value:"high"},{title:"中",value:"medium"},{title:"低",value:"low"}],te=[{title:"事件名称",key:"name",align:"start",width:"30%"},{title:"部门",key:"department",align:"start",width:"15%"},{title:"开始时间",key:"start_time",align:"start",width:"15%"},{title:"结束时间",key:"end_time",align:"start",width:"15%"},{title:"操作",key:"actions",align:"center",width:"15%",sortable:!1}],ie=e=>{const a=le.find((a=>a.value===e));return a?a.title:"中"},ne=e=>{switch(e){case"high":return"error";case"medium":return"warning";case"low":return"success";default:return"grey"}},re=e=>{if(!e.end_time)return!0;const a=new Date,l=I(e.end_time);return A(l)||E(l,a)},de=async()=>{P.value=!0;try{if(!W.token)return n.error("请先登录再进行操作！"),void(P.value=!1);const e=await r.get("/events");L.value=e.data.map((e=>({...e,start_time:e.start_time.split("T")[0],end_time:e.end_time?e.end_time.split("T")[0]:null})))}catch(e){n.error("获取事件列表失败")}finally{P.value=!1}},ue=(e=null)=>{if(e)Z.value="编辑事件",J.value={...e};else{Z.value="添加事件";const e=(new Date).toISOString().split("T")[0];J.value={id:null,name:"",department:"",start_time:e,end_time:"",importance:"medium"}}X.value=!0},se=async()=>{try{ae.value=!0;let e=!0;if(G.value){const a=await G.value.validate();e=(null==a?void 0:a.valid)??!1}if(!e)return void n.warning("请完整填写表单");if(!W.token)return void n.error("请先登录再进行操作！");const a={name:J.value.name,department:J.value.department,start_time:J.value.start_time,end_time:J.value.end_time||null,importance:J.value.importance};let l;l=J.value.id?await r.put(`/events/${J.value.id}`,a):await r.post("/events",a),n.success(J.value.id?"事件更新成功":"事件添加成功"),X.value=!1,J.value={id:null,name:"",department:"",start_time:"",end_time:"",importance:"medium"},await de()}catch(e){n.error(J.value.id?"事件更新失败":"事件添加失败")}finally{ae.value=!1}},oe=async()=>{if(ee.value)try{if(!W.token)return void n.error("请先登录再进行操作！");await r.delete(`/events/${ee.value.id}`),n.success("事件删除成功"),Y.value=!1,ee.value=null,await de()}catch(e){n.error("事件删除失败")}},me=e=>{if(!e)return"未设置";const a=I(e);return F(a)?H(a,"yyyy-MM-dd"):"无效日期"};return s((async()=>{await de()})),(e,a)=>{const n=l,r=t,d=i;return m(),o(d,{title:"重要事件管理",icon:"mdi-calendar-text",color:"info"},{"header-actions":c((()=>[v(T,{modelValue:Q.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Q.value=e),"prepend-inner-icon":"mdi-magnify",label:"搜索事件",density:"compact",variant:"outlined","hide-details":"",class:"search-field mx-4",clearable:""},null,8,["modelValue"]),v(g,{color:"primary","prepend-icon":"mdi-plus",onClick:ue},{default:c((()=>a[10]||(a[10]=[f(" 添加事件 ")]))),_:1,__:[10]})])),default:c((()=>[v(n,{loading:P.value,message:"加载数据中..."},null,8,["loading"]),v(r,{headers:te,items:L.value,search:Q.value,loading:P.value,hover:"","fixed-header":"",class:"events-table"},{"item.importance":c((({item:e})=>[v(k,{color:ne(e.importance),size:"small",class:"font-weight-medium"},{default:c((()=>[f(p(ie(e.importance)),1)])),_:2},1032,["color"])])),"item.start_time":c((({item:e})=>[_("div",K,[v(h,{size:"small",color:"primary",class:"mr-1"},{default:c((()=>a[11]||(a[11]=[f(" mdi-calendar-start ")]))),_:1,__:[11]}),f(" "+p(me(e.start_time)),1)])])),"item.end_time":c((({item:e})=>[_("div",N,[v(h,{size:"small",color:re(e)?"success":"grey",class:"mr-1"},{default:c((()=>[f(p(re(e)?"mdi-calendar-clock":"mdi-calendar-check"),1)])),_:2},1032,["color"]),f(" "+p(me(e.end_time)),1)])])),"item.actions":c((({item:e})=>[_("div",O,[v(g,{size:"small",color:"primary",variant:"text",icon:"mdi-pencil",class:"mr-1",onClick:a=>ue(e)},null,8,["onClick"]),v(g,{size:"small",color:"error",variant:"text",icon:"mdi-delete",onClick:a=>{return l=e,ee.value=l,void(Y.value=!0);var l}},null,8,["onClick"])])])),"no-data":c((()=>[_("div",R,[v(h,{size:"large",color:"grey",class:"mb-2"},{default:c((()=>a[12]||(a[12]=[f(" mdi-calendar-remove ")]))),_:1,__:[12]}),a[14]||(a[14]=_("div",{class:"text-subtitle-1 text-medium-emphasis"}," 暂无重要事件记录 ",-1)),v(g,{color:"primary",variant:"text",class:"mt-2",onClick:ue},{default:c((()=>a[13]||(a[13]=[f(" 添加新事件 ")]))),_:1,__:[13]})])])),_:1},8,["items","search","loading"]),v(w,{modelValue:X.value,"onUpdate:modelValue":a[7]||(a[7]=e=>X.value=e),"max-width":"600",persistent:""},{default:c((()=>[v(x,null,{default:c((()=>[v(V,{color:B.value,dark:"",flat:""},{default:c((()=>[v(b,null,{default:c((()=>[f(p(Z.value),1)])),_:1}),v(C),v(g,{icon:"mdi-close",variant:"text",onClick:a[1]||(a[1]=e=>X.value=!1)})])),_:1},8,["color"]),v(j,{class:"pt-4"},{default:c((()=>[v(U,{ref_key:"eventFormRef",ref:G,onSubmit:y(se,["prevent"])},{default:c((()=>[v(z,null,{default:c((()=>[v(M,null,{default:c((()=>[v(S,{cols:"12"},{default:c((()=>[v(T,{modelValue:J.value.name,"onUpdate:modelValue":a[2]||(a[2]=e=>J.value.name=e),label:"事件名称",rules:[e=>!!e||"必填字段"],required:"",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-format-title"},null,8,["modelValue","rules"])])),_:1}),v(S,{cols:"12",md:"6"},{default:c((()=>[v(T,{modelValue:J.value.department,"onUpdate:modelValue":a[3]||(a[3]=e=>J.value.department=e),label:"部门",rules:[e=>!!e||"必填字段"],required:"",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-office-building"},null,8,["modelValue","rules"])])),_:1}),v(S,{cols:"12",md:"6"},{default:c((()=>[v(T,{modelValue:J.value.start_time,"onUpdate:modelValue":a[4]||(a[4]=e=>J.value.start_time=e),label:"开始时间",type:"date",variant:"outlined",density:"comfortable",max:J.value.end_time,"prepend-inner-icon":"mdi-calendar-start"},null,8,["modelValue","max"])])),_:1}),v(S,{cols:"12",md:"6"},{default:c((()=>[v(T,{modelValue:J.value.end_time,"onUpdate:modelValue":a[5]||(a[5]=e=>J.value.end_time=e),label:"结束时间",type:"date",variant:"outlined",density:"comfortable",min:J.value.start_time,"prepend-inner-icon":"mdi-calendar-end"},null,8,["modelValue","min"])])),_:1})])),_:1})])),_:1})])),_:1},512)])),_:1}),v($),v(q,{class:"pa-4"},{default:c((()=>[v(C),v(g,{variant:"tonal",onClick:a[6]||(a[6]=e=>X.value=!1)},{default:c((()=>a[15]||(a[15]=[f(" 取消 ")]))),_:1,__:[15]}),v(g,{color:"primary",variant:"elevated",loading:ae.value,onClick:se},{default:c((()=>[f(p(J.value.id?"保存修改":"添加事件"),1)])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),v(w,{modelValue:Y.value,"onUpdate:modelValue":a[9]||(a[9]=e=>Y.value=e),"max-width":"400"},{default:c((()=>[v(x,null,{default:c((()=>[v(D,{class:"text-h5 bg-error text-white"},{default:c((()=>a[16]||(a[16]=[f(" 确认删除 ")]))),_:1,__:[16]}),v(j,{class:"pt-4"},{default:c((()=>{var e;return[a[17]||(a[17]=f(" 确定要删除事件 ")),_("strong",null,p(null==(e=ee.value)?void 0:e.name),1),a[18]||(a[18]=f(" 吗？此操作不可撤销。 "))]})),_:1,__:[17,18]}),v(q,null,{default:c((()=>[v(C),v(g,{color:"grey-darken-1",variant:"text",onClick:a[8]||(a[8]=e=>Y.value=!1)},{default:c((()=>a[19]||(a[19]=[f(" 取消 ")]))),_:1,__:[19]}),v(g,{color:"error",variant:"tonal",onClick:oe},{default:c((()=>[v(h,{class:"mr-1"},{default:c((()=>a[20]||(a[20]=[f(" mdi-delete ")]))),_:1,__:[20]}),a[21]||(a[21]=f(" 确认删除 "))])),_:1,__:[21]})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}}},[["__scopeId","data-v-45ffe7b1"]]);export{W as default};
