import{_ as e,U as a,d as t,i as l,M as i,p as r}from"./entry-index.D92NaooR.js";import{h as n,K as o}from"./chunk-kpiUtils.CSbvtC9I.js";import{z as s,A as u,aa as c,j as d,k as _,f as v,$ as m,Z as p,m as y,l as h,V as f,e as g,g as k,h as x}from"./chunk-vue-core.CxEQweee.js";import{r as V,N as b,w,ae as T,ac as J,ad as C,K as U,H as M,u as S,a4 as E,ab as j,af as I,X as K}from"./chunk-vendors.D0_dqILu.js";import"./chunk-utils-vendor.DVew6AbD.js";import"./chunk-chart-core.HkgdsJMe.js";const O={class:"sticky-header-container"},z={class:"controls-bar"},A={class:"scrollable-table-container"},N={class:"font-weight-medium"},D={class:"text-center"},Y={key:0,class:"d-flex align-center"},F={key:1,class:"text-center text-grey"},P=e({__name:"HrKpi",setup(e){const{month:P,year:$}=(()=>{const e=new Date,a=e.getMonth(),t=e.getFullYear();return 0===a?{month:12,year:t-1}:{month:a,year:t}})(),H=V(!1),L=V(!1),X=V(P),Z=V($),q=V(!1),B=V(!1),G=V(!1),Q=V(!1),R=V([]),W=V(!1),ee=V(null),ae=Array.from({length:12},((e,a)=>({title:`${a+1}月`,value:a+1}))),te=Array.from({length:5},((e,a)=>({title:`${(new Date).getFullYear()-2+a}年`,value:(new Date).getFullYear()-2+a}))),le=[{title:"描述",key:"description",align:"start",width:"280px"},{title:"区域",key:"area",align:"center",width:"100px"},{title:"实际值",key:"actual_value",align:"center",width:"120px"},{title:"目标值",key:"target_value",align:"center",width:"120px"},{title:"YTD",key:"ytd_value",align:"center",width:"120px"},{title:"原因分析",key:"remark",align:"center",width:"150px"}],ie=[{title:"描述",key:"description",align:"start",width:"280px"},{title:"区域",key:"area",align:"center",width:"120px"},{title:"目标值",key:"target_value",align:"center",width:"150px"}],re=V([]),ne=V([]),oe=e=>"Turnover-contract employee"===e.description?(e.actual_value||0)>(e.target_value||0):(e.actual_value||0)<(e.target_value||0),se=()=>{q.value=!0,B.value=!0},ue=async()=>{var e,a;H.value=!0;try{re.value=(()=>{const e=[];let a=1;return[{description:"EOS Audit Score",areas:["TJM","TJC","汇总"]},{description:"Turnover-contract employee",areas:["TJM","TJC","汇总"]},{description:"Training attainment(people-course)",areas:["TJM","TJC","汇总"]}].forEach((t=>{t.areas.forEach((l=>{e.push({id:a++,description:t.description,area:l,actual_value:0,target_value:0,ytd_value:0,remark:null,action_plan_content:null,expected_close_date:null,actual_close_date:null,root_cause_analysis:null})}))})),e})();const e=await l("/hr/kpi/",{params:{month:X.value,year:Z.value}});if(e.data&&e.data.length>0)e.data.forEach((e=>{const a=re.value.find((a=>a.area===e.area&&a.description===e.description));a&&(a.actual_value=e.actual_value||0,a.target_value=e.target_value||0,a.ytd_value=e.ytd_value||0,a.remark=e.remark||null,a.action_plan_content=e.action_plan_content||null,a.expected_close_date=e.expected_close_date||null,a.actual_close_date=e.actual_close_date||null,a.root_cause_analysis=e.root_cause_analysis||null)}));else try{const e=await l("/hr/kpi/targets/",{params:{year:Z.value}});e.data&&e.data.length>0&&e.data.forEach((e=>{const a=re.value.find((a=>a.area===e.area&&a.description===e.description));a&&(a.target_value=e.target_value||0)}))}catch(t){}ne.value=JSON.parse(JSON.stringify(re.value)),q.value=!1,B.value=!1}catch(t){i.error("加载数据失败: "+((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.detail)||t.message))}finally{H.value=!1}},ce=async()=>{var e,a;L.value=!0;try{const e={month:X.value,year:Z.value,items:re.value.map((e=>({area:e.area,description:e.description,actual_value:e.actual_value,ytd_value:e.ytd_value,remark:e.remark,action_plan_content:e.action_plan_content,expected_close_date:e.expected_close_date,actual_close_date:e.actual_close_date,root_cause_analysis:e.root_cause_analysis})))};await r("/hr/kpi/",e),i.success("人力资源KPI数据保存成功"),q.value=!1,ue()}catch(t){i.error("保存数据失败: "+((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.detail)||t.message))}finally{L.value=!1}},de=()=>{re.value=JSON.parse(JSON.stringify(ne.value)),q.value=!1,B.value=!1,i.info("数据已重置")},_e=async()=>{try{const e=await l("/hr/kpi/targets/",{params:{year:Z.value}});if(e.data&&e.data.length>0)R.value=e.data;else{R.value=[];[{description:"EOS Audit Score",areas:["TJM","TJC","汇总"]},{description:"Turnover-contract employee",areas:["TJM","TJC","汇总"]},{description:"Training attainment(people-course)",areas:["TJM","TJC","汇总"]}].forEach((e=>{e.areas.forEach((a=>{R.value.push({area:a,description:e.description,target_value:0})}))}))}G.value=!0}catch(e){i.error("获取目标值失败")}},ve=async()=>{Q.value=!0;try{const e={year:Z.value,items:R.value.map((e=>({area:e.area,description:e.description,target_value:e.target_value||0})))};await r("/hr/kpi/targets/",e),i.success("目标值保存成功"),G.value=!1,ue()}catch(e){i.error("保存目标值失败")}finally{Q.value=!1}},me=e=>n(e)?"查看/编辑":"填写分析",pe=e=>{ee.value&&(ee.value.root_cause_analysis=e.root_cause_analysis,ee.value.action_plan_content=e.action_plan_content,ee.value.expected_close_date=e.expected_close_date,ee.value.actual_close_date=e.actual_close_date,se())};return b((()=>{ue()})),w(Z,(()=>{ue()})),(e,l)=>(J(),T(t,{title:"人力资源KPI管理",icon:"mdi-account-group",color:"primary"},{default:C((()=>[U("div",O,[U("div",z,[M(s,{class:"align-center"},{default:C((()=>[M(u,{cols:"12",md:"6"},{default:C((()=>[M(s,null,{default:C((()=>[M(u,{cols:"6",md:"4"},{default:C((()=>[M(c,{modelValue:X.value,"onUpdate:modelValue":[l[0]||(l[0]=e=>X.value=e),ue],items:S(ae),label:"选择月份",variant:"outlined",density:"compact","hide-details":"",class:"control-select"},null,8,["modelValue","items"])])),_:1}),M(u,{cols:"6",md:"4"},{default:C((()=>[M(c,{modelValue:Z.value,"onUpdate:modelValue":[l[1]||(l[1]=e=>Z.value=e),ue],items:S(te),label:"选择年份",variant:"outlined",density:"compact","hide-details":"",class:"control-select"},null,8,["modelValue","items"])])),_:1})])),_:1})])),_:1}),M(d),M(u,{cols:"auto"},{default:C((()=>[M(_,{color:"info","prepend-icon":"mdi-target",variant:"outlined",class:"mr-2 action-btn",onClick:_e},{default:C((()=>l[7]||(l[7]=[E(" 设置目标值 ")]))),_:1,__:[7]}),M(_,{color:"secondary",disabled:!q.value,"prepend-icon":"mdi-refresh",variant:"outlined",class:"mr-2 action-btn",onClick:de},{default:C((()=>l[8]||(l[8]=[E(" 重置 ")]))),_:1,__:[8]},8,["disabled"]),M(_,{color:"primary",loading:L.value,disabled:!q.value,"prepend-icon":"mdi-content-save",variant:"elevated",class:"action-btn",onClick:ce},{default:C((()=>l[9]||(l[9]=[E(" 保存数据 ")]))),_:1,__:[9]},8,["loading","disabled"])])),_:1})])),_:1})])]),U("div",A,[M(a,{headers:le,items:re.value,loading:H.value,density:"comfortable",class:"hr-kpi-table hr-data-table frozen-header-table","fixed-header":!0,"hide-default-footer":"","items-per-page":-1,height:"calc(100vh - 280px)"},{"item.description":C((({item:e})=>[U("div",N,K(e.description),1)])),"item.area":C((({item:e})=>{return[M(m,{color:(a=e.area,{TJM:"primary",TJC:"secondary","汇总":"success"}[a]||"default"),size:"small",variant:"flat"},{default:C((()=>[E(K(e.area),1)])),_:2},1032,["color"])];var a})),"item.actual_value":C((({item:e})=>[M(p,{modelValue:e.actual_value,"onUpdate:modelValue":a=>e.actual_value=a,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",variant:"outlined",density:"compact","hide-details":"",class:"text-field-small",onInput:se},null,8,["modelValue","onUpdate:modelValue"])])),"item.ytd_value":C((({item:e})=>[M(p,{modelValue:e.ytd_value,"onUpdate:modelValue":a=>e.ytd_value=a,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",variant:"outlined",density:"compact","hide-details":"",class:"text-field-small",onInput:se},null,8,["modelValue","onUpdate:modelValue"])])),"item.target_value":C((({item:e})=>[U("div",D,[M(m,{color:e.target_value>0?"success":"grey",size:"small",variant:"flat"},{default:C((()=>{return[E(K((a=e.target_value,0===a?"0":a.toLocaleString())),1)];var a})),_:2},1032,["color"])])])),"item.remark":C((({item:e})=>[oe(e)?(J(),j("div",Y,[M(_,{size:"small",variant:"outlined",color:"warning","prepend-icon":"mdi-clipboard-edit",onClick:a=>(e=>{ee.value=e,W.value=!0})(e)},{default:C((()=>[E(K(me(e)),1)])),_:2},1032,["onClick"]),S(n)(e)?(J(),T(v,{key:0,color:"success",class:"ml-2"},{default:C((()=>l[10]||(l[10]=[E(" mdi-check-circle ")]))),_:1,__:[10]})):I("",!0)])):(J(),j("div",F,[M(v,null,{default:C((()=>l[11]||(l[11]=[E("mdi-check-circle")]))),_:1,__:[11]}),l[12]||(l[12]=U("div",{class:"text-caption"}," 达标 ",-1))]))])),_:1},8,["items","loading"])]),M(y,{modelValue:B.value,"onUpdate:modelValue":l[3]||(l[3]=e=>B.value=e),timeout:3e3,color:"warning",location:"bottom","multi-line":"",class:"change-alert"},{actions:C((()=>[M(_,{color:"white",variant:"text",onClick:l[2]||(l[2]=e=>B.value=!1)},{default:C((()=>l[13]||(l[13]=[E(" 关闭 ")]))),_:1,__:[13]})])),default:C((()=>[l[14]||(l[14]=E(" 数据已修改，请记得保存 "))])),_:1,__:[14]},8,["modelValue"]),M(h,{modelValue:G.value,"onUpdate:modelValue":l[5]||(l[5]=e=>G.value=e),"max-width":"800px",persistent:""},{default:C((()=>[M(f,null,{default:C((()=>[M(g,{class:"text-h5 bg-primary text-white"},{default:C((()=>[M(v,{start:""},{default:C((()=>l[15]||(l[15]=[E(" mdi-target ")]))),_:1,__:[15]}),E(" 设置人力资源KPI目标值 ("+K(Z.value)+"年) ",1)])),_:1}),M(k,{class:"pa-6"},{default:C((()=>[M(a,{headers:ie,items:R.value,density:"compact","hide-default-footer":""},{"item.target_value":C((({item:e})=>[M(p,{modelValue:e.target_value,"onUpdate:modelValue":a=>e.target_value=a,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["items"])])),_:1}),M(x,{class:"pa-6 pt-0"},{default:C((()=>[M(d),M(_,{color:"grey",variant:"outlined",onClick:l[4]||(l[4]=e=>G.value=!1)},{default:C((()=>l[16]||(l[16]=[E(" 取消 ")]))),_:1,__:[16]}),M(_,{color:"primary",variant:"elevated",loading:Q.value,onClick:ve},{default:C((()=>l[17]||(l[17]=[E(" 保存目标值 ")]))),_:1,__:[17]},8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),M(o,{modelValue:W.value,"onUpdate:modelValue":l[6]||(l[6]=e=>W.value=e),item:ee.value,title:"原因分析与行动计划",onSave:pe},null,8,["modelValue","item"])])),_:1}))}},[["__scopeId","data-v-67a5d409"]]);export{P as default};
