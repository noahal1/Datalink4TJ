import{r as e,N as a,ae as l,ad as s,ac as u,H as o,a4 as t,a9 as r,K as n,ab as d,af as i,ak as c,X as m}from"./chunk-vendors.D0_dqILu.js";import{_ as v,u as f,a as p,M as g}from"./entry-index.D92NaooR.js";import{y as _,u as h,z as b,A as y,V,e as I,g as k,W as S,Z as j,_ as w,h as x,j as U,k as K}from"./chunk-vue-core.CxEQweee.js";import"./chunk-utils-vendor.DVew6AbD.js";import"./chunk-chart-core.HkgdsJMe.js";const N={class:"d-flex justify-space-between align-center mb-4"},P={key:0,class:"error-message mb-4"},q=v({__name:"Login",setup(v){const q=e(""),J=e(""),O=e(!1),z=e(!1),A=e(!1),C=e(""),F=f(),H=p(),L=h();a((()=>{const e=localStorage.getItem("userInfo");if(e)try{const a=JSON.parse(e);q.value=a.username||"",J.value=a.password||"",O.value=!0}catch(a){localStorage.removeItem("userInfo")}}));const M=async()=>{try{if(C.value="",A.value=!0,!q.value||!J.value)return C.value=q.value?"请输入密码":"请输入用户名",void(A.value=!1);if(await F.login(q.value,J.value)){await H.initPermissions(),O.value?localStorage.setItem("userInfo",JSON.stringify({username:q.value,password:J.value})):localStorage.removeItem("userInfo");const e=sessionStorage.getItem("redirectPath")||"/";sessionStorage.removeItem("redirectPath"),L.replace(e),g.success("登录成功")}}catch(e){let a="登录失败，请检查登录信息";e.message&&e.message.includes("用户名或密码不正确")?a="登录信息有误，请重试":e.message&&(a=e.message),C.value=a,g.error(a)}finally{A.value=!1}};return(e,a)=>(u(),l(_,{class:"fill-height",fluid:""},{default:s((()=>[o(b,{align:"center",justify:"center"},{default:s((()=>[o(y,{cols:"12",sm:"8",md:"4"},{default:s((()=>[o(V,{class:"elevation-12 login-card"},{default:s((()=>[o(I,{class:"headline text-center mb-4"},{default:s((()=>a[4]||(a[4]=[t(" 欢迎登录 ")]))),_:1,__:[4]}),o(k,null,{default:s((()=>[o(S,{ref:"loginForm",modelValue:z.value,"onUpdate:modelValue":a[3]||(a[3]=e=>z.value=e),onSubmit:r(M,["prevent"])},{default:s((()=>[o(j,{modelValue:q.value,"onUpdate:modelValue":a[0]||(a[0]=e=>q.value=e),label:"用户名","prepend-icon":"mdi-account",required:"",outlined:"",dense:"",rules:[e=>!!e||"用户名不能为空"],class:"mb-4",onKeyup:c(M,["enter"])},null,8,["modelValue","rules"]),o(j,{modelValue:J.value,"onUpdate:modelValue":a[1]||(a[1]=e=>J.value=e),label:"密码",type:"password","prepend-icon":"mdi-lock",required:"",outlined:"",dense:"",rules:[e=>!!e||"密码不能为空"],class:"mb-4",onKeyup:c(M,["enter"])},null,8,["modelValue","rules"]),n("div",N,[o(w,{modelValue:O.value,"onUpdate:modelValue":a[2]||(a[2]=e=>O.value=e),label:"记住密码","hide-details":"",class:"mt-0 pt-0"},null,8,["modelValue"])]),C.value?(u(),d("div",P,m(C.value),1)):i("",!0)])),_:1},8,["modelValue"])])),_:1}),o(x,null,{default:s((()=>[o(U),o(K,{color:"primary",block:"",loading:A.value,disabled:!z.value||A.value,height:"48",onClick:M},{default:s((()=>a[5]||(a[5]=[t(" 登录 ")]))),_:1,__:[5]},8,["loading","disabled"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}))}},[["__scopeId","data-v-44887e16"]]);export{q as default};
