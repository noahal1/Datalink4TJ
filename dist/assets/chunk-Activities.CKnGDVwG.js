import{U as e,f as a,b as t}from"./entry-index.D92NaooR.js";import{u as l}from"./chunk-useNotification.BHip036b.js";import{A as i,k as s,$ as u,j as o,Z as r,z as n,V as d,e as m,f as c,g as v,aa as p,h as y,F as f}from"./chunk-vue-core.CxEQweee.js";import{r as _,N as h,ab as b,ac as g,H as T,ad as V,a4 as k,X as w,K as A}from"./chunk-vendors.D0_dqILu.js";import"./chunk-utils-vendor.DVew6AbD.js";import"./chunk-chart-core.HkgdsJMe.js";const E={__name:"Activities",setup(E){const{showError:D}=l(),U=[{title:"时间",key:"timestamp",align:"start",sortable:!0},{title:"用户",key:"user",align:"start",sortable:!0},{title:"标题",key:"title",align:"start",sortable:!0},{title:"操作",key:"action",align:"start",sortable:!0},{title:"详情",key:"details",align:"start",sortable:!1},{title:"类型",key:"type",align:"center",sortable:!0},{title:"部门",key:"department",align:"center",sortable:!0}],F=_([]),O=_([]),L=_(!1),x=_(""),C=_(!1),j=_([]),P=_([]),N=_(["LOGIN","LOGOUT","CREATE","UPDATE","DELETE","UPLOAD","EXPORT"]),z=_({user:null,action:null,type:null,dateFrom:null,dateTo:null}),G=async()=>{L.value=!0;try{const e={};if(z.value.user&&(e.user_name=z.value.user),z.value.action&&(e.type=z.value.action),z.value.type&&(e.type=z.value.type),z.value.dateFrom&&z.value.dateTo){const a=new Date(z.value.dateFrom),t=new Date(z.value.dateTo),l=Math.abs(t-a),i=Math.ceil(l/864e5);e.days=i}else if(z.value.dateFrom){const a=new Date(z.value.dateFrom),t=new Date,l=Math.abs(t-a),i=Math.ceil(l/864e5);e.days=i}e.skip=0,e.limit=50;const a=await t.get("/activities/",{params:e});let l=[];if(a&&a.data?a.data.items&&Array.isArray(a.data.items)?l=a.data.items:Array.isArray(a.data)&&(l=a.data):a&&a.items&&Array.isArray(a.items)?l=a.items:a&&Array.isArray(a)&&(l=a),l.length>0)F.value=l,O.value=[...l];else{F.value=[],O.value=[];const e=[{id:1,timestamp:"2025-06-09T10:30:00",username:"admin",action:"登录",details:"系统管理员登录",status:"成功",ip:"192.168.1.100"},{id:2,timestamp:"2025-06-09T11:15:22",username:"admin",action:"创建用户",details:"创建用户: user1",status:"成功",ip:"192.168.1.100"},{id:3,timestamp:"2025-06-09T11:20:45",username:"admin",action:"修改权限",details:"修改用户 user1 的权限",status:"成功",ip:"192.168.1.100"},{id:4,timestamp:"2025-06-09T13:05:30",username:"user1",action:"登录",details:"用户首次登录",status:"成功",ip:"192.168.1.120"},{id:5,timestamp:"2025-06-09T13:10:12",username:"user1",action:"数据提交",details:"提交质量报告",status:"成功",ip:"192.168.1.120"}];F.value=e,O.value=[...e]}M()}catch(e){D("获取活动记录失败"),F.value=[],O.value=[]}finally{L.value=!1}},M=()=>{const e=new Set(F.value.map((e=>e.username)));j.value=Array.from(e);const a=new Set(F.value.map((e=>e.action)));P.value=Array.from(a)},R=()=>{if(C.value=!1,z.value.user||z.value.action||z.value.status||z.value.dateFrom||z.value.dateTo){const e=O.value.filter((e=>{let a=!0;if(z.value.user&&e.username!==z.value.user&&(a=!1),z.value.action&&e.action!==z.value.action&&(a=!1),z.value.type&&e.type!==z.value.type&&(a=!1),z.value.dateFrom||z.value.dateTo){const t=new Date(e.timestamp);if(z.value.dateFrom){t<new Date(z.value.dateFrom)&&(a=!1)}if(z.value.dateTo){const e=new Date(z.value.dateTo);e.setHours(23,59,59,999),t>e&&(a=!1)}}return a}));F.value=e}else F.value=[...O.value]},H=()=>{z.value={user:null,action:null,status:null,dateFrom:null,dateTo:null},F.value=[...O.value]},S=e=>{if(!e)return"";try{return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(a){return e}};return h((()=>{G()})),(t,l)=>(g(),b("div",null,[T(n,null,{default:V((()=>[T(i,{cols:"12"},{default:V((()=>[T(e,{title:"活动日志",icon:"mdi-clock-outline",headers:U,items:F.value,loading:L.value,search:x.value,"items-per-page":10},{title:V((()=>[l[9]||(l[9]=A("span",null,"活动日志",-1)),T(o),T(r,{modelValue:x.value,"onUpdate:modelValue":l[0]||(l[0]=e=>x.value=e),"append-icon":"mdi-magnify",label:"搜索","single-line":"","hide-details":"",density:"compact",class:"ml-4",style:{"max-width":"300px"}},null,8,["modelValue"])])),"item.timestamp":V((({item:e})=>[k(w(S(e.timestamp)),1)])),"item.type":V((({item:e})=>{return[T(u,{color:(a=e.type,{LOGIN:"success",LOGOUT:"warning",CREATE:"success",UPDATE:"primary",DELETE:"error",UPLOAD:"info",EXPORT:"secondary"}[a]||"grey"),size:"small",class:"text-white"},{default:V((()=>[k(w(e.type),1)])),_:2},1032,["color"])];var a})),actions:V((()=>[T(s,{color:"primary","prepend-icon":"mdi-filter",onClick:l[1]||(l[1]=e=>C.value=!0)},{default:V((()=>l[10]||(l[10]=[k(" 筛选 ")]))),_:1,__:[10]}),T(s,{class:"ml-2",color:"secondary","prepend-icon":"mdi-refresh",onClick:G},{default:V((()=>l[11]||(l[11]=[k(" 刷新 ")]))),_:1,__:[11]})])),_:1},8,["items","loading","search"])])),_:1})])),_:1}),T(f,{modelValue:C.value,"onUpdate:modelValue":l[8]||(l[8]=e=>C.value=e),location:"right",temporary:"",width:"300"},{default:V((()=>[T(d,{class:"h-100"},{default:V((()=>[T(m,{class:"bg-primary text-white"},{default:V((()=>[T(c,{class:"mr-2",color:"white"},{default:V((()=>l[12]||(l[12]=[k(" mdi-filter ")]))),_:1,__:[12]}),l[14]||(l[14]=k(" 筛选条件 ")),T(o),T(s,{icon:"",variant:"text",color:"white",size:"small",onClick:l[2]||(l[2]=e=>C.value=!1)},{default:V((()=>[T(c,null,{default:V((()=>l[13]||(l[13]=[k("mdi-close")]))),_:1,__:[13]})])),_:1})])),_:1,__:[14]}),T(v,{class:"pt-4"},{default:V((()=>[T(a,null,{default:V((()=>[T(p,{modelValue:z.value.user,"onUpdate:modelValue":l[3]||(l[3]=e=>z.value.user=e),items:j.value,label:"用户",variant:"outlined",density:"comfortable",clearable:""},null,8,["modelValue","items"]),T(p,{modelValue:z.value.action,"onUpdate:modelValue":l[4]||(l[4]=e=>z.value.action=e),items:P.value,label:"操作类型",variant:"outlined",density:"comfortable",clearable:""},null,8,["modelValue","items"]),T(p,{modelValue:z.value.type,"onUpdate:modelValue":l[5]||(l[5]=e=>z.value.type=e),items:N.value,label:"类型",variant:"outlined",density:"comfortable",clearable:""},null,8,["modelValue","items"]),T(r,{modelValue:z.value.dateFrom,"onUpdate:modelValue":l[6]||(l[6]=e=>z.value.dateFrom=e),label:"开始日期",type:"date",variant:"outlined",density:"comfortable",clearable:""},null,8,["modelValue"]),T(r,{modelValue:z.value.dateTo,"onUpdate:modelValue":l[7]||(l[7]=e=>z.value.dateTo=e),label:"结束日期",type:"date",variant:"outlined",density:"comfortable",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),T(y,{class:"py-3"},{default:V((()=>[T(o),T(s,{variant:"text",color:"grey",onClick:H},{default:V((()=>l[15]||(l[15]=[k(" 清除筛选 ")]))),_:1,__:[15]}),T(s,{color:"primary",onClick:R},{default:V((()=>l[16]||(l[16]=[k(" 应用筛选 ")]))),_:1,__:[16]})])),_:1})])),_:1})])),_:1},8,["modelValue"])]))}};export{E as default};
