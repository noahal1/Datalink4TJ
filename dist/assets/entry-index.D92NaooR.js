const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["/assets/chunk-Dashboard.6noHJRny.js","/assets/chunk-vue-core.CxEQweee.js","/assets/chunk-vendors.D0_dqILu.js","/assets/css/vendors.CYg2uPei.css","/assets/chunk-chart-core.HkgdsJMe.js","/assets/css/vue-core.BMFs3-do.css","/assets/chunk-date-vendor.DjLOnOdQ.js","/assets/chunk-utils-vendor.DVew6AbD.js","/assets/css/Dashboard.BV0uFGtl.css","/assets/chunk-Login.yOGsXiYG.js","/assets/css/Login.B-ofXc4d.css","/assets/chunk-Profile.CDP-f7Co.js","/assets/css/Profile.B--s5Tle.css","/assets/chunk-Settings.9xAtvuCD.js","/assets/css/Settings.Cb2bRhNl.css","/assets/chunk-DefaultLayout.CI8X5kMu.js","/assets/chunk-Users.B00gJ687.js","/assets/chunk-useNotification.BHip036b.js","/assets/css/Users.8pjNzOCz.css","/assets/chunk-ComponentTest.DOradapS.js","/assets/chunk-EHS.BlGuugOA.js","/assets/css/EHS.BGhHxl8L.css","/assets/chunk-Assy.DXyI5Ybj.js","/assets/chunk-Quality.6aQAlgYw.js","/assets/css/Quality.-FLpG6dH.css","/assets/chunk-QualityKpi.uhSNJctr.js","/assets/chunk-kpiUtils.CSbvtC9I.js","/assets/css/kpiUtils.D-TDGD5_.css","/assets/css/QualityKpi.ieytyqdf.css","/assets/chunk-EhsKpi.qJbSnv7u.js","/assets/css/EhsKpi.DqwTTqa4.css","/assets/chunk-MaintenanceKpi.CnbdqxNB.js","/assets/css/MaintenanceKpi.Cw_xS1Y9.css","/assets/chunk-ProductionKpi.DrRF-EBu.js","/assets/css/ProductionKpi.DdWZosqw.css","/assets/chunk-GmoKpi.BndFztTA.js","/assets/css/GmoKpi.CEC1pu2Q.css","/assets/chunk-KpiExport.iGguE91T.js","/assets/css/KpiExport.3-BpepR3.css","/assets/chunk-EngKpi.C-adtQYW.js","/assets/css/EngKpi.DKL0RuK-.css","/assets/chunk-PrsKpi.CnikfS2F.js","/assets/css/PrsKpi.BR4Qs4yG.css","/assets/chunk-HrKpi.DlDT5jE4.js","/assets/css/HrKpi.D14vT2-V.css","/assets/chunk-LogisticsKpi.BZKTTdPq.js","/assets/css/LogisticsKpi.DXd9QSb0.css","/assets/chunk-DohDaily.z1OqJUyF.js","/assets/css/DohDaily.8QdbnZIv.css","/assets/chunk-DohMasterData.DWn9rhwP.js","/assets/css/DohMasterData.C1lu-uuH.css","/assets/chunk-Pcl.DcF1-KWR.js","/assets/chunk-Admin.BCBZnGyb.js","/assets/css/Admin.oAGTFxbe.css","/assets/chunk-Gmo.Bl1t-4OD.js","/assets/chunk-Maintenance.CaITQaq4.js","/assets/chunk-MetricsDialog.CtvwZDTF.js","/assets/css/MetricsDialog.BRx4Z1su.css","/assets/css/Maintenance.YnRo3jEO.css","/assets/chunk-MaintenanceMetrics.Bwb6PBTA.js","/assets/css/MaintenanceMetrics.D96Gq96g.css","/assets/chunk-MaterialManagement.C_djd8zf.js","/assets/css/MaterialManagement.Bg0OAZkp.css","/assets/chunk-PrManagement.C5ArnJPf.js","/assets/css/PrManagement.BieCOqE7.css","/assets/chunk-DowntimeRecords.Dy6ugIy_.js","/assets/chunk-Events.D3uhd3tS.js","/assets/css/Events.8Rhrwlwh.css","/assets/chunk-RouteManagement.CJDr6f7H.js","/assets/css/RouteManagement.BTXMASMm.css","/assets/chunk-PermissionManagement.CXXc2z4u.js","/assets/css/PermissionManagement.vM46oGfx.css","/assets/chunk-Departments.BjGydCqd.js","/assets/chunk-Activities.CKnGDVwG.js","/assets/chunk-RouteDebug.BKLKt1Tp.js"])))=>i.map(i=>d[i]);
import{i as e,u as t,t as r,r as a,N as s,ab as i,ac as n,H as o,ad as l,J as c,ae as u,af as d,a4 as m,X as h,d as p,w as f,K as g,F as y,ag as v,W as _,ah as w,$ as b,I as E,D as k,a1 as P,U as R,V as S,ai as A,a5 as D,a6 as T,a9 as L,p as I,aj as C}from"./chunk-vendors.D0_dqILu.js";import{d as M,c as $,a as x,b as O,i as U,V as N,e as j,f as V,g as F,h as B,j as z,k as W,l as q,m as H,u as K,n as J,o as G,p as Q,q as Y,r as X,s as Z,R as ee,t as te,v as re,w as ae,x as se,y as ie,z as ne,A as oe,B as le,C as ce,D as ue,E as de,F as me,G as he,H as pe,I as fe,J as ge,K as ye,L as ve,M as _e,N as we,O as be,P as Ee,Q as ke,S as Pe,T as Re,U as Se,W as Ae,X as De,Y as Te}from"./chunk-vue-core.CxEQweee.js";import{a as Le}from"./chunk-utils-vendor.DVew6AbD.js";import{u as Ie,a as Ce,b as Me,c as $e,d as xe,e as Oe,f as Ue,g as Ne,h as je,j as Ve,k as Fe,l as Be,m as ze,n as We,o as qe,p as He,q as Ke}from"./chunk-chart-core.HkgdsJMe.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const Je={},Ge=function(e,t,r){let a=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link"),s=document.querySelector("meta[property=csp-nonce]"),i=(null==s?void 0:s.nonce)||(null==s?void 0:s.getAttribute("nonce"));a=Promise.allSettled(t.map((t=>{if(t=function(e,t){return new URL(e,t).href}(t,r),t in Je)return;Je[t]=!0;const a=t.endsWith(".css"),s=a?'[rel="stylesheet"]':"";if(!!r)for(let r=e.length-1;r>=0;r--){const s=e[r];if(s.href===t&&(!a||"stylesheet"===s.rel))return}else if(document.querySelector(`link[href="${t}"]${s}`))return;const n=document.createElement("link");return n.rel=a?"stylesheet":"modulepreload",a||(n.as="script"),n.crossOrigin="",n.href=t,i&&n.setAttribute("nonce",i),document.head.appendChild(n),a?new Promise(((e,r)=>{n.addEventListener("load",e),n.addEventListener("error",(()=>r(new Error(`Unable to preload CSS for ${t}`))))})):void 0})))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then((t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)}))},Qe={events:{},on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),()=>this.off(e,t)},emit(e,t){this.events[e]&&this.events[e].forEach((e=>{try{e(t)}catch(r){}}))},off(e,t){this.events[e]&&(t?this.events[e]=this.events[e].filter((e=>e!==t)):delete this.events[e])},once(e,t){const r=a=>{t(a),this.off(e,r)};this.on(e,r)}};function Ye(e){"string"==typeof e&&(e={message:e});const{message:t,type:r="info",duration:a=3e3}=e;if(window)try{const e=null==window?void 0:window.__VUE_APP__;if(e&&e.$notify)return void e.$notify[r||"info"](t,a);window.$snackbar&&window.$snackbar.show({text:t,color:r,timeout:a,location:"bottom right"})}catch(s){}}const Xe={success:(e,t=3e3)=>Ye({message:e,type:"success",duration:t}),error:(e,t=3e3)=>Ye({message:e,type:"error",duration:t}),warning:(e,t=3e3)=>Ye({message:e,type:"warning",duration:t}),info:(e,t=3e3)=>Ye({message:e,type:"info",duration:t})},Ze=Object.freeze(Object.defineProperty({__proto__:null,default:Xe},Symbol.toStringTag,{value:"Module"})),et=M("permission",{state:()=>({roles:[],accessibleRoutesList:[],loading:!1,isInitialized:!1,permissionsLoaded:!1}),getters:{hasRole:()=>e=>{const t=Jt();if(!t.isLogin)return!1;const r=t.roles.includes(e);return r},isSuperUser:()=>{const e=Jt();return e.roles.includes("超级管理员")||e.roles.includes("管理员")},accessibleRoutes:e=>e.accessibleRoutesList||[],canAccessRoute:e=>t=>{const r=Jt();if(r.roles.includes("超级管理员")||r.roles.includes("管理员"))return!0;if(["/dashboard","/profile","/settings"].includes(t)&&r.isLogin)return!0;if(e.loading||!e.permissionsLoaded)return!1;if(e.accessibleRoutesList&&e.accessibleRoutesList.length>0){const r=e.accessibleRoutesList.some((e=>e.path===t));return r}return!1}},actions:{async initPermissions(){if(!this.isInitialized)try{this.loading=!0,this.permissionsLoaded=!1;if(!Jt().isLogin)return void(this.loading=!1);await this.fetchUserRoutes(),this.isInitialized=!0,this.permissionsLoaded=!0}catch(e){this.permissionsLoaded=!1}finally{this.loading=!1}},async fetchUserRoutes(){try{const e=await Lt.get("/user-routes");this.accessibleRoutesList=e.data||[],this.accessibleRoutesList.length,this.accessibleRoutesList.map((e=>e.path)),localStorage.setItem("accessibleRoutes",JSON.stringify(this.accessibleRoutesList)),this.permissionsLoaded=!0}catch(e){const r=localStorage.getItem("accessibleRoutes");if(r)try{this.accessibleRoutesList=JSON.parse(r),this.permissionsLoaded=!0}catch(t){this.accessibleRoutesList=[],this.permissionsLoaded=!1}else this.accessibleRoutesList=[],this.permissionsLoaded=!1;throw e}},async checkRouteAccess(e){try{return(await Lt.post("/permissions/check-route-access",null,{params:{route_path:e}})).data.has_access||!1}catch(t){return!1}},clearPermissions(){this.roles=[],this.accessibleRoutesList=[],this.isInitialized=!1,this.permissionsLoaded=!1,localStorage.removeItem("accessibleRoutes")},async refreshPermissions(){this.isInitialized=!1,this.permissionsLoaded=!1,await this.initPermissions()}}}),tt=e=>Jt().isLogin,rt=[{path:"/",redirect:"/dashboard"},{path:"/dashboard",component:()=>Ge((()=>import("./chunk-Dashboard.6noHJRny.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url),meta:{title:"首页",requiresAuth:!0}},{path:"/login",component:()=>Ge((()=>import("./chunk-Login.yOGsXiYG.js")),__vite__mapDeps([9,2,3,1,4,5,7,10]),import.meta.url),meta:{title:"登录",public:!0}},{path:"/profile",component:()=>Ge((()=>import("./chunk-Profile.CDP-f7Co.js")),__vite__mapDeps([11,1,2,3,4,5,7,12]),import.meta.url),meta:{title:"个人资料",requiresAuth:!0}},{path:"/settings",component:()=>Ge((()=>import("./chunk-Settings.9xAtvuCD.js")),__vite__mapDeps([13,1,2,3,4,5,7,14]),import.meta.url),meta:{title:"系统设置",requiresAuth:!0}},{path:"/:pathMatch(.*)*",redirect:"/dashboard"}],at={DefaultLayout:()=>Ge((()=>import("./chunk-DefaultLayout.CI8X5kMu.js")),__vite__mapDeps([15,1,2,3,4,5]),import.meta.url),AdminUser:()=>Ge((()=>import("./chunk-Users.B00gJ687.js")),__vite__mapDeps([16,1,2,3,4,5,17,7,18]),import.meta.url),Dashboard:()=>Ge((()=>import("./chunk-Dashboard.6noHJRny.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url),ComponentTest:()=>Ge((()=>import("./chunk-ComponentTest.DOradapS.js")),__vite__mapDeps([19,1,2,3,4,5,7]),import.meta.url),EHS:()=>Ge((()=>import("./chunk-EHS.BlGuugOA.js")),__vite__mapDeps([20,1,2,3,4,5,6,7,21]),import.meta.url),Assy:()=>Ge((()=>import("./chunk-Assy.DXyI5Ybj.js")),__vite__mapDeps([22,1,2,3,4,5,7]),import.meta.url),Quality:()=>Ge((()=>import("./chunk-Quality.6aQAlgYw.js")),__vite__mapDeps([23,1,2,3,4,5,7,24]),import.meta.url),QualityKpi:()=>Ge((()=>import("./chunk-QualityKpi.uhSNJctr.js")),__vite__mapDeps([25,26,1,2,3,4,5,27,7,28]),import.meta.url),EhsKpi:()=>Ge((()=>import("./chunk-EhsKpi.qJbSnv7u.js")),__vite__mapDeps([29,26,1,2,3,4,5,27,7,30]),import.meta.url),MaintenanceKpi:()=>Ge((()=>import("./chunk-MaintenanceKpi.CnbdqxNB.js")),__vite__mapDeps([31,26,1,2,3,4,5,27,7,32]),import.meta.url),ProductionKpi:()=>Ge((()=>import("./chunk-ProductionKpi.DrRF-EBu.js")),__vite__mapDeps([33,26,1,2,3,4,5,27,7,34]),import.meta.url),GmoKpi:()=>Ge((()=>import("./chunk-GmoKpi.BndFztTA.js")),__vite__mapDeps([35,26,1,2,3,4,5,27,7,36]),import.meta.url),KpiExport:()=>Ge((()=>import("./chunk-KpiExport.iGguE91T.js")),__vite__mapDeps([37,2,3,1,4,5,7,38]),import.meta.url),EngKpi:()=>Ge((()=>import("./chunk-EngKpi.C-adtQYW.js")),__vite__mapDeps([39,26,1,2,3,4,5,27,7,40]),import.meta.url),PrsKpi:()=>Ge((()=>import("./chunk-PrsKpi.CnikfS2F.js")),__vite__mapDeps([41,26,1,2,3,4,5,27,7,42]),import.meta.url),HrKpi:()=>Ge((()=>import("./chunk-HrKpi.DlDT5jE4.js")),__vite__mapDeps([43,26,1,2,3,4,5,27,7,44]),import.meta.url),LogisticsKpi:()=>Ge((()=>import("./chunk-LogisticsKpi.BZKTTdPq.js")),__vite__mapDeps([45,26,1,2,3,4,5,27,7,46]),import.meta.url),DohDaily:()=>Ge((()=>import("./chunk-DohDaily.z1OqJUyF.js")),__vite__mapDeps([47,7,1,2,3,4,5,48]),import.meta.url),DohMaster:()=>Ge((()=>import("./chunk-DohMasterData.DWn9rhwP.js")),__vite__mapDeps([49,1,2,3,4,5,7,50]),import.meta.url),Pcl:()=>Ge((()=>import("./chunk-Pcl.DcF1-KWR.js")),__vite__mapDeps([51,1,2,3,4,5,7]),import.meta.url),Admin:()=>Ge((()=>import("./chunk-Admin.BCBZnGyb.js")),__vite__mapDeps([52,1,2,3,4,5,7,53]),import.meta.url),Gmo:()=>Ge((()=>import("./chunk-Gmo.Bl1t-4OD.js")),__vite__mapDeps([54,1,2,3,4,5,7]),import.meta.url),Maintenance:()=>Ge((()=>import("./chunk-Maintenance.CaITQaq4.js")),__vite__mapDeps([55,1,2,3,4,5,56,57,7,58]),import.meta.url),MaintenanceMetrics:()=>Ge((()=>import("./chunk-MaintenanceMetrics.Bwb6PBTA.js")),__vite__mapDeps([59,56,1,2,3,4,5,57,6,7,60]),import.meta.url),MaterialManagement:()=>Ge((()=>import("./chunk-MaterialManagement.C_djd8zf.js")),__vite__mapDeps([61,2,3,1,4,5,7,62]),import.meta.url),PrManagement:()=>Ge((()=>import("./chunk-PrManagement.C5ArnJPf.js")),__vite__mapDeps([63,2,3,1,4,5,7,64]),import.meta.url),DowntimeRecords:()=>Ge((()=>import("./chunk-DowntimeRecords.Dy6ugIy_.js")),__vite__mapDeps([65,1,2,3,4,5,7]),import.meta.url),Events:()=>Ge((()=>import("./chunk-Events.D3uhd3tS.js")),__vite__mapDeps([66,2,3,1,4,5,6,7,67]),import.meta.url),RouteManagement:()=>Ge((()=>import("./chunk-RouteManagement.CJDr6f7H.js")),__vite__mapDeps([68,2,3,7,1,4,5,69]),import.meta.url),PermissionManagement:()=>Ge((()=>import("./chunk-PermissionManagement.CXXc2z4u.js")),__vite__mapDeps([70,1,2,3,4,5,17,7,71]),import.meta.url),SimplePermissionManagement:()=>Ge((()=>import("./chunk-PermissionManagement.CXXc2z4u.js")),__vite__mapDeps([70,1,2,3,4,5,17,7,71]),import.meta.url),AdminDepartments:()=>Ge((()=>import("./chunk-Departments.BjGydCqd.js")),__vite__mapDeps([72,17,2,3,1,4,5,7]),import.meta.url),AdminActivities:()=>Ge((()=>import("./chunk-Activities.CKnGDVwG.js")),__vite__mapDeps([73,17,2,3,1,4,5,7]),import.meta.url),AdminUser:()=>Ge((()=>import("./chunk-Users.B00gJ687.js")),__vite__mapDeps([16,1,2,3,4,5,17,7,18]),import.meta.url),Login:()=>Ge((()=>import("./chunk-Login.yOGsXiYG.js")),__vite__mapDeps([9,2,3,1,4,5,7,10]),import.meta.url),RouteDebug:()=>Ge((()=>import("./chunk-RouteDebug.BKLKt1Tp.js")),__vite__mapDeps([74,1,2,3,4,5,7]),import.meta.url),Profile:()=>Ge((()=>import("./chunk-Profile.CDP-f7Co.js")),__vite__mapDeps([11,1,2,3,4,5,7,12]),import.meta.url),Settings:()=>Ge((()=>import("./chunk-Settings.9xAtvuCD.js")),__vite__mapDeps([13,1,2,3,4,5,7,14]),import.meta.url)};function st(){return Object.keys(at)}function it(e){const t=st(),r=[],a=[];return e&&Array.isArray(e)&&e.forEach((e=>{"string"!=typeof e||t.includes(e)||r.push(e)})),t.forEach((t=>{"DefaultLayout"===t||e&&e.includes(t)||a.push(t)})),{totalMapped:t.length,totalFromApi:e?e.length:0,missingInMap:r,missingInApi:a,isConsistent:0===r.length&&0===a.length}}function nt(e){return e&&e.path?(e.name||(e.name=e.path.replace(/\//g,"_").replace(/:/g,"_param_"),e.name.startsWith("_")&&(e.name=e.name.substring(1))),e.component&&("string"==typeof e.component&&at[e.component]?e.component=at[e.component]:"string"==typeof e.component&&(e.component=at.DefaultLayout)),e.children&&Array.isArray(e.children)&&(e.children=e.children.map((e=>nt(e))).filter((e=>null!==e))),e):null}async function ot(e){try{const t=await e.getNavigationTree();if(!t||!Array.isArray(t))return[];const r=e=>{const t=[];return e.forEach((e=>{e.component&&"string"==typeof e.component&&t.push(e.component),e.children&&Array.isArray(e.children)&&t.push(...r(e.children))})),[...new Set(t)]},a=it(r(t));a.isConsistent||(a.missingInMap.length,a.missingInApi.length);return t.map((e=>nt(e))).filter((e=>null!==e))}catch(t){return[]}}const lt=Object.freeze(Object.defineProperty({__proto__:null,componentMap:at,fetchDynamicRoutes:ot,getAvailableComponents:st,processRoute:nt,validateComponentMapping:it},Symbol.toStringTag,{value:"Module"})),ct=[...rt],ut=$({history:x(),routes:ct,scrollBehavior:(e,t,r)=>r||{top:0}});let dt=!1,mt=!1;async function ht(){if(dt||mt)return[];mt=!0;try{const{routeService:e}=await Ge((async()=>{const{routeService:e}=await Promise.resolve().then((()=>Kt));return{routeService:e}}),void 0,import.meta.url),t=await ot(e);let r=0,a=0;return t.forEach((e=>{ut.getRoutes().find((t=>t.path===e.path))||ut.hasRoute(e.name)?a++:(ut.addRoute(e),r++)})),dt=!0,t}catch(e){return void 0!==Xe&&Xe.error("动态路由加载失败，请刷新页面重试"),[]}finally{mt=!1}}ut.beforeEach((async(e,t,r)=>{const a=Jt(),s=et();if(!dt&&!mt)try{await ht();if(ut.resolve(e.path).matched.length>0)return void r(e.path)}catch(n){}if(0===e.matched.length)return e.path,void r("/dashboard");const i=e.matched.some((e=>e.meta.requiresAuth));if(e.matched.some((e=>e.meta.public)))r();else try{if(!a.isAuthenticated){if(!(await a.initialize())&&i)return void r({path:"/login",query:{redirect:e.fullPath}})}if(a.isAuthenticated&&!s.isInitialized&&await s.initPermissions(),a.isAuthenticated&&s.loading){let e=0;for(;s.loading&&e<50;)await new Promise((e=>setTimeout(e,100))),e++}if(i&&"/dashboard"!==e.path){if(!s.canAccessRoute(e.path)&&!s.isSuperUser)return Xe.error("没有访问权限"),void r({path:"/dashboard"})}r()}catch(n){r({path:"/login"})}})),ut.afterEach((e=>{e.meta.title?document.title=`${e.meta.title} - Datalink4TJ`:document.title="Datalink4TJ"})),ut.onError((e=>{e.message.includes("Failed to fetch dynamically imported module")&&(setTimeout((async()=>{try{await ht()}catch(e){}}),1e3),void 0!==Xe&&Xe.error("页面加载失败，正在尝试重新加载..."))}));const pt=Object.freeze(Object.defineProperty({__proto__:null,addDynamicRoutes:ht,default:ut,resetDynamicRoutesState:()=>{dt=!1,mt=!1}},Symbol.toStringTag,{value:"Module"}));function ft(e,t="ID"){if(null==e)throw new Error(`${t} 不能为空`);if("number"==typeof e){if(Number.isInteger(e)&&e>0)return e;throw new Error(`${t} 必须是正整数`)}if("string"==typeof e){const r=e.trim();if(""===r)throw new Error(`${t} 不能为空字符串`);const a=parseInt(r,10);if(isNaN(a)||a<=0)throw new Error(`${t} 必须是有效的正整数`);return a}throw new Error(`${t} 类型无效，必须是数字或数字字符串`)}function gt(e,t="IDs"){if(!Array.isArray(e))throw new Error(`${t} 必须是数组`);return e.map(((e,r)=>{try{return ft(e,`${t}[${r}]`)}catch(a){throw new Error(`${t}[${r}]: ${a.message}`)}}))}function yt(e,t=[]){if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e;const r={...e};for(const s of t)if(s in r)try{s.endsWith("_ids")||s.endsWith("Ids")?r[s]=gt(r[s],s):r[s]=ft(r[s],s)}catch(a){throw a}return r}const vt=e=>{const t=(e=>{try{if(!e)return null;const t=JSON.parse(atob(e.split(".")[1]));return t.exp?1e3*t.exp:null}catch(t){return null}})(e);return!!t&&Date.now()>=t};function _t(a){if(null==a)return a;if(e(a)&&(a=t(a)),"object"==typeof a&&(a=r(a)),Array.isArray(a))return a.map((e=>_t(e)));if(a&&"object"==typeof a&&a.constructor===Object){const e={};for(const t in a)a.hasOwnProperty(t)&&(e[t]=_t(a[t]));return e}return a}function wt(e){if(!e)return e;if(e instanceof FormData||e instanceof File||e instanceof Blob)return e;const t=_t(e);if("object"==typeof t&&!Array.isArray(t)){const e={};for(const r in t)void 0!==t[r]&&null!==t[r]&&""!==t[r]&&(e[r]=t[r]);return e}return t}function bt(e,t={}){const{removeEmpty:r=!0,trimStrings:a=!0}=t,s=_t(e);if("object"!=typeof s||Array.isArray(s))return s;const i={};for(const n in s)if(s.hasOwnProperty(n)){let e=s[n];if(a&&"string"==typeof e&&(e=e.trim()),r&&(""===e||null==e))continue;i[n]=e}return i}const Et="http://localhost:8000/api/v1",kt=["/users/token","/login","/auth/login","/auth/register","/public"],Pt="api_cache_",Rt=Le.create({baseURL:Et,timeout:15e3}),St=e=>{try{const t=`${Pt}${e}`,r=sessionStorage.getItem(t);if(!r)return null;const{data:a,timestamp:s}=JSON.parse(r);return Date.now()-s>6e5?(sessionStorage.removeItem(t),null):a}catch(t){return null}};function At(e,t={}){const r={...{paramsSerializer:e=>Object.entries(e).map((([e,t])=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`)).join("&")},...t};return Rt.get(e,r)}function Dt(e,t={},r={}){if(t instanceof FormData){const a=Jt();return Le.post(`${Et}${e}`,t,{timeout:15e3,headers:{...a.token?{Authorization:`Bearer ${a.token}`}:{},...r.headers},...r})}const a=wt(t);return Rt.post(e,a,r)}function Tt(e,t={}){const r=wt(t);return Rt.put(e,r)}Rt.interceptors.request.use((e=>{const t=Jt();try{(e=function(e){const t={...e};t.url&&t.url.match(/\{(\w*_?id)\}/g);if(t.data&&"object"==typeof t.data)if(Array.isArray(t.data));else{const e=["id","user_id","role_id","permission_id","route_id","department_id","role_ids","permission_ids","user_ids"];try{t.data=yt(t.data,e)}catch(r){throw r}}if(t.params&&"object"==typeof t.params){const e=["id","user_id","role_id","permission_id","route_id","department_id"];try{t.params=yt(t.params,e)}catch(r){throw r}}return t}(e)).url}catch(a){}e.headers["Content-Type"]||(e.headers["Content-Type"]="application/json");const r=kt.some((t=>e.url.includes(t)));if(t.token){const r=t.token.trim();e.headers.Authorization=`Bearer ${r}`,e.method.toUpperCase(),e.url,vt(r)}else if(!r){if(e.method.toUpperCase(),e.url,"get"===e.method.toLowerCase()){const t=St(e.url);if(t)return e.url,Promise.reject({response:{status:200,data:t,config:e,headers:{},isCachedData:!0}})}if("/login"!==ut.currentRoute.value.path){Xe.warning("请先登录");const e=ut.currentRoute.value.path;return"/login"!==e&&(sessionStorage.setItem("redirectPath",e),ut.push("/login")),Promise.reject(new Error("未授权"))}}return e}),(e=>Promise.reject(e))),Rt.interceptors.response.use((e=>(e.config.method.toUpperCase(),e.config.url,"get"===e.config.method.toLowerCase()&&((e,t)=>{try{const r=`${Pt}${e}`,a={data:t,timestamp:Date.now()};sessionStorage.setItem(r,JSON.stringify(a))}catch(r){}})(e.config.url,e.data),e)),(e=>{var t;if(e.response&&e.response.isCachedData)return Promise.resolve(e.response);if(!e.response){if(Xe.error("网络错误，请检查您的网络连接"),e.config&&"get"===e.config.method.toLowerCase()){const t=St(e.config.url);if(t)return Promise.resolve({data:t,status:200,config:e.config,headers:{},fromCache:!0})}return Promise.reject(new Error("网络错误"))}const{status:r,config:a,data:s}=e.response;switch(r){case 401:if(a.url.includes("/users/token")&&!a.url.includes("/token/refresh"))Xe.error("用户名或密码错误");else{if("get"===a.method.toLowerCase()){const e=St(a.url);if(e)return Promise.resolve({data:e,status:200,config:a,headers:{},fromCache:!0})}a.url.includes("/token/refresh")||Xe.error("登录状态已过期，请刷新页面重新登录"),Xe.error("登录已过期，请重新登录");Jt().logout();const e=ut.currentRoute.value.path;"/login"!==e&&(sessionStorage.setItem("redirectPath",e),ut.push("/login"))}break;case 403:Xe.error("没有权限访问该资源");break;case 404:Xe.error("请求的资源不存在");break;case 422:let r="请求参数验证失败";if((null==s?void 0:s.detail)&&Array.isArray(s.detail)){r=`参数验证错误: ${s.detail.map((e=>`${e.loc.slice(1).join(".")}: ${e.msg}`)).join("; ")}`}else(null==s?void 0:s.detail)&&(r=s.detail);Xe.error(r);break;case 500:Xe.error("服务器错误，请联系管理员");break;default:const i=(null==(t=e.response.data)?void 0:t.detail)||"请求失败";Xe.error(i)}return Promise.reject(e)}));const Lt={get:At,post:Dt,put:Tt,patch:function(e,t={}){const r=wt(t);return Rt.patch(e,r)},delete:function(e){return Rt.delete(e)}};class It{constructor(e=""){this.baseEndpoint=e}async get(e="",t={}){const r=this._buildUrl(e);try{let e=r;if(Object.keys(t).length>0){const a=Object.keys(t).map((e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`)).join("&");e=`${r}${r.includes("?")?"&":"?"}${a}`}return(await Lt.get(e)).data}catch(a){throw this._handleError(a,"GET",r),a}}async post(e="",t={}){const r=this._buildUrl(e);try{return(await Lt.post(r,t)).data}catch(a){throw this._handleError(a,"POST",r),a}}async put(e="",t={}){const r=this._buildUrl(e);try{return(await Lt.put(r,t)).data}catch(a){throw this._handleError(a,"PUT",r),a}}async delete(e=""){const t=this._buildUrl(e);try{return(await Lt.delete(t)).data}catch(r){throw this._handleError(r,"DELETE",t),r}}_buildUrl(e){if(!e)return this.baseEndpoint;e.startsWith("/")&&(e=e.substring(1));let t=this.baseEndpoint;return t.endsWith("/")&&(t=t.slice(0,-1)),`${t}/${e}`}_handleError(e,t,r){var a,s;(null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.detail)||e.message}}const Ct=new class extends It{constructor(){super("/users")}async login(e,t){try{if("string"!=typeof e||"string"!=typeof t)throw new Error("用户名和密码必须是字符串");const r=new URLSearchParams;r.append("username",e),r.append("password",t);const a=(await Ge((async()=>{const{default:e}=await import("./chunk-utils-vendor.DVew6AbD.js").then((e=>e.i));return{default:e}}),[],import.meta.url)).default,s="http://localhost:8000/api/v1",i=(await a({method:"post",url:`${s}/users/token`,data:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}})).data;if(!i)throw new Error("服务器返回空响应");if(!i.access_token)throw new Error("登录响应格式错误");const n={...i};return n.access_token&&(n.access_token=n.access_token.substring(0,10)+"..."),{token:i.access_token,user_id:i.user_id,user_name:i.user_name,department:i.department,roles:i.roles||[]}}catch(r){if(r.response&&422===r.response.status){const e=r.response.data&&r.response.data.detail;let t="登录验证失败: ";throw Array.isArray(e)?t+=e.map((e=>`${e.loc.join(".")}: ${e.msg}`)).join("; "):t+="string"==typeof e?e:"用户名或密码格式不正确",new Error(t)}throw r.response&&401===r.response.status?new Error("用户名或密码不正确"):new Error("登录服务暂时不可用，请稍后再试")}}async getCurrentUser(){try{const e=await this.get("/me");return{id:e.user_id,name:e.user_name,username:e.user_name,department:e.department,roles:e.roles||[]}}catch(e){throw e}}async refreshToken(){try{const e=await this.post("/token/refresh");return{token:e.access_token,access_token:e.access_token,token_type:e.token_type,user_id:e.user_id,user_name:e.user_name}}catch(e){throw e}}async getUsers(e={}){return this.get("",e)}async getUser(e){return this.get(`/${e}`)}async createUser(e){return this.post("",e)}async updateUser(e,t){return this.put(`/${e}`,t)}async deleteUser(e){return this.delete(`/${e}`)}async changePassword(e){return this.post("/change-password",e)}async getUserPermissions(){return this.get("/permissions")}};const Mt=new class extends It{constructor(){super("")}async getPermissions(e={}){return this.get("/permissions",e)}async getPermission(e){return this.get(`/permissions/${e}`)}async createPermission(e){return this.post("/permissions",e)}async updatePermission(e,t){return this.put(`/permissions/${e}`,t)}async deletePermission(e){return this.delete(`/permissions/${e}`)}async getRoles(e={}){return this.get("/roles",e)}async getSimpleRoles(){return this.get("/simple-roles")}async getRole(e){return this.get(`/roles/${e}`)}async createRole(e){return this.post("/roles",e)}async updateRole(e,t){return this.put(`/roles/${e}`,t)}async deleteRole(e){return this.delete(`/roles/${e}`)}async assignRolePermissions(e,t){return this.post(`/roles/${e}/permissions`,t)}async assignUserRoles(e,t){return this.post(`/users/${e}/roles`,t)}async checkPermission(e){return this.post("/check-permission",e)}async getRoutePermissions(e={}){return this.get("/route-permissions",e)}async createRoutePermission(e){return this.post("/route-permissions",e)}async checkPermissionCode(e){try{return(await this.get(`/check-permission-code/${e}`)).has_permission}catch(t){return!1}}async getUserPermissionCodes(){try{return this.get("/user-permission-codes")}catch(e){return[]}}async getUserPermissions(){try{return await this.get("/users/permissions")}catch(e){return{roles:[],permission_codes:[],permissions:[],has_qa_read:!1}}}async hasPermissionCode(e){try{const t=await this.getUserPermissions();return t.permission_codes&&t.permission_codes.includes(e)}catch(t){return!1}}async hasRole(e){try{const t=await this.getUserPermissions();return t.roles&&t.roles.some((t=>t.name===e))}catch(t){return!1}}async getUserRoles(){try{return(await this.getUserPermissions()).roles||[]}catch(e){return[]}}async getUserRoutes(){try{const t=await this.get("/user-routes");if(t&&Array.isArray(t))return t;try{const e=await this.get("/navigation");return e&&Array.isArray(e)?e:[]}catch(e){return[]}}catch(t){return[]}}};const $t=new class extends It{constructor(){super("/activity")}async getActivities(e={}){return this.get("",e)}async getActivity(e){return this.get(`/${e}`)}async recordActivity(e){return this.post("",e)}async getUserActivities(e,t={}){return this.get(`/user/${e}`,t)}async getModuleActivities(e,t={}){return this.get(`/module/${e}`,t)}async getRecentActivities(e=10){return this.get("/recent",{limit:e})}async searchActivities(e={}){return this.post("/search",e)}};const xt=new class extends It{constructor(){super("/department")}async getDepartments(e={}){return this.get("",e)}async getDepartment(e){return this.get(`/${e}`)}async createDepartment(e){return this.post("",e)}async updateDepartment(e,t){return this.put(`/${e}`,t)}async deleteDepartment(e){return this.delete(`/${e}`)}async getDepartmentUsers(e,t={}){return this.get(`/${e}/users`,t)}async getDepartmentTree(){return this.get("/tree")}};const Ot=new class{constructor(){this._routes=[],this._isLoaded=!1,this._loadPromise=null,this._routeCache=new Map}async getRoutes(){return this._isLoaded&&this._routes.length>0?this._routes:(this._loadPromise||(this._loadPromise=this._loadRoutes()),this._loadPromise)}async _loadRoutes(){try{const e=await Lt.get("/routes");return e&&e.data?(this._routes=this._processRoutes(e.data),this._isLoaded=!0,this._routes):[]}catch(e){return[]}finally{this._loadPromise=null}}_processRoutes(e){return e.map((e=>{if("string"==typeof e.meta)try{e.meta=JSON.parse(e.meta)}catch(t){e.meta={title:e.name||"未命名"}}else e.meta||(e.meta={title:e.name||"未命名"});return e.meta.title||(e.meta.title=e.name||"未命名"),e.meta.icon||(e.meta.icon="mdi-link"),e.path&&!e.path.startsWith("/")&&"*"!==e.path&&(e.path="/"+e.path),e}))}async reloadRoutes(){return this._isLoaded=!1,this._loadPromise=null,this.getRoutes()}async getNavigationTree(){try{const t=["/user-routes","/navigation","/routes"];for(const r of t)try{const e=await Lt.get(r);if(e&&e.data&&Array.isArray(e.data)&&e.data.length>0){let t=e.data;return t=this._processRoutes(t),t}}catch(e){continue}return await this._fallbackNavigationTree()}catch(t){return await this._fallbackNavigationTree()}}async _fallbackNavigationTree(){try{const e=await Lt.get("/permissions/routes");if(e&&e.data&&Array.isArray(e.data)){return this._processRoutes(e.data)}}catch(s){}const e=await this.getRoutes(),t={},r=[];e.forEach((e=>{if(!e.id)return;const a={...e,children:[]};t[e.id]=a,e.parent_id||r.push(a)})),e.forEach((e=>{e.parent_id&&t[e.parent_id]&&t[e.parent_id].children.push(t[e.id])}));const a=e=>(e.sort(((e,t)=>(e.sort_order||0)-(t.sort_order||0))),e.forEach((e=>{e.children&&e.children.length>0&&a(e.children)})),e);return this._processRoutes(a(r))}getDefaultRoutes(){return[{id:"dashboard",path:"/dashboard",name:"Dashboard",meta:{title:"仪表板",icon:"mdi-view-dashboard",requiresAuth:!0},children:[]}]}filterRoutesByPermission(e){if(!e||!Array.isArray(e))return[];const t=et(),r=Jt();return JSON.parse(JSON.stringify(e)).filter((e=>{if(!e)return!1;let a=!1;if(t.isSuperUser||r.roles.includes("超级管理员")||r.roles.includes("管理员"))a=!0;else{const s=t.accessibleRoutesList;if(a=s&&s.length>0?s.some((t=>t.path===e.path)):t.canAccessRoute(e.path),!a)if(e.meta&&e.meta.permission_code&&"*"!==e.meta.permission_code){if(e.meta.permission_code)a=t.hasPermission(e.meta.permission_code);else if(e.meta.permission)if(e.meta.allowed_roles&&Array.isArray(e.meta.allowed_roles)){const s=r.roles.map((e=>{const r=t.roles.find((t=>t.name===e));return r?String(r.id):e}));a=e.meta.allowed_roles.some((e=>s.includes(e)||s.includes(String(e))))}else if("object"==typeof e.meta.permission){const{module:r,level:s,departmentId:i}=e.meta.permission;a=t.hasPermission(r,s,i)}else"string"==typeof e.meta.permission&&e.meta.permission.includes(":")&&(a=t.hasPermissionByString&&t.hasPermissionByString(e.meta.permission))}else a=!0}if(a&&e.children&&e.children.length>0){const t=this.filterRoutesByPermission(e.children);if(e.children=t,0===t.length&&e.meta&&e.meta.requiresChildren)return!1}return a}))}async getNavigationMenu(){try{this._isLoaded=!1;const e=(await this.getNavigationTree()).filter((e=>{var t;const r=!(null==(t=e.meta)?void 0:t.hideInMenu);return r}));return this.filterRoutesByPermission(e)}catch(e){return[]}}async reloadRoutes(){this._isLoaded=!1,this._routeCache.clear();try{return await this.getNavigationTree()}catch(e){return[]}}};const Ut=new class extends It{constructor(){super("/downtime")}async getDowntimeRecords(e={}){const t={...e};return t.start_from&&(t.start_from.includes("T")||(t.start_from+="T00:00:00")),t.start_to&&(t.start_to.includes("T")||(t.start_to+="T23:59:59")),this.get("/",t)}async getDowntime(e){return this.get(`/${e}`)}async createDowntime(e){return this.post("/",e)}async updateDowntime(e,t){return this.put(`/${e}`,t)}async deleteDowntime(e){return this.delete(`/${e}`)}async getLines(){return this.get("/lines")}async getDowntimeTypes(){return this.get("/types")}async getDowntimeReasons(e){e||(e="PLANNED");["PLANNED","UNPLANNED","MAINTENANCE"].includes(e)||(e="PLANNED");try{return await this.get("/reasons",{type_code:e})}catch(t){return this._getDefaultReasons(e)}}_getDefaultReasons(e){const t={PLANNED:[{code:"MAINTENANCE",name:"定期维护"},{code:"ADJUSTMENT",name:"设备调整"},{code:"CHANGEOVER",name:"产品切换"}],UNPLANNED:[{code:"EQUIPMENT",name:"设备故障"},{code:"MATERIAL",name:"材料问题"},{code:"QUALITY",name:"质量问题"},{code:"UTILITY",name:"公共设施故障"}],MAINTENANCE:[{code:"BREAKDOWN",name:"设备损坏"},{code:"INSPECTION",name:"安全检查"},{code:"REPAIR",name:"修复工作"}]};return t[e]||t.PLANNED}async getDowntimeStats(e={}){return this.get("/stats",e)}},Nt="http://localhost:8000/api/v1",jt={async login(e,t){try{const r=new URLSearchParams;r.append("username",e),r.append("password",t);const a=await Lt.post(`${Nt}/auth/login`,r,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(a.data&&a.data.access_token){localStorage.setItem("token",a.data.access_token);const e=Jt();return await e.fetchUserInfo(),a.data}throw new Error("登录失败，未获取到访问令牌")}catch(r){throw r}},logout(){try{localStorage.removeItem("token");return Jt().clearUserInfo(),!0}catch(e){return!1}},getToken:()=>localStorage.getItem("token"),isLoggedIn(){return!!this.getToken()},async refreshToken(){try{const e=await Lt.post(`${Nt}/auth/refresh-token`);if(e.data&&e.data.access_token)return localStorage.setItem("token",e.data.access_token),e.data;throw new Error("刷新令牌失败")}catch(e){throw this.logout(),e}}},Vt={async getMaintenanceMetrics(e={}){try{const t={...e};void 0!==t.page&&void 0!==t.page_size?(t.skip=(t.page-1)*t.page_size,t.limit=t.page_size,delete t.page,delete t.page_size):(void 0===t.skip&&(t.skip=0),void 0===t.limit&&(t.limit=50)),t.user_id&&delete t.user_id;return(await Lt.get("/maint/metrics-data",{params:t})).data}catch(t){throw t}},async createMaintenanceMetric(e){try{return(await Lt.post("/maint/metrics-data",e)).data}catch(t){throw t}},async updateMaintenanceMetric(e,t){try{return(await Lt.put(`/maint/metrics-data/${e}`,t)).data}catch(r){throw r}},async deleteMaintenanceMetric(e){try{return(await Lt.delete(`/maint/metrics-data/${e}`)).data}catch(t){throw t}},async getOEETrendData(e={}){try{const t={line:e.line,shift_code:e.shift_code,start_date:e.start_date,end_date:e.end_date};Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]||delete t[e]}));const r=await Lt.get("/maint/charts/oee-trend",{params:t});let a=[];if(r.data&&Array.isArray(r.data))a=r.data;else{if(!(r.data&&r.data.data&&Array.isArray(r.data.data)))return[];a=r.data.data}return a.map((t=>{let r="number"==typeof t.oee?t.oee:parseFloat(t.oee)||0,a="number"==typeof t.availability?t.availability:parseFloat(t.availability)||0;return r<=1&&(r*=100),a<=1&&(a*=100),{...t,line:t.line||e.line||"全部",shift_code:void 0!==t.shift_code?t.shift_code:e.shift_code||0,oee:r,availability:a,date:t.date||t.shift_date}}))}catch(t){throw t}},async getMTTRMTBFTrendData(e={}){try{const t={line:e.line,shift_code:e.shift_code,start_date:e.start_date,end_date:e.end_date};Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]||delete t[e]}));const r=await Lt.get("/maint/charts/mttr-mtbf-trend",{params:t});let a=[];if(r.data&&Array.isArray(r.data))a=r.data;else{if(!(r.data&&r.data.data&&Array.isArray(r.data.data)))return[];a=r.data.data}return a.map((t=>{const r="number"==typeof t.mttr?t.mttr:parseFloat(t.mttr)||0,a="number"==typeof t.mtbf?t.mtbf:parseFloat(t.mtbf)||0;return{...t,line:t.line||e.line||"全部",shift_code:t.shift_code||e.shift_code||0,mttr:r,mtbf:a}}))}catch(t){throw t}},calculateOEE(e=0,t=0,r=720){e=Number(e)||0,t=Number(t)||0;const a=r-e;if(a<=0)return 0;const s=a-t;return s<0?0:s/r},calculateAvailability(e=0,t=0,r=720){e=Number(e)||0,t=Number(t)||0;const a=r-e;if(a<=0)return 0;const s=a-t;return s<0?0:s/a},generateOEETrend(e={},t=[]){const r={};let a=[...t];if(e.line&&(a=a.filter((t=>t.line===e.line))),void 0!==e.shift_code&&null!==e.shift_code&&(a=a.filter((t=>t.shift_code===e.shift_code))),e.start_date&&e.end_date){const t=new Date(e.start_date);t.setHours(0,0,0,0);const r=new Date(e.end_date);r.setHours(23,59,59,999),a=a.filter((e=>{let a;if(e.date instanceof Date)a=e.date;else if("string"==typeof e.date)a=new Date(e.date);else{if(!e.shift_date)return!1;a=new Date(e.shift_date)}return!isNaN(a.getTime())&&(a>=t&&a<=r)}))}if(0===a.length)return[];a.forEach((e=>{const t=e.date instanceof Date?e.date:new Date(e.date||e.shift_date);if(isNaN(t.getTime()))return;const a=t.toISOString().split("T")[0],s=e.line||"未知线体",i=e.shift_code??("白班"===e.shift?1:"夜班"===e.shift?2:0),n=`${a}-${s}-${i}`;r[n]||(r[n]={date:a,line:s,shift_code:i,records:[],totalOEE:0,totalAvailability:0}),r[n].records.push(e);const o=Number(e.oee)||0,l=Number(e.availability)||0;r[n].totalOEE+=o,r[n].totalAvailability+=l}));const s=Object.values(r).map((e=>{const t=e.records.length||1;let r=e.totalOEE/t,a=e.totalAvailability/t;return r<=1&&(r*=100),a<=1&&(a*=100),{date:e.date,line:e.line,shift_code:e.shift_code,oee:r,availability:a}}));return s.sort(((e,t)=>e.date.localeCompare(t.date))),s.map((t=>({...t,line:t.line||e.line||"全部",shift_code:void 0!==t.shift_code?t.shift_code:e.shift_code||0})))},generateMTTRTrend(e={},t=[]){const r={};let a=[...t];if(e.line&&(a=a.filter((t=>t.line===e.line))),void 0!==e.shift_code&&(a=a.filter((t=>t.shift_code===e.shift_code))),e.start_date&&e.end_date){const t=new Date(e.start_date),r=new Date(e.end_date);r.setHours(23,59,59,999),a=a.filter((e=>{let a;if(e.date instanceof Date)a=e.date;else if("string"==typeof e.date)a=new Date(e.date);else{if(!e.shift_date)return!1;a=new Date(e.shift_date)}return!isNaN(a.getTime())&&(a>=t&&a<=r)}))}if(0===a.length)return[];if(a.some((e=>void 0!==e.mttr&&void 0!==e.mtbf))){a.forEach((e=>{const t=(e.date instanceof Date?e.date:new Date(e.date||e.shift_date)).toISOString().split("T")[0],a=e.line||"未知线体",s=e.shift_code||("白班"===e.shift?1:"夜班"===e.shift?2:0),i=`${t}-${a}-${s}`;r[i]||(r[i]={date:t,line:a,shift_code:s,mttr:e.mttr||0,mtbf:e.mtbf||0,unplanned_count:e.unplanned_count||0})}));const e=Object.values(r);return e.sort(((e,t)=>e.date.localeCompare(t.date))),e}return this.generateMockMTTRData(e)},generateLineComparison(e=[],t=[]){const r={};return e.forEach((e=>{r[e]={records:[],totalOEE:0,totalAvailability:0,totalOutPlanDowntime:0,totalPlanDowntime:0,totalMTTR:0,totalMTBF:0,mttrCount:0,mtbfCount:0,recordCount:0}})),t.forEach((e=>{const t=e.line;if(r[t]){r[t].records.push(e),r[t].recordCount++;const a=Number(e.oee)||0,s=this.calculateAvailability(e.plan_down_time,e.out_plan_down_time);r[t].totalOEE+=a,r[t].totalAvailability+=s,r[t].totalOutPlanDowntime+=Number(e.out_plan_down_time)||0,r[t].totalPlanDowntime+=Number(e.plan_down_time)||0,void 0!==e.mttr&&(r[t].totalMTTR+=Number(e.mttr),r[t].mttrCount++),void 0!==e.mtbf&&(r[t].totalMTBF+=Number(e.mtbf),r[t].mtbfCount++)}})),{lines:e,metrics:["可动率","MTTR","MTBF","停机时间","OEE"],values:e.map((e=>{const t=r[e],a=t.recordCount||1,s=t.totalOEE/a,i=t.totalAvailability/a,n=t.totalOutPlanDowntime/a,o=t.totalPlanDowntime/a,l=t.mttrCount>0?t.totalMTTR/t.mttrCount:30+60*Math.random(),c=t.mtbfCount>0?t.totalMTBF/t.mtbfCount:240+480*Math.random(),u=Math.max(0,Math.min(100,100-l/120*100)),d=Math.max(0,Math.min(100,c/720*100)),m=(o+n)/720*100,h=Math.max(0,Math.min(100,100-m));return[Math.round(100*i),Math.round(u),Math.round(d),Math.round(h),Math.round(100*s)]}))}},generateMockMTTRData(e={}){const t=(()=>{const t=[],r=e.start_date?new Date(e.start_date):new Date(Date.now()-2592e6),a=e.end_date?new Date(e.end_date):new Date;let s=new Date(r);for(;s<=a;)t.push(s.toISOString().split("T")[0]),s.setDate(s.getDate()+1);return t})(),r=e.line?[e.line]:["SWI-L","SWI-R","RWH-L","RWH-R","W01","HF","LC"],a=void 0!==e.shift_code?[e.shift_code]:[1,2],s=[];return r.forEach((e=>{a.forEach((r=>{t.forEach((t=>{const a=Math.floor(1+3*Math.random()),i=Math.floor(30+60*Math.random()),n=Math.floor(20+40*Math.random())*a,o=Math.floor(n/a),l=Math.floor((720-i-n)/a);s.push({date:t,line:e,shift_code:r,mttr:o,mtbf:l,unplanned_count:a,planned_downtime:i,unplanned_downtime:n})}))}))})),s.sort(((e,t)=>e.date.localeCompare(t.date))),s},generateMockOEEData(e={}){const t=(()=>{const t=[],r=e.start_date?new Date(e.start_date):new Date(Date.now()-2592e6),a=e.end_date?new Date(e.end_date):new Date;let s=new Date(r);for(;s<=a;)t.push(s.toISOString().split("T")[0]),s.setDate(s.getDate()+1);return t})(),r=e.line?[e.line]:["SWI-L","SWI-R","RWH-L","RWH-R","W01","HF","LC"],a=void 0!==e.shift_code?[e.shift_code]:[1,2],s=[];return r.forEach((e=>{a.forEach((r=>{t.forEach((t=>{const a=.85+.1*Math.random(),i=a+.05*Math.random();s.push({date:t,line:e,shift_code:r,oee:100*a,availability:100*i})}))}))})),s.sort(((e,t)=>e.date.localeCompare(t.date))),s},generateMockChartData(e={},t=[]){return{oeeAvailability:this.generateMockOEEData(e),mttrMtbf:this.generateMockMTTRData(e),lineComparison:{lines:t,metrics:["可动率","MTTR","MTBF","停机时间","OEE"],values:t.map((()=>{const e=30+60*Math.random(),t=Math.max(0,Math.min(100,100-e/120*100)),r=240+480*Math.random(),a=Math.max(0,Math.min(100,r/720*100)),s=100-(5+10*Math.random()),i=85+10*Math.random(),n=80+15*Math.random();return[Math.round(i),Math.round(t),Math.round(a),Math.round(s),Math.round(n)]}))}}},calculateAvailability(e,t,r=720){if(r<=0)return 0;const a=r-e;if(a<=0)return 0;const s=Math.max(0,a-t)/a;return Math.round(1e4*s)/1e4},async getMttrMtbfTrend(e={}){try{return(await At("/maint/mttr-mtbf-trend",{params:e})).data}catch(t){throw t}},calculateTrend:(e,t)=>t&&0!==t?(e-t)/t*100:0,calculateMttrMtbf(e,t,r=0,a=720){const s=t>0?e/t:0,i=a-r,n=Math.max(0,i-e),o=t>0?n/t:n;return{mttr:Math.round(100*s)/100,mtbf:Math.round(100*o)/100}}},Ft=((e="/api/v1")=>{const t=Le.create({baseURL:e,timeout:3e4,headers:{"Content-Type":"application/json"}});return t.interceptors.request.use((e=>{const t=localStorage.getItem("auth")?JSON.parse(localStorage.getItem("auth")).token:null;return t&&(e.headers.Authorization=`Bearer ${t}`),e}),(e=>Promise.reject(e))),t.interceptors.response.use((e=>e),(e=>{const t=e.response,r=null==t?void 0:t.data,a=null==t?void 0:t.status,s={...e,status:a,message:(null==r?void 0:r.detail)||e.message||"未知错误",data:r};if(401===a){localStorage.removeItem("auth"),localStorage.removeItem("user");"/login"!==window.location.pathname&&(window.location.href="/login")}return Promise.reject(s)})),t})();class Bt{constructor(e){this.endpoint=e}async getAll(e={}){try{return(await Ft.get(this.endpoint,{params:e})).data||[]}catch(t){return this._handleError(t,"getAll"),[]}}async getById(e){try{return(await Ft.get(`${this.endpoint}/${e}`)).data}catch(t){return this._handleError(t,"getById"),null}}async create(e){try{return(await Ft.post(this.endpoint,e)).data}catch(t){throw this._handleError(t,"create"),t}}async update(e,t){try{return(await Ft.put(`${this.endpoint}/${e}`,t)).data}catch(r){throw this._handleError(r,"update"),r}}async delete(e){try{return await Ft.delete(`${this.endpoint}/${e}`),!0}catch(t){return this._handleError(t,"delete"),!1}}async customGet(e,t={}){try{return(await Ft.get(e,{params:t})).data}catch(r){throw this._handleError(r,"customGet"),r}}async customPost(e,t={}){try{return(await Ft.post(e,t)).data}catch(r){throw this._handleError(r,"customPost"),r}}_handleError(e,t){var r;e.message,e.status||null==(r=e.response)||r.status}}const zt=new class extends Bt{constructor(){super("auth")}async login(e,t){try{return(await Ft.post("/auth/login",{username:e,password:t})).data}catch(r){throw this._handleError(r,"login"),r}}async refreshToken(){try{return(await Ft.post("/auth/refresh-token")).data}catch(e){throw this._handleError(e,"refreshToken"),e}}async validateToken(){try{return 200===(await Ft.get("/auth/validate-token")).status}catch(e){return this._handleError(e,"validateToken"),!1}}async requestPasswordReset(e){try{return await Ft.post("/auth/request-password-reset",{email:e}),!0}catch(t){return this._handleError(t,"requestPasswordReset"),!1}}async resetPassword(e,t){try{return await Ft.post("/auth/reset-password",{token:e,new_password:t}),!0}catch(r){return this._handleError(r,"resetPassword"),!1}}};const Wt=new class extends Bt{constructor(){super("users")}async getCurrentUser(){try{return(await Ft.get("/users/me")).data}catch(e){throw this._handleError(e,"getCurrentUser"),e}}async updateCurrentUser(e){try{return(await Ft.put("/users/me",e)).data}catch(t){throw this._handleError(t,"updateCurrentUser"),t}}async changePassword(e,t){try{return await Ft.post("/users/me/change-password",{current_password:e,new_password:t}),!0}catch(r){throw this._handleError(r,"changePassword"),r}}async getUsers(e={}){return this.getAll(e)}async createUser(e){return this.create(e)}async updateUser(e,t){return this.update(e,t)}async deleteUser(e){return this.delete(e)}async assignRoles(e,t){try{return(await Ft.post(`/users/${e}/roles`,{roles:t})).data}catch(r){throw this._handleError(r,"assignRoles"),r}}};const qt=new class extends Bt{constructor(){super("departments")}async getDepartments(e={}){return this.getAll(e)}async createDepartment(e){return this.create(e)}async updateDepartment(e,t){return this.update(e,t)}async deleteDepartment(e){return this.delete(e)}},Ht={user:Ct,permission:Mt,activity:$t,department:xt,route:Ot,downtime:Ut,auth:jt,maintenance:Vt,v2:{auth:zt,user:Wt,department:qt}},Kt=Object.freeze(Object.defineProperty({__proto__:null,activityService:$t,authService:jt,default:Ht,departmentService:xt,downtimeService:Ut,maintenanceService:Vt,permissionService:Mt,routeService:Ot,userService:Ct},Symbol.toStringTag,{value:"Module"})),Jt=M("user",{state:()=>({user:null,userId:null,token:null,tokenExpiry:null,isLogin:!1,department:null,roles:[],permissions:[]}),getters:{displayName:e=>e.user?e.user:"未登录",isAuthenticated:e=>e.isLogin&&e.token,userInfo:e=>({user:e.user,userId:e.userId,department:e.department,isLogin:e.isLogin,roles:e.roles})},actions:{async initialize(){if(this.loadFromStorage(),!this.token||!this.isTokenValid())return this.clearUserState(),!1;try{await this.getCurrentUser();const e=et();return await e.initPermissions(),this.updateTokenExpiry(),this.saveToStorage(),!0}catch(e){return this.clearUserState(),!1}},async login(e,t){var r,a;try{if(!e||!t){const t=e?"密码不能为空":"用户名不能为空";throw new Error(t)}const r=await Ct.login(e,t);if(!r||!r.token)throw new Error("登录失败: 服务器返回无效数据");JSON.stringify(r),this.setUserData(r),await this.getCurrentUser();const a=et();return await a.initPermissions(),this.updateTokenExpiry(),this.saveToStorage(),!0}catch(s){const e=(null==(a=null==(r=s.response)?void 0:r.data)?void 0:a.detail)||s.message||"登录失败";throw this.clearUserState(),new Error(e)}},async getCurrentUser(){try{const e=await Ct.getCurrentUser();if(e)return this.user=e.name||e.username,this.userId=e.id,this.department=e.department,this.roles=e.roles||[],this.isLogin=!0,this.user,e;throw new Error("获取用户信息失败")}catch(e){throw e}},async logout(){et().clearPermissions(),this.clearUserState(),"/login"!==ut.currentRoute.value.path&&ut.push("/login")},async refreshToken(){try{const e=await Ct.refreshToken();if(e&&(e.token||e.access_token))return this.token=e.token||e.access_token,this.updateTokenExpiry(),this.saveToStorage(),!0;throw new Error("刷新令牌失败: 无效的响应数据")}catch(e){throw this.clearUserState(),e}},async ensureUserInfoIntegrity(){if(this.isLogin&&this.token&&(!this.user||!this.userId||!this.department))try{return await this.getCurrentUser(),this.saveToStorage(),!0}catch(e){return e.response&&401===e.response.status&&this.clearUserState(),!1}return!0},setUserData(e){e&&(e.token&&(this.token=e.token),e.user&&("object"==typeof e.user?(this.user=e.user.username||e.user.name||e.user.user_name,this.userId=e.user.id||e.user.user_id,this.department=e.user.department):this.user=e.user),!this.userId&&e.user_id&&(this.userId=e.user_id),!this.department&&e.department&&(this.department=e.department),!this.user&&e.user_name&&(this.user=e.user_name),e.roles&&(this.roles=e.roles),this.isLogin=!0,this.userInfo)},updateTokenExpiry(){const e=new Date((new Date).getTime()+864e5);this.tokenExpiry=e.toISOString()},isTokenValid(){if(!this.token||!this.tokenExpiry)return!1;const e=new Date;return new Date(this.tokenExpiry)>e},isTokenExpiringSoon(){if(!this.token||!this.tokenExpiry)return!1;const e=new Date,t=new Date(this.tokenExpiry)-e;return t<36e5&&t>0},loadFromStorage(){try{const e=localStorage.getItem("user-store");if(e){const t=JSON.parse(e);this.user=t.user,this.userId=t.userId,this.token=t.token,this.tokenExpiry=t.tokenExpiry,this.isLogin=t.isLogin,this.department=t.department,this.roles=t.roles||[],this.user}}catch(e){}},saveToStorage(){try{const e={user:this.user,userId:this.userId,token:this.token,tokenExpiry:this.tokenExpiry,isLogin:this.isLogin,department:this.department,roles:this.roles};localStorage.setItem("user-store",JSON.stringify(e))}catch(e){}},clearUserState(){this.user=null,this.userId=null,this.token=null,this.tokenExpiry=null,this.isLogin=!1,this.department=null,this.roles=[],this.permissions=[];try{localStorage.removeItem("user-store")}catch(e){}},setRoles(e){Array.isArray(e)&&(this.roles=e)}},persist:{enabled:!0,strategies:[{key:"user-store",storage:localStorage,paths:["user","userId","token","tokenExpiry","isLogin","department","roles"]}]}}),Gt=O();Gt.use(U);const Qt=(e,t)=>{const r=e.__vccOpts||e;for(const[a,s]of t)r[a]=s;return r},Yt={class:"global-notification"},Xt=Qt({__name:"GlobalNotification",setup(e,{expose:t}){const r=a({visible:!1,title:"确认",message:"",confirmText:"确认",cancelText:"取消",confirmColor:"primary",titleClass:"",icon:null,resolve:null,reject:null}),p=a({visible:!1,title:"提示",message:"",confirmText:"确定",titleClass:"",icon:null,resolve:null}),f={success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"},g={success:"success",error:"error",warning:"warning",info:"primary"},y=(e={})=>new Promise(((t,a)=>{const s=e.type||"info";r.value={...r.value,visible:!0,title:e.title||"确认",message:e.message||"",confirmText:e.confirmText||"确认",cancelText:e.cancelText||"取消",confirmColor:g[s]||"primary",titleClass:"warning"===s||"error"===s?`text-${s}`:"",icon:f[s]||null,resolve:t,reject:a}})),v=(e={})=>new Promise((t=>{const r=e.type||"info";p.value={...p.value,visible:!0,title:e.title||"提示",message:e.message||"",confirmText:e.confirmText||"确定",titleClass:"warning"===r||"error"===r?`text-${r}`:"",icon:f[r]||null,resolve:t}})),_=()=>{r.value.visible=!1,r.value.resolve&&r.value.resolve(!0)},w=()=>{r.value.visible=!1,r.value.resolve&&r.value.resolve(!1)},b=()=>{p.value.visible=!1,p.value.resolve&&p.value.resolve()};return t({confirm:y,alert:v}),s((()=>{window&&(window.$notification={confirm:y,alert:v})})),(e,t)=>(n(),i("div",Yt,[o(q,{modelValue:r.value.visible,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value.visible=e),"max-width":"500",persistent:"",class:"confirm-dialog"},{default:l((()=>[o(N,null,{default:l((()=>[o(j,{class:c(["text-h5",r.value.titleClass])},{default:l((()=>[r.value.icon?(n(),u(V,{key:0,class:"mr-2"},{default:l((()=>[m(h(r.value.icon),1)])),_:1})):d("",!0),m(" "+h(r.value.title),1)])),_:1},8,["class"]),o(F,{class:"py-4"},{default:l((()=>[m(h(r.value.message),1)])),_:1}),o(B,null,{default:l((()=>[o(z),o(W,{variant:"text",onClick:w},{default:l((()=>[m(h(r.value.cancelText),1)])),_:1}),o(W,{color:r.value.confirmColor,onClick:_},{default:l((()=>[m(h(r.value.confirmText),1)])),_:1},8,["color"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),o(q,{modelValue:p.value.visible,"onUpdate:modelValue":t[1]||(t[1]=e=>p.value.visible=e),"max-width":"500",class:"alert-dialog"},{default:l((()=>[o(N,null,{default:l((()=>[o(j,{class:c(["text-h5",p.value.titleClass])},{default:l((()=>[p.value.icon?(n(),u(V,{key:0,class:"mr-2"},{default:l((()=>[m(h(p.value.icon),1)])),_:1})):d("",!0),m(" "+h(p.value.title),1)])),_:1},8,["class"]),o(F,{class:"py-4"},{default:l((()=>[m(h(p.value.message),1)])),_:1}),o(B,null,{default:l((()=>[o(z),o(W,{color:"primary",onClick:b},{default:l((()=>[m(h(p.value.confirmText),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-7964419f"]]),Zt=Qt({__name:"GlobalSnackbar",setup(e,{expose:t}){const r=a({text:"",color:"success",timeout:3e3}),i=a(!1),c=e=>("string"==typeof e?r.value={text:e,color:"success",timeout:3e3}:"object"==typeof e&&(r.value={text:e.text||e.message||"",color:e.color||e.type||"success",timeout:e.timeout||e.time||3e3}),i.value=!0,new Promise((e=>{setTimeout(e,r.value.timeout)})));return t({show:c}),s((()=>{const e=Qe.on("snackbar",(e=>{c({text:e.message,color:e.type,timeout:e.time})}));return window&&(window.$snackbar={show:c}),()=>{e&&e()}})),(e,t)=>(n(),u(H,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),color:r.value.color,timeout:r.value.timeout,location:"bottom right",class:"global-snackbar"},{actions:l((()=>[o(W,{variant:"text",icon:"mdi-close",onClick:t[0]||(t[0]=e=>i.value=!1)})])),default:l((()=>[m(h(r.value.text)+" ",1)])),_:1},8,["modelValue","color","timeout"]))}},[["__scopeId","data-v-34af45bc"]]),er={class:"dynamic-nav"},tr={class:"nav-content"},rr={key:0,class:"pa-4 d-flex justify-center align-center"},ar={key:1,class:"pa-4 text-center"},sr={key:2,class:"pa-4 text-center"},ir={key:1,class:"nav-group-wrapper"},nr={class:"nav-child-items"},or=Qt({__name:"DynamicNavigation",props:{groupConfig:{type:Array,default:()=>[{id:"main",title:"主菜单",filter:e=>{var t;return!(null==(t=e.meta)?void 0:t.group)||"main"===e.meta.group}},{id:"qa",title:"质量",filter:e=>{var t;return"qa"===(null==(t=e.meta)?void 0:t.group)}},{id:"production",title:"生产",filter:e=>{var t;return"production"===(null==(t=e.meta)?void 0:t.group)}},{id:"logistics",title:"物流",filter:e=>{var t;return"logistics"===(null==(t=e.meta)?void 0:t.group)}},{id:"maintenance",title:"维修",filter:e=>{var t;return"maintenance"===(null==(t=e.meta)?void 0:t.group)}},{id:"ehs",title:"EHS",filter:e=>{var t;return"ehs"===(null==(t=e.meta)?void 0:t.group)}},{id:"eng",title:"工程",filter:e=>{var t;return"eng"===(null==(t=e.meta)?void 0:t.group)}},{id:"assy",title:"生产",filter:e=>{var t;return"assy"===(null==(t=e.meta)?void 0:t.group)}},{id:"mat",title:"维修",filter:e=>{var t;return"mat"===(null==(t=e.meta)?void 0:t.group)}},{id:"pcl",title:"物流",filter:e=>{var t;return"pcl"===(null==(t=e.meta)?void 0:t.group)}},{id:"gmo",title:"GMO",filter:e=>{var t;return"gmo"===(null==(t=e.meta)?void 0:t.group)}},{id:"fin",title:"财务",filter:e=>{var t;return"fin"===(null==(t=e.meta)?void 0:t.group)}},{id:"prs",title:"PRS",filter:e=>{var t;return"prs"===(null==(t=e.meta)?void 0:t.group)}},{id:"hr",title:"人事",filter:e=>{var t;return"hr"===(null==(t=e.meta)?void 0:t.group)}},{id:"admin",title:"系统管理",filter:e=>{var t;return"admin"===(null==(t=e.meta)?void 0:t.group)}},{id:"other",title:"其他",filter:e=>{var t;return!(null==(t=e.meta)?void 0:t.group)||"other"===e.meta.group}}]},showBottomActions:{type:Boolean,default:!0},showSearch:{type:Boolean,default:!0},sortFunction:{type:Function,default:null},drawer:{type:Boolean,default:!0}},emits:["update:drawer"],setup(e,{emit:t}){const r=e,c=t,E=K(),k=J(),P=et(),R=Jt(),S=a(!0),A=a(!1),D=a([]),T=a([]),L=a(""),I=a([]),C=p((()=>k.path)),M=e=>!!e&&(C.value===e||"/"!==e&&C.value.startsWith(`${e}/`)),$=e=>!!e&&(!(!e.path||"/"===e.path||!C.value.startsWith(e.path))||!!(e.children&&e.children.length>0)&&e.children.some((e=>!!e.path&&M(e.path)))),x=p((()=>{const e=[...D.value];r.sortFunction&&e.sort(r.sortFunction);const t=L.value.toLowerCase();let a=e;if(L.value){const e=r=>{var a;const s=((null==(a=r.meta)?void 0:a.title)||"").toLowerCase().includes(t),i=(r.name||"").toLowerCase().includes(t),n=(r.path||"").toLowerCase().includes(t);if(s||i||n)return!0;if(r.children&&r.children.length>0){if(r.children.filter(e).length>0)return!0}return!1};a=a.filter(e)}return r.groupConfig.map((e=>({id:e.id,title:e.title,routes:a.filter((t=>e.filter(t)))}))).filter((e=>e.routes.length>0))})),O=()=>{const e=[];x.value.forEach((t=>{t.routes.forEach(((r,a)=>{if(r.children&&r.children.length>0){const s=r.path||`group-${t.id}-${a}`;$(r)&&e.push(s)}}))})),e.length>0&&(T.value=e)},U=()=>{window._navRetryCount&&(window._navRetryCount=0)},N=()=>{U(),j()},j=async()=>{S.value=!0,A.value=!1;try{if(!R.isLogin)return void(D.value=[]);P.isInitialized||await P.initPermissions();let r=[];try{if(P.accessibleRoutesList&&P.accessibleRoutesList.length>0)r=P.accessibleRoutesList;else{const e=(await Ge((async()=>{const{permissionService:e}=await Promise.resolve().then((()=>Kt));return{permissionService:e}}),void 0,import.meta.url)).permissionService;r=await e.getUserRoutes()}}catch(e){try{r=await Ot.getNavigationMenu()}catch(t){r=B()}}const a=F(r);D.value=a,U(),(()=>{try{const e=localStorage.getItem("recentlyUsedRoutes");e&&(I.value=JSON.parse(e))}catch(e){}})(),O()}catch(r){if(A.value=!0,window._navRetryCount){if(!(window._navRetryCount<3))return void(D.value=B());window._navRetryCount++}else window._navRetryCount=1;setTimeout((()=>j()),1e3*window._navRetryCount)}finally{S.value=!1}},F=e=>{if(!Array.isArray(e))return[];const t=e=>{if(!e||"object"!=typeof e)return null;if(!e.path){if(!e.name)return null;e.path=`/${e.name.toLowerCase().replace(/\s+/g,"-")}`}return e.meta||(e.meta={}),e.meta.title||(e.meta.title=e.name||e.path),e.meta.icon||(e.meta.icon="mdi-link"),e.children&&Array.isArray(e.children)&&(e.children=e.children.map(t).filter((e=>null!==e))),e};return e.map(t).filter((e=>null!==e))},B=()=>{const e=[{id:"dashboard",path:"/dashboard",name:"Dashboard",meta:{title:"仪表板",icon:"mdi-view-dashboard",requiresAuth:!0}}];return(P.isSuperUser||P.hasRole("管理员")||P.hasRole("超级管理员"))&&e.push({id:"admin",path:"/admin",name:"Admin",meta:{title:"系统管理",icon:"mdi-cog",requiresAuth:!0}}),e};f((()=>k.path),((e,t)=>{O(),(e=>{if(!e)return;const t=I.value.indexOf(e);t>-1&&I.value.splice(t,1),I.value.unshift(e),I.value.length>5&&I.value.pop();try{localStorage.setItem("recentlyUsedRoutes",JSON.stringify(I.value))}catch(r){}})(e),window.innerWidth>=1264&&!r.drawer&&c("update:drawer",!0);E.getRoutes().some((t=>t.path===e))||"/"===e||e.startsWith("/login")||e.startsWith("/dashboard")||z()}),{immediate:!0}),f((()=>L.value),(()=>{O()})),f((()=>R.isLogin),((e,t)=>{e&&!t?j():e||(D.value=[])}),{immediate:!0}),f((()=>P.isInitialized),((e,t)=>{R.isLogin&&e&&!t&&j()})),f((()=>P.accessibleRoutesList.length),((e,t)=>{R.isLogin&&e>0&&e!==t&&j()}));s((()=>{j(),!r.drawer&&window.innerWidth>=1264&&c("update:drawer",!0)}));const z=async()=>{try{S.value=!0,sessionStorage.removeItem("accessibleRoutes"),localStorage.removeItem("accessibleRoutes"),await P.refreshPermissions(),await j();try{const{addDynamicRoutes:e,resetDynamicRoutesState:t}=await Ge((async()=>{const{addDynamicRoutes:e,resetDynamicRoutesState:t}=await Promise.resolve().then((()=>pt));return{addDynamicRoutes:e,resetDynamicRoutesState:t}}),void 0,import.meta.url);t();await e();const r=E.currentRoute.value.path;E.resolve(r).matched.length>0?E.replace(r):E.replace("/dashboard")}catch(e){}S.value=!1}catch(e){S.value=!1,A.value=!0}};return(e,t)=>(n(),i("div",er,[g("div",tr,[o(ae,{class:"nav-list",density:"compact"},{default:l((()=>[S.value?(n(),i("div",rr,[o(G,{indeterminate:"",color:"primary",size:"24"}),t[0]||(t[0]=g("span",{class:"ml-2 text-body-2"},"加载导航菜单...",-1))])):A.value?(n(),i("div",ar,[o(V,{color:"error",icon:"mdi-alert-circle-outline"}),t[2]||(t[2]=g("div",{class:"text-body-2 text-error mt-2"}," 加载菜单失败 ",-1)),o(W,{variant:"text",color:"primary",size:"small",class:"mt-2",onClick:N},{default:l((()=>t[1]||(t[1]=[m(" 重试 ")]))),_:1,__:[1]})])):L.value&&0===x.value.length?(n(),i("div",sr,[o(V,{color:"info",icon:"mdi-information-outline"}),t[3]||(t[3]=g("div",{class:"text-body-2 mt-2"}," 未找到匹配的菜单项 ",-1))])):(n(!0),i(y,{key:3},v(x.value,((e,r)=>(n(),i(y,{key:r},[e.title?(n(),u(Q,{key:0,class:"nav-group-title"},{default:l((()=>[m(h(e.title),1)])),_:2},1024)):d("",!0),(n(!0),i(y,null,v(e.routes,((e,r)=>{var a;return n(),i(y,{key:e.path||r},[e.children&&0!==e.children.length?(n(),i("div",ir,[_((n(),u(Y,{active:$(e),class:"nav-list-item nav-group-header",onClick:t=>(e=>{const t=T.value.indexOf(e);t>-1?T.value.splice(t,1):T.value=[e]})(e.path||r)},{prepend:l((()=>[o(V,null,{default:l((()=>{var t;return[m(h((null==(t=e.meta)?void 0:t.icon)||"mdi-folder"),1)]})),_:2},1024)])),append:l((()=>[o(V,{icon:T.value.includes(e.path||r)?"mdi-chevron-up":"mdi-chevron-down",class:"transition-icon"},null,8,["icon"])])),default:l((()=>[o(X,null,{default:l((()=>{var t;return[m(h((null==(t=e.meta)?void 0:t.title)||e.name||"未命名"),1)]})),_:2},1024)])),_:2},1032,["active","onClick"])),[[ee]]),o(te,null,{default:l((()=>[_(g("div",nr,[t[4]||(t[4]=g("div",{class:"nav-group-indicator"},null,-1)),(n(!0),i(y,null,v(e.children,((e,t)=>_((n(),u(Y,{key:e.path||t,to:e.path,value:e.path,active:M(e.path),class:"nav-list-subitem"},{prepend:l((()=>[o(V,{size:"small"},{default:l((()=>{var t;return[m(h((null==(t=e.meta)?void 0:t.icon)||"mdi-link"),1)]})),_:2},1024)])),default:l((()=>[o(X,null,{default:l((()=>{var t;return[m(h((null==(t=e.meta)?void 0:t.title)||e.name||"未命名"),1)]})),_:2},1024)])),_:2},1032,["to","value","active"])),[[ee]]))),128))],512),[[b,T.value.includes(e.path||r)]])])),_:2},1024)])):_((n(),u(Y,{key:0,to:e.path,value:e.path,active:M(e.path),class:"nav-list-item",onClick:t=>(e=>{E.getRoutes().find((t=>t.path===e.path))||z().then((()=>{E.getRoutes().find((t=>t.path===e.path))?E.replace(e.path):E.replace("/dashboard")})).catch((e=>{E.replace("/dashboard")}))})(e)},w({prepend:l((()=>[o(V,null,{default:l((()=>{var t;return[m(h((null==(t=e.meta)?void 0:t.icon)||"mdi-link"),1)]})),_:2},1024)])),default:l((()=>[o(X,null,{default:l((()=>{var t;return[m(h((null==(t=e.meta)?void 0:t.title)||e.name||"未命名"),1)]})),_:2},1024)])),_:2},[(null==(a=e.meta)?void 0:a.badge)?{name:"append",fn:l((()=>[o(Z,{content:e.meta.badge,color:e.meta.badgeColor||"primary",dot:"",location:"top start"},null,8,["content","color"])])),key:"0"}:void 0]),1032,["to","value","active","onClick"])),[[ee]])],64)})),128)),r<x.value.length-1?(n(),u(re,{key:1,class:"my-2"})):d("",!0)],64)))),128))])),_:1})])]))}},[["__scopeId","data-v-27b0f790"]]),lr={class:"d-flex align-center"},cr={key:0},ur={class:"text-white text-subtitle-2"},dr={class:"d-none d-sm-flex user-name"},mr={class:"pa-4 user-menu-header"},hr={class:"text-h6"},pr={class:"text-subtitle-2"},fr=Qt({__name:"AppHeader",props:{drawer:{type:Boolean,required:!0}},emits:["update:drawer"],setup(e,{emit:r}){const a=e,c=r,d=Jt(),f=K();J();const y=se(),v=()=>{const e=!a.drawer;c("update:drawer",e);try{localStorage.setItem("sideNavState",e.toString())}catch(t){}},_=p((()=>d.user?d.user.charAt(0).toUpperCase():"")),w=()=>{d.logout(),f.push("/login")},b=()=>{y.global.name.value=y.global.current.value.dark?"light":"dark";try{localStorage.setItem("theme",y.global.name.value)}catch(e){}};return s((()=>{try{const e=localStorage.getItem("theme");if(!e||"light"!==e&&"dark"!==e)if("auto"===e){const e=window.matchMedia("(prefers-color-scheme: dark)").matches;y.global.name.value=e?"dark":"light"}else y.global.name.value="light";else y.global.name.value=e}catch(e){y.global.name.value="light"}})),(e,r)=>(n(),u(de,{app:"",elevation:"2",class:"app-header"},{default:l((()=>[o(ie,{fluid:""},{default:l((()=>[o(ne,{align:"center",justify:"space-between","no-gutters":""},{default:l((()=>[o(oe,{cols:"auto"},{default:l((()=>r[0]||(r[0]=[g("div",{class:"d-flex align-center"},[g("img",{src:"/assets/images/logo.ClF3d8wc.png",alt:"Logo",class:"app-logo"}),g("span",{class:"text-h6 font-weight-medium ml-2 app-title d-none d-sm-flex"}," 麦格纳(天津)数据管理系统 ")],-1)]))),_:1,__:[0]}),o(oe,{cols:"auto"},{default:l((()=>[g("div",lr,[g("div",null,[t(d).isLogin?(n(),i("div",cr,[o(le,{"close-on-content-click":"",location:"bottom","close-on-back":!0,transition:"slide-y-transition","content-class":"user-menu-content"},{activator:l((({props:e})=>[o(W,E({variant:"text"},e,{class:"user-menu-btn"}),{default:l((()=>[o(ce,{size:"32",color:"primary",class:"mr-2"},{default:l((()=>[g("span",ur,h(_.value),1)])),_:1}),g("span",dr,h(t(d).user),1),o(V,{size:"small",class:"ml-1"},{default:l((()=>r[1]||(r[1]=[m(" mdi-chevron-down ")]))),_:1,__:[1]})])),_:2},1040)])),default:l((()=>[o(N,{"min-width":"240",elevation:"4",rounded:"lg",class:"user-menu-card"},{default:l((()=>{return[g("div",mr,[g("div",hr,h(t(d).user),1),g("div",pr,h((e=t(d).department,e||"未分配"))+" 部门 ",1)]),o(re),o(ae,{density:"compact"},{default:l((()=>[o(Y,{to:"/profile","prepend-icon":"mdi-account-circle",title:"个人资料"}),o(Y,{to:"/settings","prepend-icon":"mdi-cog",title:"设置"}),o(Y,{"prepend-icon":"mdi-theme-light-dark",title:"切换主题",onClick:b})])),_:1}),o(re),o(ae,{density:"compact"},{default:l((()=>[o(Y,{link:"",class:"logout-item",onClick:w},{prepend:l((()=>[o(V,{size:"small",color:"error"},{default:l((()=>r[2]||(r[2]=[m(" mdi-logout ")]))),_:1,__:[2]})])),default:l((()=>[o(X,{class:"text-error"},{default:l((()=>r[3]||(r[3]=[m(" 登出 ")]))),_:1,__:[3]})])),_:1})])),_:1})];var e})),_:1})])),_:1})])):(n(),u(W,{key:1,variant:"text",to:"/login","prepend-icon":"mdi-login"},{default:l((()=>r[4]||(r[4]=[m(" 登录 ")]))),_:1,__:[4]}))])])])),_:1}),o(ue,{class:"d-md-none",onClick:v})])),_:1})])),_:1})])),_:1}))}},[["__scopeId","data-v-54322df5"]]),gr=(e,t)=>{try{if("auto"===t){const t=window.matchMedia("(prefers-color-scheme: dark)").matches;e.global.name.value=t?"dark":"light"}else"light"!==t&&"dark"!==t||(e.global.name.value=t);return localStorage.setItem("theme",t),!0}catch(r){return!1}},yr=()=>{try{return localStorage.getItem("theme")||"light"}catch(e){return"light"}},vr=e=>{try{const t=document.documentElement;t.classList.remove("theme-light","theme-dark"),"dark"===e?(t.classList.add("theme-dark"),t.setAttribute("data-theme","dark")):(t.classList.add("theme-light"),t.setAttribute("data-theme","light"))}catch(t){}},_r={key:0,class:"loading-overlay"},wr={__name:"App",setup(e){var t;null==(t=k())||t.appContext.app;const r=Jt();p({get:()=>r.user,set:e=>{}}),p((()=>r.department)),K();const c=J(),d=se(),h=a(null),v=a("true"===localStorage.getItem("sideNavState")||window.innerWidth>=1264),_=a(!0);a(!1),a(!1);const w=a(window.innerWidth),b=p((()=>w.value<600?Math.min(200,.8*w.value):w.value<960?180:200)),E=p((()=>{var e;const t=(null==(e=c.from)?void 0:e.path)||"",r=c.path;if(!t)return"fade";const a=t.split("/").length,s=r.split("/").length;return a<s?"slide-left":a>s?"slide-right":"fade"}));f((()=>c.path),(e=>{h.value=e,window.innerWidth<600&&(v.value=!1)})),f((()=>v.value),(e=>{try{localStorage.setItem("sideNavState",e.toString())}catch(t){}}));const A=()=>{try{localStorage.removeItem("recentlyUsedRoutes"),sessionStorage.removeItem("redirectPath");["sideNavState","theme","lastVisitedRoutes"].forEach((e=>{try{localStorage.removeItem(e)}catch(t){}}))}catch(e){}window.location.reload()};s((async()=>{try{_.value=!0,(e=>{try{const t=localStorage.getItem("theme");if("auto"===t){const t=window.matchMedia("(prefers-color-scheme: dark)").matches;e.global.name.value=t?"dark":"light",window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(t=>{"auto"===localStorage.getItem("theme")&&(e.global.name.value=t.matches?"dark":"light")}))}else"light"===t||"dark"===t?e.global.name.value=t:(e.global.name.value="light",localStorage.setItem("theme","light"))}catch(t){e.global.name.value="light"}})(d),(e=>{vr(e.global.name.value),e.global.name.value&&f((()=>e.global.name.value),(e=>{vr(e)}))})(d),r.isLogin||await r.restoreSession()}catch(e){}finally{setTimeout((()=>{_.value=!1}),300)}window.addEventListener("resize",D)}));const D=()=>{w.value=window.innerWidth,window.innerWidth>=1264&&!v.value&&(v.value=!0)};return(e,t)=>{const r=P("router-view");return n(),u(pe,null,{default:l((()=>[_.value?(n(),i("div",_r,[o(G,{indeterminate:"",color:"primary",size:"64"}),t[3]||(t[3]=g("div",{class:"mt-4"}," 加载中... ",-1))])):(n(),i(y,{key:1},[o(fr,{drawer:v.value,"onUpdate:drawer":t[0]||(t[0]=e=>v.value=e)},null,8,["drawer"]),o(me,{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=e=>v.value=e),app:"",width:b.value,elevation:"4",class:"navigation-drawer"},{default:l((()=>[o(or,{drawer:v.value,"onUpdate:drawer":t[1]||(t[1]=e=>v.value=e),"show-bottom-actions":!0,"show-search":!0},{"bottom-actions":l((()=>[o(Y,{class:"refresh-item",rounded:"lg",onClick:A},{prepend:l((()=>[o(V,null,{default:l((()=>t[4]||(t[4]=[m("mdi-refresh")]))),_:1,__:[4]})])),default:l((()=>[o(X,null,{default:l((()=>t[5]||(t[5]=[m("刷新应用")]))),_:1,__:[5]})])),_:1})])),_:1},8,["drawer"])])),_:1},8,["modelValue","width"]),o(he,null,{default:l((()=>[o(r,null,{default:l((({Component:e})=>[o(R,{name:E.value,mode:"out-in"},{default:l((()=>[(n(),u(S(e)))])),_:2},1032,["name"])])),_:1})])),_:1}),o(Zt)],64))])),_:1})}}},br=fe({components:be,directives:we,locale:{locale:"zhHans",messages:{zhHans:_e}},theme:{defaultTheme:"light",themes:{light:{dark:!1,colors:{primary:"#1976D2","primary-darken-1":"#1565C0",secondary:"#424242","secondary-darken-1":"#1B5E20",accent:"#82B1FF",error:"#F44336",info:"#2196F3",success:"#4CAF50",warning:"#FF9800",background:"#FAFAFA",surface:"#FFFFFF","surface-bright":"#FFFFFF","surface-light":"#EEEEEE","surface-variant":"#424242","on-surface-variant":"#EEEEEE","primary-container":"#E3F2FD","on-primary-container":"#0D47A1","secondary-container":"#E8F5E8","on-secondary-container":"#1B5E20"}},dark:{dark:!0,colors:{primary:"#2196F3","primary-darken-1":"#1976D2",secondary:"#90CAF9","secondary-darken-1":"#42A5F5",accent:"#FF4081",error:"#FF5252",info:"#03DAC6",success:"#00E676",warning:"#FFB74D",background:"#121212",surface:"#1E1E1E","surface-bright":"#2C2C2C","surface-light":"#2C2C2C","surface-variant":"#424242","on-surface-variant":"#EEEEEE","primary-container":"#0D47A1","on-primary-container":"#E3F2FD","secondary-container":"#1B5E20","on-secondary-container":"#E8F5E8"}}}},icons:{defaultSet:"mdi",aliases:ve,sets:{mdi:ye}},defaults:{global:{density:"compact"},VBtn:{size:"default",variant:"flat"}},components:{VCalendar:ge}});const Er=new class{constructor(){this.lastErrorTime=0,this.errorThreshold=3e3,this.isProduction=!0,this.debugMode=!this.isProduction&&!1}throttledErrorMessage(e="应用发生错误，请刷新页面"){const t=Date.now();t-this.lastErrorTime>this.errorThreshold&&(this.lastErrorTime=t,Xe.error(e))}vueErrorHandler(e,t,r){var a;!this.isProduction||this.debugMode,this.isProduction&&this.reportErrorToServer({type:"vue",error:e.message,stack:e.stack,info:r,component:(null==(a=null==t?void 0:t.$options)?void 0:a._componentTag)||"未知组件",url:window.location.href}),e.isAxiosError||this.throttledErrorMessage("组件渲染错误，请刷新页面")}promiseErrorHandler(e){var t,r;e.reason&&!e.reason.isAxiosError&&(!this.isProduction||this.debugMode,this.isProduction&&this.reportErrorToServer({type:"promise",error:(null==(t=e.reason)?void 0:t.message)||"未知Promise错误",stack:null==(r=e.reason)?void 0:r.stack,url:window.location.href}),this.throttledErrorMessage("操作失败，请刷新重试"))}windowErrorHandler(e){var t,r;e&&(e.message&&(e.message.includes("Script error")||e.message.includes("ResizeObserver loop")||e.message.includes("ChunkLoadError"))||(!this.isProduction||this.debugMode,this.isProduction&&this.reportErrorToServer({type:"window",message:e.message,error:(null==(t=e.error)?void 0:t.message)||"未知错误",stack:(null==(r=e.error)?void 0:r.stack)||(new Error).stack,source:e.filename||"unknown",line:e.lineno||0,column:e.colno||0,url:window.location.href,timestamp:(new Date).toISOString()}),this.throttledErrorMessage()))}reportErrorToServer(e){try{const t={...e,userAgent:navigator.userAgent,screenSize:`${window.innerWidth}x${window.innerHeight}`,timestamp:(new Date).toISOString(),appVersion:"未知"};Lt.post("/logs/client-error",t).catch((e=>{this.debugMode}))}catch(t){this.debugMode}}install(e){e.config.errorHandler=this.vueErrorHandler.bind(this),window.addEventListener("unhandledrejection",this.promiseErrorHandler.bind(this)),window.addEventListener("error",this.windowErrorHandler.bind(this)),this.debugMode}};const kr=new class{constructor(){this.measures={},this.isSupported="undefined"!=typeof window&&window.performance&&window.performance.mark&&window.performance.measure,this.isSupported&&(this.observePageMetrics(),this.observeResourceLoading())}startMeasure(e){if(!this.isSupported)return;const t=`start_${e}`;window.performance.mark(t),this.measures[e]={start:t}}endMeasure(e){if(!this.isSupported||!this.measures[e])return null;const t=`end_${e}`,r=`measure_${e}`,{start:a}=this.measures[e];window.performance.mark(t),window.performance.measure(r,a,t);const s=window.performance.getEntriesByName(r)[0].duration;return this.clearMeasure(e),s}clearMeasure(e){if(!this.isSupported||!this.measures[e])return;const{start:t}=this.measures[e],r=`end_${e}`,a=`measure_${e}`;try{window.performance.clearMarks(t),window.performance.clearMarks(r),window.performance.clearMeasures(a)}catch(s){}delete this.measures[e]}observePageMetrics(){if("function"==typeof PerformanceObserver)try{const e=new PerformanceObserver((t=>{const r=t.getEntries()[0];this.reportMetric("FCP",r.startTime),e.disconnect()}));e.observe({type:"paint",buffered:!0});new PerformanceObserver((e=>{const t=e.getEntries().pop();this.reportMetric("LCP",t.startTime)})).observe({type:"largest-contentful-paint",buffered:!0});const t=new PerformanceObserver((e=>{const r=e.getEntries()[0];this.reportMetric("FID",r.processingStart-r.startTime),t.disconnect()}));t.observe({type:"first-input",buffered:!0});let r=0;new PerformanceObserver((e=>{for(const t of e.getEntries())t.hadRecentInput||(r+=t.value);this.reportMetric("CLS",r)})).observe({type:"layout-shift",buffered:!0})}catch(e){}}observeResourceLoading(){if("function"==typeof PerformanceObserver)try{new PerformanceObserver((e=>{const t=e.getEntries().filter((e=>e.duration>1e3));t.length>0&&this.reportSlowResources(t)})).observe({type:"resource",buffered:!0})}catch(e){}}reportMetric(e,t){}reportSlowResources(e){}install(e){e.config.globalProperties.$performance=this}},Pr="manage_",Rr="view_",Sr="edit_",Ar=(e,t)=>{if(!e||!t)return null;switch(e=e.toLowerCase(),t=t.toLowerCase()){case"read":return`${Rr}${e}`;case"write":return`${Sr}${e}`;case"admin":return`${Pr}${e}`;default:return null}},Dr={mounted(e,t){Tr(e,t)},updated(e,t){Tr(e,t)}};function Tr(e,t){var r;const a=et();let s=!1;if(a.isSuperUser)s=!0;else if("string"==typeof t.value)s=a.hasPermission(t.value);else if("object"==typeof t.value&&null!==t.value)if(t.value.code)s=a.hasPermission(t.value.code);else if(t.value.module&&t.value.level){const e=Ar(t.value.module,t.value.level);e&&(s=a.hasPermission(e))}else if(Array.isArray(t.value.codes)&&t.value.codes.length>0){s="and"===(t.value.logic||"or").toLowerCase()?t.value.codes.every((e=>a.hasPermission(e))):t.value.codes.some((e=>a.hasPermission(e)))}else if(Array.isArray(t.value.roles)&&t.value.roles.length>0){const e=a.userRoles;s=t.value.roles.some((t=>e.includes(t)))}if(!s){const a=t.modifiers||{};if(a.disable||a.hidden)a.disable?(e.disabled=!0,e.classList.add("permission-disabled"),e.style.cursor="not-allowed",e.style.opacity="0.6",e.addEventListener("click",Lr,!0)):a.hidden&&(e.style.display="none");else{const t=document.createComment(" 权限不足: 已隐藏元素 ");Object.defineProperty(t,"__permissionElement",{value:e,enumerable:!1}),null==(r=e.parentNode)||r.replaceChild(t,e)}}}function Lr(e){e.stopPropagation(),e.preventDefault()}const Ir={class:"loading-content"},Cr={class:"loading-spinner"},Mr={key:0,class:"loading-text"},$r={class:"loading-text-content"},xr=Qt({__name:"LoadingOverlay",props:{loading:{type:Boolean,default:!1},message:{type:String,default:"加载中..."},size:{type:Number,default:60},width:{type:Number,default:5},overlay:{type:Boolean,default:!0},blur:{type:Boolean,default:!0}},setup:e=>(t,r)=>(n(),u(R,{name:"fade",appear:""},{default:l((()=>[e.loading?(n(),i("div",{key:0,class:c(["loading-overlay",{"loading-overlay--blur":e.blur}])},[g("div",Ir,[g("div",Cr,[o(G,{size:e.size,width:e.width,indeterminate:"",color:"primary",class:"loading-circle"},null,8,["size","width"]),r[0]||(r[0]=g("div",{class:"loading-pulse"},null,-1))]),e.message?(n(),i("div",Mr,[g("span",$r,h(e.message),1),r[1]||(r[1]=g("div",{class:"loading-dots"},[g("span"),g("span"),g("span")],-1))])):d("",!0)])],2)):d("",!0)])),_:1}))},[["__scopeId","data-v-5df90171"]]),Or={class:"page-header"},Ur={class:"header-content"},Nr={class:"title-area"},jr={class:"text-h4 font-weight-bold"},Vr={key:0,class:"text-subtitle-1 text-medium-emphasis"},Fr={class:"actions-area"},Br=Qt({__name:"PageHeader",props:{title:{type:String,required:!0},subtitle:{type:String,default:""},showBreadcrumbs:{type:Boolean,default:!0},customBreadcrumbs:{type:Array,default:()=>[]}},setup(e){const t=e,r=J(),a=p((()=>{if(t.customBreadcrumbs.length>0)return t.customBreadcrumbs;const e=[{title:"首页",href:"/",disabled:!1}];if("/"===r.path)return e;const a=r.path.split("/").filter((e=>e));let s="";const i=a.map(((e,t)=>{s+=`/${e}`;const i=r.matched[t];let n=e.charAt(0).toUpperCase()+e.slice(1);return i&&i.meta.title&&(n=i.meta.title),{title:n,href:s,disabled:t===a.length-1}}));return[...e,...i]}));return(t,r)=>(n(),i("div",Or,[g("div",Ur,[g("div",Nr,[g("h1",jr,h(e.title),1),e.subtitle?(n(),i("p",Vr,h(e.subtitle),1)):d("",!0)]),g("div",Fr,[A(t.$slots,"actions",{},void 0)])]),e.showBreadcrumbs?(n(),u(ke,{key:0,items:a.value,class:"pa-0 mb-4"},{divider:l((()=>[o(V,{icon:"mdi-chevron-right",size:"small"})])),title:l((({item:e})=>[o(Ee,{title:e.title,href:e.href},null,8,["title","href"])])),_:1},8,["items"])):d("",!0)]))}},[["__scopeId","data-v-3cbd78b8"]]),zr={key:0,class:"icon-container mr-3"},Wr={class:"title-container"},qr={class:"page-title"},Hr={key:0,class:"page-subtitle"},Kr={class:"header-actions"},Jr={class:"page-content-wrapper"},Gr=Qt({__name:"UnifiedPageTemplate",props:{title:{type:String,required:!0},subtitle:{type:String,default:""},icon:{type:String,default:""},color:{type:String,default:"primary"},showBreadcrumbs:{type:Boolean,default:!0},customBreadcrumbs:{type:Array,default:()=>[]}},setup(e){const t=e,r=J(),a=p((()=>{if(t.customBreadcrumbs.length>0)return t.customBreadcrumbs;const e=[{title:"首页",href:"/",disabled:!1}];if("/"===r.path)return e;const a=r.path.split("/").filter((e=>e));let s="";const i=a.map(((e,t)=>{s+=`/${e}`;const i=r.matched[t];let n=e.charAt(0).toUpperCase()+e.slice(1);return i&&i.meta.title&&(n=i.meta.title),{title:n,href:s,disabled:t===a.length-1}}));return[...e,...i]}));return(t,r)=>(n(),u(ie,{fluid:"",class:"unified-page-container pa-0"},{default:l((()=>[o(N,{class:"unified-page-card",elevation:"0"},{default:l((()=>[o(j,{class:"unified-page-header d-flex align-center py-5 px-8"},{default:l((()=>[e.icon?(n(),i("div",zr,[o(V,{color:e.color,size:"28",class:"page-icon"},{default:l((()=>[m(h(e.icon),1)])),_:1},8,["color"])])):d("",!0),g("div",Wr,[g("h2",qr,h(e.title),1),e.subtitle?(n(),i("div",Hr,h(e.subtitle),1)):d("",!0)]),o(z),g("div",Kr,[A(t.$slots,"header-actions",{},void 0,!0)])])),_:3}),o(F,{class:"unified-page-content pa-8"},{default:l((()=>[e.showBreadcrumbs?(n(),u(ke,{key:0,items:a.value,class:"pa-0 mb-6 custom-breadcrumbs"},{divider:l((()=>[o(V,{icon:"mdi-chevron-right",size:"small",class:"breadcrumb-divider"})])),item:l((({item:e})=>[o(Ee,{href:e.href,disabled:e.disabled,class:"breadcrumb-item"},{default:l((()=>[m(h(e.title),1)])),_:2},1032,["href","disabled"])])),_:1},8,["items"])):d("",!0),g("div",Jr,[A(t.$slots,"default",{},void 0,!0)])])),_:3})])),_:3})])),_:3}))}},[["__scopeId","data-v-350a5d72"]]),Qr={class:"d-flex align-center mb-2"},Yr={class:"unified-stats-title"},Xr={class:"unified-stats-value-container my-2 d-flex align-center"},Zr={class:"unified-stats-value"},ea={key:0,class:"progress-container mb-2"},ta={key:1,class:"unified-stats-subtitle mt-auto"},ra=Qt({__name:"UnifiedStatsCard",props:{title:{type:String,required:!0},value:{type:[String,Number],default:"0"},subtitle:{type:String,default:""},icon:{type:String,default:""},color:{type:String,default:"primary"},change:{type:[Number,String],default:null},showChange:{type:Boolean,default:!1},showProgress:{type:Boolean,default:!1},outlined:{type:Boolean,default:!1},elevation:{type:[Number,String],default:2}},setup(e){const t=e,r=p((()=>t.outlined?t.color:"white")),a=p((()=>t.outlined?void 0:"white")),s=p((()=>{if(null===t.change)return"";return("string"==typeof t.change?parseFloat(t.change.replace(/[+%]/g,"")):t.change)>=0?"text-success":"text-error"})),f=e=>{if("string"==typeof e)return e.startsWith("+")||e.startsWith("-")?e:parseFloat(e)>=0?`+${e}`:e;if("number"==typeof e){if(Number.isInteger(e))return e>0?`+${e}`:`${e}`;const t=e.toFixed(1);return e>0?`+${t}%`:`${t}%`}return e};return(t,p)=>(n(),u(N,{class:"unified-stats-card h-100",elevation:e.elevation,color:a.value},{default:l((()=>[o(F,{class:"d-flex flex-column h-100"},{default:l((()=>[g("div",Qr,[e.icon?(n(),i("div",{key:0,class:c(["unified-stats-icon",`bg-${e.color}-light`])},[o(V,{color:r.value,size:"24"},{default:l((()=>[m(h(e.icon),1)])),_:1},8,["color"])],2)):d("",!0),g("div",Yr,h(e.title),1)]),g("div",Xr,[g("div",Zr,[A(t.$slots,"value",{},(()=>[m(h(e.value),1)]),!0)]),e.showChange&&null!==e.change?(n(),i("div",{key:0,class:c(["unified-stats-change ms-3",s.value])},[o(V,{size:"small",class:"mr-1"},{default:l((()=>[m(h(e.change>=0?"mdi-arrow-up":"mdi-arrow-down"),1)])),_:1}),g("span",null,h(f(e.change)),1)],2)):d("",!0)]),e.showProgress&&"string"==typeof e.value&&e.value.includes("%")?(n(),i("div",ea,[o(Pe,{"model-value":parseFloat(e.value),color:e.color,height:"6",rounded:""},null,8,["model-value","color"])])):d("",!0),e.subtitle||t.$slots.subtitle?(n(),i("div",ta,[A(t.$slots,"subtitle",{},(()=>[m(h(e.subtitle),1)]),!0)])):d("",!0)])),_:3})])),_:3},8,["elevation","color"]))}},[["__scopeId","data-v-9b45656a"]]),aa={class:"d-flex flex-column align-center py-6"},sa=Qt({__name:"UnifiedDataTable",props:{title:{type:String,default:""},icon:{type:String,default:""},iconColor:{type:String,default:"primary"},headers:{type:Array,default:()=>[]},items:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},itemsPerPage:{type:Number,default:10},hideDefaultFooter:{type:Boolean,default:!1},hideNoData:{type:Boolean,default:!1},density:{type:String,default:"comfortable"},hover:{type:Boolean,default:!1},search:{type:String,default:""},elevation:{type:[Number,String],default:1},noPadding:{type:Boolean,default:!1},tableClass:{type:String,default:""},contentClass:{type:String,default:""}},setup(e){const t=e;f((()=>t.items),(e=>{e&&Array.isArray(e)}),{immediate:!0});const r=p((()=>{const e=t.contentClass||"";return[t.noPadding?"pa-0":"",e].filter(Boolean).join(" ")})),a=p((()=>Array.isArray(t.headers)?t.headers:[])),s=p((()=>Array.isArray(t.items)?t.items:[]));return(t,i)=>(n(),u(N,{class:"unified-data-table",elevation:e.elevation},{default:l((()=>[e.title||t.$slots.title?(n(),u(j,{key:0,class:"unified-data-table-title d-flex align-center"},{default:l((()=>[e.icon?(n(),u(V,{key:0,class:"mr-2",color:e.iconColor},{default:l((()=>[m(h(e.icon),1)])),_:1},8,["color"])):d("",!0),A(t.$slots,"title",{},(()=>[m(h(e.title),1)]),!0),o(z),A(t.$slots,"actions",{},void 0,!0)])),_:3})):d("",!0),e.title||t.$slots.title?(n(),u(re,{key:1})):d("",!0),o(F,{class:c(r.value)},{default:l((()=>[A(t.$slots,"pre-table",{},void 0,!0),o(Re,E({headers:a.value,items:s.value,loading:e.loading,"items-per-page":e.itemsPerPage,"hide-default-footer":e.hideDefaultFooter,"hide-no-data":e.hideNoData,density:e.density,hover:e.hover,search:e.search,class:e.tableClass},t.$attrs,{"onUpdate:page":i[0]||(i[0]=e=>t.$emit("update:page",e)),"onUpdate:itemsPerPage":i[1]||(i[1]=e=>t.$emit("update:items-per-page",e))}),w({loading:l((()=>[A(t.$slots,"loading",{},(()=>[o(Se,{type:"table-row-divider@3",class:"pa-4"})]),!0)])),"no-data":l((()=>[A(t.$slots,"no-data",{},(()=>[g("div",aa,[o(V,{size:"48",color:"grey-lighten-1",class:"mb-2"},{default:l((()=>i[2]||(i[2]=[m(" mdi-database-off ")]))),_:1,__:[2]}),i[3]||(i[3]=g("div",{class:"text-subtitle-1 text-medium-emphasis"}," 暂无数据 ",-1))])]),!0)])),_:2},[v(t.$slots,((e,r)=>({name:r,fn:l((e=>[A(t.$slots,r,D(T(e)),void 0,!0)]))})))]),1040,["headers","items","loading","items-per-page","hide-default-footer","hide-no-data","density","hover","search","class"]),A(t.$slots,"post-table",{},void 0,!0)])),_:3},8,["class"]),t.$slots.footer?(n(),u(B,{key:2,class:"unified-data-table-footer"},{default:l((()=>[A(t.$slots,"footer",{},void 0,!0)])),_:3})):d("",!0)])),_:3},8,["elevation"]))}},[["__scopeId","data-v-0f0d2a73"]]),ia=Qt({__name:"UnifiedForm",props:{title:{type:String,default:""},icon:{type:String,default:""},iconColor:{type:String,default:"primary"},submitText:{type:String,default:"提交"},resetText:{type:String,default:"重置"},showDefaultActions:{type:Boolean,default:!0},showReset:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},disableSubmit:{type:Boolean,default:!0},elevation:{type:[Number,String],default:1}},emits:["submit","reset","update:valid"],setup(e,{expose:t,emit:r}){const s=e,i=r;a(null);const c=a(null),f=a(!0),g=()=>{s.disableSubmit&&!f.value||i("submit",{valid:f.value,form:c.value})},y=()=>{var e;null==(e=c.value)||e.reset(),i("reset")};return p({get:()=>f.value,set:e=>{f.value=e,i("update:valid",e)}}),t({validate:()=>{var e;return null==(e=c.value)?void 0:e.validate()},reset:()=>{var e;return null==(e=c.value)?void 0:e.reset()},resetValidation:()=>{var e;return null==(e=c.value)?void 0:e.resetValidation()}}),(t,r)=>(n(),u(Ae,{ref_key:"formRef",ref:c,modelValue:f.value,"onUpdate:modelValue":r[0]||(r[0]=e=>f.value=e),class:"unified-form",onSubmit:L(g,["prevent"])},{default:l((()=>[o(N,{class:"unified-form-card",elevation:e.elevation},{default:l((()=>[e.title||t.$slots.title?(n(),u(j,{key:0,class:"unified-form-title d-flex align-center"},{default:l((()=>[e.icon?(n(),u(V,{key:0,class:"mr-2",color:e.iconColor},{default:l((()=>[m(h(e.icon),1)])),_:1},8,["color"])):d("",!0),A(t.$slots,"title",{},(()=>[m(h(e.title),1)]),!0)])),_:3})):d("",!0),e.title||t.$slots.title?(n(),u(re,{key:1})):d("",!0),o(F,{class:"unified-form-content"},{default:l((()=>[A(t.$slots,"default",{},void 0,!0)])),_:3}),t.$slots.actions||e.showDefaultActions?(n(),u(B,{key:2,class:"unified-form-actions"},{default:l((()=>[A(t.$slots,"actions",{},(()=>[o(z),e.showReset?(n(),u(W,{key:0,variant:"outlined",color:"grey",class:"mr-2",disabled:e.loading,onClick:y},{default:l((()=>[m(h(e.resetText),1)])),_:1},8,["disabled"])):d("",!0),o(W,{type:"submit",color:"primary",loading:e.loading,disabled:!!e.disableSubmit&&!f.value},{default:l((()=>[m(h(e.submitText),1)])),_:1},8,["loading","disabled"])]),!0)])),_:3})):d("",!0)])),_:3},8,["elevation"])])),_:3},8,["modelValue"]))}},[["__scopeId","data-v-ae45bef9"]]),na=I({name:"PermissionControl",props:{module:{type:String,default:null},level:{type:String,default:null},departmentId:{type:[Number,String],default:null},permissions:{type:Array,default:()=>[]},logic:{type:String,default:"or",validator:e=>["and","or"].includes(e.toLowerCase())},roles:{type:Array,default:()=>[]},showUnauthorized:{type:Boolean,default:!1},unauthorizedText:{type:String,default:"您没有权限查看此内容"}},setup(e){const t=et();return{hasPermission:p((()=>{if(t.isSuperUser)return!0;if(e.module&&e.level)return`${e.module}_${e.level}`.toLowerCase(),tt();if(e.permissions&&e.permissions.length>0){const t="and"===e.logic.toLowerCase()?"every":"some";return e.permissions[t]((e=>tt()))}return!!(e.roles&&e.roles.length>0)&&e.roles.some((e=>t.hasRole(e)))}))}}}),oa={key:0,class:"permission-denied"},la={class:"permission-denied-text"};const ca=Qt(na,[["render",function(e,t,r,a,s,o){return n(),i("div",null,[e.hasPermission?A(e.$slots,"default",{key:0},void 0):A(e.$slots,"unauthorized",{key:1},(()=>[e.showUnauthorized?(n(),i("div",oa,[t[0]||(t[0]=g("div",{class:"permission-denied-icon"},[g("i",{class:"ri-lock-line"})],-1)),g("div",la,h(e.unauthorizedText),1)])):d("",!0)]))])}],["__scopeId","data-v-9437d533"]]);const ua=new class{constructor(){this.isRegistered=!1,this.registrationPromise=null}getAvailableComponents(){return Object.keys(at)}async registerComponents(){return!!this.isRegistered||(this.registrationPromise||(this.registrationPromise=this._performRegistration()),this.registrationPromise)}async _performRegistration(){var e;try{const e=this.getAvailableComponents(),t=await Lt.post("/routes/components/register",{components:e});if(t.data&&t.data.success)return this.isRegistered=!0,!0;throw new Error("后端返回注册失败")}catch(t){return"NETWORK_ERROR"===t.code||(null==(e=t.response)||e.status),!1}finally{this.registrationPromise=null}}resetRegistration(){this.isRegistered=!1,this.registrationPromise=null}validateComponentMap(){const e=this.getAvailableComponents(),t={total:e.length,valid:0,invalid:[],details:[]};return e.forEach((e=>{try{const r=at[e];"function"==typeof r?(t.valid++,t.details.push({name:e,status:"valid",type:"function"})):(t.invalid.push(e),t.details.push({name:e,status:"invalid",type:typeof r,error:"Not a function"}))}catch(r){t.invalid.push(e),t.details.push({name:e,status:"invalid",error:r.message})}})),t}getRegistrationStatus(){return{isRegistered:this.isRegistered,isRegistering:!!this.registrationPromise,availableComponents:this.getAvailableComponents(),componentCount:this.getAvailableComponents().length}}async autoRegister(e={}){const{retryDelay:t=5e3,maxRetries:r=3}=e;for(let a=1;a<=r;a++){if(await this.registerComponents())return!0;a<r&&(await new Promise((e=>setTimeout(e,t))),this.resetRegistration())}return!1}};Ie([Ce,Me,$e,xe,Oe,Ue,Ne,je,Ve,Fe,Be,ze,We,qe,He,Ke]);const da=C(wr);da.use(Gt),da.use(ut),da.use(br),da.use(Er),da.use(kr),da.directive("permission",Dr),function(e){e.provide(De,"light"),e.component("VChart",Te),e.component("GlobalNotification",Xt),e.component("LoadingOverlay",xr),e.component("PageHeader",Br),e.component("GlobalSnackbar",Zt),e.component("UnifiedPageTemplate",Gr),e.component("UnifiedStatsCard",ra),e.component("UnifiedDataTable",sa),e.component("UnifiedForm",ia),e.component("PermissionControl",ca),e.component("RiIcon",{props:{icon:{type:String,required:!0},size:{type:[String,Number],default:"24px"}},template:"\n      <i :class=\"['ri-' + icon, 'remixicon']\" :style=\"{ fontSize: size }\"></i>\n    "})}(da),da.config.globalProperties.$services=Ht;const ma=da.mount("#app");!function(e,t){e.config.globalProperties.$notify={show:(e,r="info",a=3e3)=>{var s;null==(s=t.$refs.globalSnackbar)||s.show({text:e,color:r,timeout:a})},success:(e,r=3e3)=>{var a;null==(a=t.$refs.globalSnackbar)||a.show({text:e,color:"success",timeout:r})},error:(e,r=3e3)=>{var a;null==(a=t.$refs.globalSnackbar)||a.show({text:e,color:"error",timeout:r})},warning:(e,r=3e3)=>{var a;null==(a=t.$refs.globalSnackbar)||a.show({text:e,color:"warning",timeout:r})},info:(e,r=3e3)=>{var a;null==(a=t.$refs.globalSnackbar)||a.show({text:e,color:"info",timeout:r})}},e.provide("globalNotification",null),e.provide("globalSnackbar",null),e.config.globalProperties.$updateGlobalComponents=()=>{var t,r,a,s;const i=null==(r=null==(t=document.querySelector(".global-notification"))?void 0:t.__vueParentComponent)?void 0:r.ctx,n=null==(s=null==(a=document.querySelector(".global-snackbar"))?void 0:a.__vueParentComponent)?void 0:s.ctx;i&&(e._context.provides.globalNotification=i),n&&(e._context.provides.globalSnackbar=n)}}(da,ma),window&&(window.__VUE_APP__=ma),async function(){try{await ua.autoRegister({retryDelay:2e3,maxRetries:2});return{success:!0,routes:await ht()}}catch(e){return{success:!1,error:e}}}().then((e=>{e.success}));export{Xe as M,sa as U,Qt as _,et as a,Lt as b,xr as c,Gr as d,ra as e,ia as f,yr as g,Ge as h,At as i,bt as j,Dt as k,Ut as l,Vt as m,Qe as n,at as o,Tt as p,ua as q,Ze as r,gr as s,lt as t,Jt as u};
