import{r as e,d as a,w as l,ae as t,ac as i,ad as o,H as u,K as d,X as s,a4 as n,af as c,a as r,N as m,an as v,ak as _,ab as p,W as f}from"./chunk-vendors.D0_dqILu.js";import{_ as y,u as g,d as V,b,M as k}from"./entry-index.D92NaooR.js";import{V as h,e as w,k as U,v as C,g as x,W as z,z as j,A as T,Z as I,ae as N,ab as M,h as D,j as P,l as W,$ as A,f as B,aa as E,aw as O}from"./chunk-vue-core.CxEQweee.js";import"./chunk-utils-vendor.DVew6AbD.js";import"./chunk-chart-core.HkgdsJMe.js";const R=y({__name:"MaterialDialog",props:{modelValue:Boolean,material:Object,isNew:Boolean,loading:Boolean},emits:["update:modelValue","update:material","save","close"],setup(c,{emit:r}){const m=c,v=r,_=e(null),p=e(!1),f=e({}),y=a({get:()=>m.modelValue,set:e=>v("update:modelValue",e)}),g={required:e=>!!e||"此字段为必填项"},V=async()=>{const{valid:e}=await _.value.validate();e&&v("save",f.value)},b=()=>{v("close")};return l((()=>m.material),(e=>{e&&(f.value={...e})}),{immediate:!0,deep:!0}),l(y,(e=>{e&&_.value&&_.value.resetValidation()})),(e,a)=>(i(),t(W,{modelValue:y.value,"onUpdate:modelValue":a[9]||(a[9]=e=>y.value=e),"max-width":"600",persistent:""},{default:o((()=>[u(h,null,{default:o((()=>[u(w,{class:"d-flex justify-space-between align-center"},{default:o((()=>[d("span",null,s(c.isNew?"新建物料":"编辑物料"),1),u(U,{icon:"mdi-close",variant:"text",onClick:b})])),_:1}),u(C),u(x,{class:"pa-6"},{default:o((()=>[u(z,{ref_key:"formRef",ref:_,modelValue:p.value,"onUpdate:modelValue":a[8]||(a[8]=e=>p.value=e)},{default:o((()=>[u(j,null,{default:o((()=>[u(T,{cols:"12"},{default:o((()=>a[10]||(a[10]=[d("h4",{class:"text-subtitle-1 mb-3"}," 基本信息 ",-1)]))),_:1,__:[10]}),u(T,{cols:"12",md:"6"},{default:o((()=>[u(I,{modelValue:f.value.material_code,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value.material_code=e),label:"物料编码",rules:[g.required],variant:"outlined",density:"compact"},null,8,["modelValue","rules"])])),_:1}),u(T,{cols:"12",md:"6"},{default:o((()=>[u(I,{modelValue:f.value.material_name,"onUpdate:modelValue":a[1]||(a[1]=e=>f.value.material_name=e),label:"物料名称",rules:[g.required],variant:"outlined",density:"compact"},null,8,["modelValue","rules"])])),_:1}),u(T,{cols:"12",md:"6"},{default:o((()=>[u(I,{modelValue:f.value.brand,"onUpdate:modelValue":a[2]||(a[2]=e=>f.value.brand=e),label:"品牌",variant:"outlined",density:"compact"},null,8,["modelValue"])])),_:1}),u(T,{cols:"12",md:"6"},{default:o((()=>[u(I,{modelValue:f.value.unit,"onUpdate:modelValue":a[3]||(a[3]=e=>f.value.unit=e),label:"单位",placeholder:"如：个、台、米、公斤等",variant:"outlined",density:"compact"},null,8,["modelValue"])])),_:1}),u(T,{cols:"12",md:"6"},{default:o((()=>[u(I,{modelValue:f.value.category,"onUpdate:modelValue":a[4]||(a[4]=e=>f.value.category=e),label:"物料分类",placeholder:"如：设备配件、工具、消耗品等",variant:"outlined",density:"compact"},null,8,["modelValue"])])),_:1}),u(T,{cols:"12",md:"6"},{default:o((()=>[u(N,{modelValue:f.value.is_active,"onUpdate:modelValue":a[5]||(a[5]=e=>f.value.is_active=e),label:"是否启用",color:"success",inset:""},null,8,["modelValue"])])),_:1}),u(T,{cols:"12"},{default:o((()=>[u(M,{modelValue:f.value.specification,"onUpdate:modelValue":a[6]||(a[6]=e=>f.value.specification=e),label:"规格型号",rows:"2",variant:"outlined",density:"compact"},null,8,["modelValue"])])),_:1}),u(T,{cols:"12"},{default:o((()=>[u(M,{modelValue:f.value.description,"onUpdate:modelValue":a[7]||(a[7]=e=>f.value.description=e),label:"描述",rows:"3",variant:"outlined",density:"compact"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),u(C),u(D,{class:"pa-4"},{default:o((()=>[u(P),u(U,{onClick:b},{default:o((()=>a[11]||(a[11]=[n(" 取消 ")]))),_:1,__:[11]}),u(U,{color:"primary",loading:c.loading,disabled:!p.value,onClick:V},{default:o((()=>[n(s(c.isNew?"创建":"更新"),1)])),_:1},8,["loading","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue"]))}},[["__scopeId","data-v-9e70f23a"]]),$=y({__name:"MaterialDetailDialog",props:{modelValue:Boolean,material:Object},emits:["update:modelValue","close"],setup(e,{emit:l}){const r=e,m=l,v=a({get:()=>r.modelValue,set:e=>m("update:modelValue",e)}),_=()=>{m("close")};return(a,l)=>(i(),t(W,{modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=e=>v.value=e),"max-width":"700",persistent:""},{default:o((()=>[e.material?(i(),t(h,{key:0},{default:o((()=>[u(w,{class:"d-flex justify-space-between align-center"},{default:o((()=>[d("div",null,[l[1]||(l[1]=d("span",null,"物料详情",-1)),u(A,{color:e.material.is_active?"success":"error",size:"small",variant:"flat",class:"ml-2"},{default:o((()=>[n(s(e.material.is_active?"启用":"停用"),1)])),_:1},8,["color"])]),u(U,{icon:"mdi-close",variant:"text",onClick:_})])),_:1}),u(C),u(x,{class:"pa-6"},{default:o((()=>[u(j,null,{default:o((()=>[u(T,{cols:"12"},{default:o((()=>l[2]||(l[2]=[d("h4",{class:"text-subtitle-1 mb-3"}," 基本信息 ",-1)]))),_:1,__:[2]}),u(T,{cols:"12",md:"6"},{default:o((()=>[u(I,{"model-value":e.material.material_code,label:"物料编码",readonly:"",variant:"outlined",density:"compact"},null,8,["model-value"])])),_:1}),u(T,{cols:"12",md:"6"},{default:o((()=>[u(I,{"model-value":e.material.material_name,label:"物料名称",readonly:"",variant:"outlined",density:"compact"},null,8,["model-value"])])),_:1}),u(T,{cols:"12",md:"6"},{default:o((()=>[u(I,{"model-value":e.material.brand||"-",label:"品牌",readonly:"",variant:"outlined",density:"compact"},null,8,["model-value"])])),_:1}),u(T,{cols:"12",md:"6"},{default:o((()=>[u(I,{"model-value":e.material.unit||"-",label:"单位",readonly:"",variant:"outlined",density:"compact"},null,8,["model-value"])])),_:1}),u(T,{cols:"12",md:"6"},{default:o((()=>[u(I,{"model-value":e.material.category||"-",label:"物料分类",readonly:"",variant:"outlined",density:"compact"},null,8,["model-value"])])),_:1}),u(T,{cols:"12",md:"6"},{default:o((()=>{return[u(I,{"model-value":(a=e.material.created_at,a?new Date(a).toLocaleString("zh-CN"):"-"),label:"创建时间",readonly:"",variant:"outlined",density:"compact"},null,8,["model-value"])];var a})),_:1}),e.material.specification?(i(),t(T,{key:0,cols:"12"},{default:o((()=>[u(M,{"model-value":e.material.specification,label:"规格型号",readonly:"",variant:"outlined",density:"compact",rows:"2"},null,8,["model-value"])])),_:1})):c("",!0),e.material.description?(i(),t(T,{key:1,cols:"12"},{default:o((()=>[u(M,{"model-value":e.material.description,label:"描述",readonly:"",variant:"outlined",density:"compact",rows:"3"},null,8,["model-value"])])),_:1})):c("",!0)])),_:1})])),_:1}),u(C),u(D,{class:"pa-4"},{default:o((()=>[u(P),u(U,{onClick:_},{default:o((()=>l[3]||(l[3]=[n(" 关闭 ")]))),_:1,__:[3]})])),_:1})])),_:1})):c("",!0)])),_:1},8,["modelValue"]))}},[["__scopeId","data-v-998dfd75"]]),q={class:"font-weight-medium"},K={key:1},S=y({__name:"MaterialManagement",setup(y){const C=e(!1),z=e(!1),N=e(!1),M=e(!1),S=e(!1),L=e(!1),H=e([]),X=e(-1),Z=e({}),F=e(null),G=e(null),J=r({is_active:null,category:"",search:""}),Q=r({page:1,page_size:20,total:0}),Y=g(),ee=[{title:"物料编码",key:"material_code",sortable:!1},{title:"物料名称",key:"material_name",sortable:!1},{title:"规格",key:"specification",sortable:!1},{title:"品牌",key:"brand",sortable:!1},{title:"单位",key:"unit",sortable:!1},{title:"分类",key:"category",sortable:!1},{title:"状态",key:"is_active",sortable:!1},{title:"创建时间",key:"created_at",sortable:!1},{title:"操作",key:"actions",sortable:!1,width:150}],ae=a((()=>e=>Y.hasPermission("MAINT","WRITE"))),le=a((()=>e=>Y.hasPermission("MAINT","WRITE"))),te=async()=>{try{C.value=!0;const e={page:Q.page,page_size:Q.page_size,...J};Object.keys(e).forEach((a=>{null!==e[a]&&""!==e[a]||delete e[a]}));const a=(await b.get("/materials/",{params:e})).data;H.value=a.items,Q.total=a.total}catch(e){k.error("加载物料列表失败")}finally{C.value=!1}},ie=e=>{Q.page=e.page,Q.page_size=e.itemsPerPage,te()},oe=()=>{X.value=-1,Z.value={material_code:"",material_name:"",specification:"",brand:"",unit:"",category:"",description:"",is_active:!0},M.value=!0},ue=()=>{M.value=!1,Z.value={},X.value=-1},de=async e=>{var a,l;try{z.value=!0,-1===X.value?(await b.post("/materials/",e),k.success("物料创建成功")):(await b.put(`/materials/${Z.value.id}`,e),k.success("物料更新成功")),ue(),te()}catch(t){k.error("保存物料失败: "+((null==(l=null==(a=t.response)?void 0:a.data)?void 0:l.detail)||t.message))}finally{z.value=!1}},se=()=>{S.value=!1,F.value=null},ne=async()=>{var e,a;try{N.value=!0;const e=!G.value.is_active;await b.put(`/materials/${G.value.id}`,{is_active:e}),k.success("物料已"+(e?"启用":"停用")),L.value=!1,G.value=null,te()}catch(l){k.error("更改物料状态失败: "+((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.detail)||l.message))}finally{N.value=!1}};return l((()=>J.search),(()=>{clearTimeout(window.searchTimeout),window.searchTimeout=setTimeout((()=>{Q.page=1,te()}),500)})),l((()=>J.category),(()=>{Q.page=1,te()})),m((()=>{te()})),(e,a)=>{const l=v("permission");return i(),t(V,{title:"物料管理",icon:"mdi-package-variant",color:"success"},{"header-actions":o((()=>[f((i(),t(U,{color:"primary","prepend-icon":"mdi-plus",onClick:oe},{default:o((()=>a[10]||(a[10]=[n(" 新建物料 ")]))),_:1,__:[10]})),[[l,"MAINT:WRITE"]])])),default:o((()=>[u(h,{class:"mb-4",rounded:"lg"},{default:o((()=>[u(w,{class:"d-flex align-center"},{default:o((()=>[u(B,{color:"success",class:"mr-2"},{default:o((()=>a[11]||(a[11]=[n(" mdi-filter-variant ")]))),_:1,__:[11]}),a[12]||(a[12]=d("span",null,"筛选条件",-1))])),_:1,__:[12]}),u(x,null,{default:o((()=>[u(j,null,{default:o((()=>[u(T,{cols:"12",md:"3"},{default:o((()=>[u(E,{modelValue:J.is_active,"onUpdate:modelValue":[a[0]||(a[0]=e=>J.is_active=e),te],items:[{title:"全部",value:null},{title:"启用",value:!0},{title:"停用",value:!1}],label:"状态筛选",clearable:"",variant:"outlined",density:"compact"},null,8,["modelValue"])])),_:1}),u(T,{cols:"12",md:"3"},{default:o((()=>[u(I,{modelValue:J.category,"onUpdate:modelValue":a[1]||(a[1]=e=>J.category=e),label:"物料分类",variant:"outlined",density:"compact",clearable:"",onKeyup:_(te,["enter"]),"onClick:clear":te},null,8,["modelValue"])])),_:1}),u(T,{cols:"12",md:"6"},{default:o((()=>[u(I,{modelValue:J.search,"onUpdate:modelValue":a[2]||(a[2]=e=>J.search=e),label:"搜索",placeholder:"物料名称、编码、规格或品牌","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onKeyup:_(te,["enter"]),"onClick:clear":te},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),u(h,{rounded:"lg"},{default:o((()=>[u(w,{class:"d-flex align-center"},{default:o((()=>[u(B,{color:"success",class:"mr-2"},{default:o((()=>a[13]||(a[13]=[n(" mdi-format-list-bulleted ")]))),_:1,__:[13]}),a[14]||(a[14]=d("span",null,"物料列表",-1)),u(P),H.value.length>0?(i(),t(A,{key:0,color:"success",variant:"outlined",size:"small"},{default:o((()=>[n(" 共 "+s(Q.total)+" 条记录 ",1)])),_:1})):c("",!0)])),_:1,__:[14]}),u(x,null,{default:o((()=>[u(O,{"items-per-page":Q.page_size,"onUpdate:itemsPerPage":a[3]||(a[3]=e=>Q.page_size=e),page:Q.page,"onUpdate:page":a[4]||(a[4]=e=>Q.page=e),headers:ee,items:H.value,"items-length":Q.total,loading:C.value,"item-value":"id",density:"compact",hover:!1,class:"unified-table","onUpdate:options":ie},{"item.material_code":o((({item:e})=>[u(A,{color:"primary",variant:"outlined",size:"small"},{default:o((()=>[n(s(e.material_code),1)])),_:2},1024)])),"item.is_active":o((({item:e})=>[u(A,{color:e.is_active?"success":"error",size:"small",variant:"flat"},{default:o((()=>[n(s(e.is_active?"启用":"停用"),1)])),_:2},1032,["color"])])),"item.material_name":o((({item:e})=>[d("span",q,s(e.material_name),1)])),"item.specification":o((({item:e})=>[d("span",null,s(e.specification||"-"),1)])),"item.brand":o((({item:e})=>[d("span",null,s(e.brand||"-"),1)])),"item.category":o((({item:e})=>[e.category?(i(),t(A,{key:0,color:"info",variant:"outlined",size:"small"},{default:o((()=>[n(s(e.category),1)])),_:2},1024)):(i(),p("span",K,"-"))])),"item.created_at":o((({item:e})=>{return[n(s((a=e.created_at,a?new Date(a).toLocaleDateString("zh-CN"):"-")),1)];var a})),"item.actions":o((({item:e})=>[u(U,{icon:"mdi-eye",size:"small",variant:"text",title:"查看详情",onClick:a=>(async e=>{try{const a=await b.get(`/materials/${e.id}`);F.value=a.data,S.value=!0}catch(a){k.error("获取物料详情失败")}})(e)},null,8,["onClick"]),ae.value(e)?(i(),t(U,{key:0,icon:"mdi-pencil",size:"small",variant:"text",title:"编辑",onClick:a=>(e=>{X.value=H.value.indexOf(e),Z.value={...e},M.value=!0})(e)},null,8,["onClick"])):c("",!0),le.value(e)?(i(),t(U,{key:1,icon:e.is_active?"mdi-pause":"mdi-play",size:"small",variant:"text",color:e.is_active?"warning":"success",title:e.is_active?"停用":"启用",onClick:a=>(e=>{G.value=e,L.value=!0})(e)},null,8,["icon","color","title","onClick"])):c("",!0)])),_:1},8,["items-per-page","page","items","items-length","loading"])])),_:1})])),_:1}),u(R,{modelValue:M.value,"onUpdate:modelValue":a[5]||(a[5]=e=>M.value=e),material:Z.value,"onUpdate:material":a[6]||(a[6]=e=>Z.value=e),"is-new":-1===X.value,loading:z.value,onSave:de,onClose:ue},null,8,["modelValue","material","is-new","loading"]),u($,{modelValue:S.value,"onUpdate:modelValue":a[7]||(a[7]=e=>S.value=e),material:F.value,onClose:se},null,8,["modelValue","material"]),u(W,{modelValue:L.value,"onUpdate:modelValue":a[9]||(a[9]=e=>L.value=e),"max-width":"400"},{default:o((()=>[u(h,null,{default:o((()=>[u(w,null,{default:o((()=>a[15]||(a[15]=[n("确认操作")]))),_:1,__:[15]}),u(x,null,{default:o((()=>{var e,a;return[n(" 确定要"+s((null==(e=G.value)?void 0:e.is_active)?"停用":"启用")+'物料 "'+s(null==(a=G.value)?void 0:a.material_name)+'" 吗？ ',1)]})),_:1}),u(D,null,{default:o((()=>{var e;return[u(P),u(U,{onClick:a[8]||(a[8]=e=>L.value=!1)},{default:o((()=>a[16]||(a[16]=[n(" 取消 ")]))),_:1,__:[16]}),u(U,{color:(null==(e=G.value)?void 0:e.is_active)?"warning":"success",loading:N.value,onClick:ne},{default:o((()=>{var e;return[n(s((null==(e=G.value)?void 0:e.is_active)?"停用":"启用"),1)]})),_:1},8,["color","loading"])]})),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}}},[["__scopeId","data-v-a17cc8d6"]]);export{S as default};
