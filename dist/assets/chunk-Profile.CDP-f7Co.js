import{x as e,u as a,z as l,A as t,V as s,g as d,C as o,$ as r,e as n,w as i,q as u,f as c,v as m,Z as p,aa as f,ab as _,k as v,l as h,h as w,j as y}from"./chunk-vue-core.CxEQweee.js";import{_ as b,u as g,b as V,M as k,d as x,f as P}from"./entry-index.D92NaooR.js";import{r as U,a as C,d as j,N as q,ae as I,ad as z,ac as A,H as D,K as F,X as N,u as R,a4 as $}from"./chunk-vendors.D0_dqILu.js";import"./chunk-chart-core.HkgdsJMe.js";import"./chunk-utils-vendor.DVew6AbD.js";const H={class:"text-h3 text-white"},K={class:"text-h5 mb-2"},M={class:"text-subtitle-1 text-grey-600 mb-1"},S={class:"text-body-2 text-grey-500 mb-4"},X=b({__name:"Profile",setup(b){const X=a(),Z=e(),B=g(),E=U(!1),G=U(!1),J=U(!1),L=U([]),O=U(null),Q=U(null),T=C({name:"",email:"",phone:"",department_id:"",description:""}),W=C({currentPassword:"",newPassword:"",confirmPassword:""}),Y={required:e=>null!=e&&""!==e||"此字段为必填项",email:e=>!e||/.+@.+\..+/.test(e)||"请输入有效的邮箱地址",password:e=>!e||e.length>=6||"密码长度至少6位"},ee=()=>W.newPassword===W.confirmPassword||"两次输入的密码不一致",ae=j((()=>B.user?B.user.charAt(0).toUpperCase():"")),le=e=>{const a=L.value.find((a=>a.id===e));return(null==a?void 0:a.name)||"未分配"};q((async()=>{await te(),await se()}));const te=async()=>{try{const e=(await V.get("/users/me")).data;T.name=e.user_name||B.user||"",T.email=e.email||"",T.phone=e.phone||"",T.department_id=e.department||B.department||"",T.description=e.description||""}catch(e){k.error("加载用户资料失败")}},se=async()=>{try{const e=await V.get("/departments");L.value=e.data||[]}catch(e){L.value=[]}},de=async()=>{var e,a;try{const{valid:e}=await O.value.validate();if(!e)return;E.value=!0,await V.put("/users/me",{user_name:T.name,email:T.email,phone:T.phone,description:T.description}),B.setUserData({user:T.name,department:T.department_id}),k.success("个人资料更新成功")}catch(l){k.error("保存个人资料失败: "+((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.detail)||l.message))}finally{E.value=!1}},oe=()=>{te()},re=async()=>{var e,a;try{const{valid:e}=await Q.value.validate();if(!e)return;G.value=!0,await V.post("/users/me/change-password",{current_password:W.currentPassword,new_password:W.newPassword}),k.success("密码修改成功"),ne()}catch(l){k.error("修改密码失败: "+((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.detail)||l.message))}finally{G.value=!1}},ne=()=>{var e;J.value=!1,W.currentPassword="",W.newPassword="",W.confirmPassword="",null==(e=Q.value)||e.resetValidation()},ie=()=>{Z.global.name.value=Z.global.current.value.dark?"light":"dark";try{localStorage.setItem("theme",Z.global.name.value),k.success(`已切换到${"dark"===Z.global.name.value?"深色":"浅色"}主题`)}catch(e){}},ue=()=>{B.logout(),X.push("/login"),k.info("已退出登录")};return(e,a)=>(A(),I(x,{title:"个人资料",subtitle:"管理您的个人信息和账户设置",icon:"mdi-account-circle",color:"primary"},{default:z((()=>[D(l,null,{default:z((()=>[D(t,{cols:"12",md:"4"},{default:z((()=>[D(s,{class:"profile-info-card",elevation:"2"},{default:z((()=>[D(d,{class:"text-center pa-6"},{default:z((()=>[D(o,{size:"120",color:"primary",class:"mb-4"},{default:z((()=>[F("span",H,N(ae.value),1)])),_:1}),F("h3",K,N(R(B).user||"未知用户"),1),F("p",M,N(le(R(B).department))+" 部门 ",1),F("p",S," 用户ID: "+N(R(B).userId||"N/A"),1),D(r,{color:"success",variant:"flat",size:"small","prepend-icon":"mdi-check-circle"},{default:z((()=>a[10]||(a[10]=[$(" 活跃用户 ")]))),_:1,__:[10]})])),_:1})])),_:1}),D(s,{class:"mt-4",elevation:"2"},{default:z((()=>[D(n,{class:"text-h6"},{default:z((()=>a[11]||(a[11]=[$(" 快捷操作 ")]))),_:1,__:[11]}),D(i,{density:"compact"},{default:z((()=>[D(u,{"prepend-icon":"mdi-lock-reset",title:"修改密码",onClick:a[0]||(a[0]=e=>J.value=!0)}),D(u,{"prepend-icon":"mdi-theme-light-dark",title:"切换主题",onClick:ie}),D(u,{"prepend-icon":"mdi-logout",title:"退出登录",onClick:ue})])),_:1})])),_:1})])),_:1}),D(t,{cols:"12",md:"8"},{default:z((()=>[D(s,{elevation:"2"},{default:z((()=>[D(n,{class:"text-h6 d-flex align-center"},{default:z((()=>[D(c,{class:"mr-2"},{default:z((()=>a[12]||(a[12]=[$(" mdi-account-edit ")]))),_:1,__:[12]}),a[13]||(a[13]=$(" 编辑个人信息 "))])),_:1,__:[13]}),D(m),D(d,{class:"pa-6"},{default:z((()=>[D(P,{ref_key:"profileFormRef",ref:O,"show-default-actions":!1,loading:E.value},{default:z((()=>[D(l,null,{default:z((()=>[D(t,{cols:"12",md:"6"},{default:z((()=>[D(p,{modelValue:T.name,"onUpdate:modelValue":a[1]||(a[1]=e=>T.name=e),label:"用户名",placeholder:"请输入用户名",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-account",rules:[Y.required]},null,8,["modelValue","rules"])])),_:1}),D(t,{cols:"12",md:"6"},{default:z((()=>[D(p,{modelValue:T.email,"onUpdate:modelValue":a[2]||(a[2]=e=>T.email=e),label:"邮箱地址",placeholder:"请输入邮箱地址",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-email",rules:[Y.email]},null,8,["modelValue","rules"])])),_:1}),D(t,{cols:"12",md:"6"},{default:z((()=>[D(p,{modelValue:T.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>T.phone=e),label:"联系电话",placeholder:"请输入联系电话",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-phone"},null,8,["modelValue"])])),_:1}),D(t,{cols:"12",md:"6"},{default:z((()=>[D(f,{modelValue:T.department_id,"onUpdate:modelValue":a[4]||(a[4]=e=>T.department_id=e),items:L.value,"item-title":"name","item-value":"id",label:"部门",placeholder:"请选择部门",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-office-building",readonly:""},null,8,["modelValue","items"])])),_:1}),D(t,{cols:"12"},{default:z((()=>[D(_,{modelValue:T.description,"onUpdate:modelValue":a[5]||(a[5]=e=>T.description=e),label:"个人简介",placeholder:"请输入个人简介",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-text",rows:"3"},null,8,["modelValue"])])),_:1})])),_:1}),D(l,{class:"mt-4"},{default:z((()=>[D(t,{cols:"12",class:"d-flex justify-end"},{default:z((()=>[D(v,{variant:"outlined",color:"grey",class:"mr-3",disabled:E.value,onClick:oe},{default:z((()=>a[14]||(a[14]=[$(" 重置 ")]))),_:1,__:[14]},8,["disabled"]),D(v,{color:"primary",loading:E.value,onClick:de},{default:z((()=>a[15]||(a[15]=[$(" 保存更改 ")]))),_:1,__:[15]},8,["loading"])])),_:1})])),_:1})])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1})])),_:1}),D(h,{modelValue:J.value,"onUpdate:modelValue":a[9]||(a[9]=e=>J.value=e),"max-width":"500px"},{default:z((()=>[D(s,null,{default:z((()=>[D(n,{class:"text-h6 bg-primary text-white"},{default:z((()=>a[16]||(a[16]=[$(" 修改密码 ")]))),_:1,__:[16]}),D(d,{class:"pt-4"},{default:z((()=>[D(P,{ref_key:"passwordFormRef",ref:Q,"show-default-actions":!1},{default:z((()=>[D(p,{modelValue:W.currentPassword,"onUpdate:modelValue":a[6]||(a[6]=e=>W.currentPassword=e),label:"当前密码",placeholder:"请输入当前密码",type:"password",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-lock",rules:[Y.required]},null,8,["modelValue","rules"]),D(p,{modelValue:W.newPassword,"onUpdate:modelValue":a[7]||(a[7]=e=>W.newPassword=e),label:"新密码",placeholder:"请输入新密码",type:"password",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-lock-plus",rules:[Y.required,Y.password]},null,8,["modelValue","rules"]),D(p,{modelValue:W.confirmPassword,"onUpdate:modelValue":a[8]||(a[8]=e=>W.confirmPassword=e),label:"确认新密码",placeholder:"请再次输入新密码",type:"password",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-lock-check",rules:[Y.required,ee]},null,8,["modelValue","rules"])])),_:1},512)])),_:1}),D(w,{class:"pa-4"},{default:z((()=>[D(y),D(v,{variant:"outlined",disabled:G.value,onClick:ne},{default:z((()=>a[17]||(a[17]=[$(" 取消 ")]))),_:1,__:[17]},8,["disabled"]),D(v,{color:"primary",loading:G.value,onClick:re},{default:z((()=>a[18]||(a[18]=[$(" 确认修改 ")]))),_:1,__:[18]},8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}))}},[["__scopeId","data-v-84c83200"]]);export{X as default};
