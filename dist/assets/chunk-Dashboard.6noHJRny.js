import{b as e,u as t,_ as a,c as l,U as i,M as s,d as r,e as n}from"./entry-index.D92NaooR.js";import{d as o,w as c,q as d,r as u,$ as m,a0 as f,f as v,C as p,a1 as _,k as h,e as y,j as g,v as x,g as w,a2 as b,l as k,V as D,a3 as A,a4 as E,a5 as I,a6 as z,a7 as S,a8 as U,h as $,z as L,A as N,a9 as C}from"./chunk-vue-core.CxEQweee.js";import{f as B,i as H,a as M,d as T}from"./chunk-date-vendor.DjLOnOdQ.js";import{r as V,d as j,N as q,L as R,w as O,ae as P,ac as F,ad as G,H as J,af as Q,ab as W,F as Y,ag as K,a4 as X,X as Z,K as ee,a7 as te,I as ae,a1 as le,u as ie}from"./chunk-vendors.D0_dqILu.js";import"./chunk-utils-vendor.DVew6AbD.js";import"./chunk-chart-core.HkgdsJMe.js";const se=o("activity",{state:()=>({activities:[],isLoading:!1,lastUpdated:null}),getters:{recentActivities:e=>(t=5)=>e.activities.slice(0,t),activitiesByDepartment:e=>t=>e.activities.filter((e=>e.department===t)),activitiesByUser:e=>t=>e.activities.filter((e=>e.userId===t)),activitiesByType:e=>t=>e.activities.filter((e=>e.type===t))},actions:{async fetchActivities(){this.isLoading=!0;try{const t={limit:50},a=await e.get("/activities/",t);let l=[];if(a&&a.data)if(a.data.items&&Array.isArray(a.data.items))l=a.data.items;else{if(!Array.isArray(a.data))return[];l=a.data}else if(a&&a.items&&Array.isArray(a.items))l=a.items;else{if(!Array.isArray(a))return[];l=a}return this.activities=l.map((e=>({...e,time:e.time||this.formatTime(e.timestamp||e.created_at)}))).filter((e=>e&&e.id)),this.lastUpdated=new Date,this.activities}catch(t){return[]}finally{this.isLoading=!1}},async recordDataChange({module:t,type:a,title:l,description:i,before:s,after:r,details:n={}}){try{const o=await e.post("/activities/data-change/",{module:t,type:a,title:l,description:i,before:s,after:r,details:n});return o&&o.id?(this.activities.unshift(o),this.lastUpdated=new Date,o):null}catch(o){return null}},async addActivity(t){try{const a=await e.post("/activities/",t);return a&&a.id?(this.activities.unshift(a),this.lastUpdated=new Date,a):null}catch(a){return null}},formatTime(e){if(!e)return"";"string"==typeof e&&(e=new Date(e));const t=new Date,a=Math.floor((t-e)/6e4);if(a<1)return"刚刚";if(a<60)return`${a} 分钟前`;const l=Math.floor(a/60);if(l<24)return`${l} 小时前`;const i=Math.floor(l/24);return i<7?1===i?"昨天":`${i} 天前`:B(e,"yyyy-MM-dd")}},persist:{key:"activity-store",storage:localStorage,paths:["activities","lastUpdated"]}}),re=o("event",{state:()=>({events:[],upcomingEvents:[],isLoading:!1,lastUpdated:null}),getters:{allEvents:e=>e.events,getUpcomingEvents:e=>(t=5)=>e.upcomingEvents.slice(0,t),eventsByType:e=>t=>e.events.filter((e=>e.type===t)),eventsByDateRange:e=>(t,a)=>e.events.filter((e=>{const l=new Date(e.start_date);return l>=new Date(t)&&l<=new Date(a)}))},actions:{async fetchEvents(){this.isLoading=!0;try{const a=t(),l=await e.get("/events/",{headers:{Authorization:`Bearer ${a.token}`}});return l.data&&Array.isArray(l.data)?(this.events=l.data,this.lastUpdated=new Date,this.events):[]}catch(a){return[]}finally{this.isLoading=!1}},async fetchUpcomingEvents(a=10){this.isLoading=!0;try{const l=t(),i=await e.get("/events/",{params:{limit:a,upcoming:!0},headers:{Authorization:`Bearer ${l.token}`}});return i.data&&Array.isArray(i.data)?(this.upcomingEvents=i.data.map((e=>{if(!e||!e.name||!e.start_time)return null;const t={...e,title:e.name,start_date:e.start_time,type:e.department||"其他"};return this.processEventData(t)})).filter((e=>null!==e)),this.lastUpdated=new Date,this.upcomingEvents):[]}catch(l){throw l}finally{this.isLoading=!1}},async fetchEvent(a){this.isLoading=!0;try{const l=t(),i=await e.get(`/events/${a}/`,{headers:{Authorization:`Bearer ${l.token}`}});return i.data&&i.data.id?this.processEventData(i.data):null}catch(l){return null}finally{this.isLoading=!1}},async createEvent(a){try{const l=t(),i=await e.post("/events/",a,{headers:{Authorization:`Bearer ${l.token}`}});if(i.data&&i.data.id){const e=this.processEventData(i.data);return this.events.unshift(e),this.isUpcoming(i.data)&&this.upcomingEvents.unshift(e),this.lastUpdated=new Date,e}return null}catch(l){throw l}},async updateEvent(a,l){try{const i=t(),s=await e.put(`/events/${a}/`,l,{headers:{Authorization:`Bearer ${i.token}`}});if(s.data&&s.data.id){const e=this.processEventData(s.data),t=this.events.findIndex((e=>e.id===a));-1!==t&&(this.events[t]=e);const l=this.upcomingEvents.findIndex((e=>e.id===a));return-1!==l?this.isUpcoming(s.data)?this.upcomingEvents[l]=e:this.upcomingEvents.splice(l,1):this.isUpcoming(s.data)&&this.upcomingEvents.push(e),this.lastUpdated=new Date,e}return null}catch(i){throw i}},async deleteEvent(a){try{const l=t();await e.delete(`/events/${a}/`,{headers:{Authorization:`Bearer ${l.token}`}});const i=this.events.findIndex((e=>e.id===a));-1!==i&&this.events.splice(i,1);const s=this.upcomingEvents.findIndex((e=>e.id===a));return-1!==s&&this.upcomingEvents.splice(s,1),this.lastUpdated=new Date,!0}catch(l){throw l}},processEventData(e){e.start_date||(e.start_date=e.created_at);const t=new Date(e.start_date),a=new Date;let l,i,s;if(a.setHours(0,0,0,0),M(t))l="今日",i="error",s=0;else if(H(t,a))l="已开始",i="grey",s=0;else{const e=T(t,a);s=e,e<=3?(l=`${e}天后`,i="error"):e<=7?(l=`${e}天后`,i="warning"):(l=`${e}天后`,i="info")}return{...e,status:l,statusColor:i,daysRemaining:s}},isUpcoming(e){const t=new Date(e.start_date),a=new Date;return a.setHours(0,0,0,0),!(H(t,a)&&!M(t))}},persist:{key:"event-store",storage:localStorage,paths:["events","upcomingEvents","lastUpdated"]}}),ne={class:"d-flex align-center"},oe={class:"d-flex align-center"},ce={class:"text-center"},de={class:"text-subtitle-1"},ue={class:"text-center"},me=a({__name:"DashboardUpcomingEvents",props:{limit:{type:Number,default:5}},setup(e){const t=e,a=re(),r=V(!1),n=V(null),o=async()=>{r.value=!0,n.value=null;try{await a.fetchUpcomingEvents(2*t.limit),n.value=null}catch(e){e.value="获取事件数据失败，请稍后重试",s.error("获取事件数据失败")}finally{r.value=!1}},y=j((()=>a.upcomingEvents.filter((e=>e&&(e.title||e.name)&&(e.start_date||e.start_time)&&"Invalid Date"!==new Date(e.start_date||e.start_time).toString())))),g=e=>{try{const t=new Date(e);return isNaN(t.getTime())?"日期未知":B(t,"yyyy-MM-dd")}catch(t){return"日期错误"}},x=e=>{if(!e)return"全天";try{if("string"==typeof e){if(e.length<=5)return e;if(e.includes("T")){const t=e.split("T")[1];if(t){return t.substring(0,5)}}}return"全天"}catch(t){return"全天"}},w=e=>{try{const t=new Date(e.start_date||e.start_time);if(isNaN(t.getTime()))return null;const a=new Date;if(a.setHours(0,0,0,0),t.toDateString()===a.toDateString())return 0;if(t<a)return-1;const l=t.getTime()-a.getTime();return Math.ceil(l/864e5)}catch(t){return null}},b=e=>{const t=w(e);return null===t?"":0===t?"今天":-1===t?"已开始":`${t}天后`},k=e=>{const t=w(e);return null===t?"grey":0===t?"error":-1===t?"grey":t<=3?"error":t<=7?"warning":"info"},D=e=>{if(!e)return"primary";return{"会议":"primary","培训":"info","审核":"warning","拜访":"success","其他":"grey",QA:"purple",ASSY:"blue",EHS:"red",ADMIN:"indigo"}[e]||"primary"},A=e=>{if(!e)return"mdi-calendar";return{"会议":"mdi-account-group","培训":"mdi-school","审核":"mdi-clipboard-check","拜访":"mdi-handshake","其他":"mdi-calendar",QA:"mdi-checkbox-marked-circle",ASSY:"mdi-hammer-wrench",EHS:"mdi-shield-check",ADMIN:"mdi-shield-account"}[e]||"mdi-calendar"};let E=null;const I=()=>{E&&(clearInterval(E),E=null)},z=async()=>{await o(),s.success("事件数据已更新")};return q((async()=>{await o(),I(),E=setInterval(o,3e5)})),R((()=>{I()})),O((()=>t.limit),(async e=>{a.upcomingEvents.length<e&&await o()})),(t,a)=>{const s=l,o=i;return F(),P(o,{title:"即将开始的重要事件",icon:"mdi-calendar-clock",headers:[],items:[],"hide-default-footer":"",loading:r.value,"no-padding":""},{actions:G((()=>[J(h,{icon:"mdi-refresh",variant:"text",size:"small",color:"primary",disabled:r.value,loading:r.value,class:"mr-2",onClick:z},null,8,["disabled","loading"]),J(h,{variant:"text",size:"small",to:"/events",color:"primary"},{default:G((()=>[a[1]||(a[1]=X(" 查看全部 ")),J(v,{end:""},{default:G((()=>a[0]||(a[0]=[X(" mdi-chevron-right ")]))),_:1,__:[0]})])),_:1,__:[1]})])),"pre-table":G((()=>[J(s,{loading:r.value},null,8,["loading"]),y.value.length>0?(F(),P(c,{key:0,class:"py-0"},{default:G((()=>[(F(!0),W(Y,null,K(y.value.slice(0,e.limit),(e=>(F(),P(d,{key:e.id,to:`/events/${e.id}`,link:"",class:"event-item"},{prepend:G((()=>[J(p,{color:D(e.type||e.department)+"-lighten-4",size:"42",class:"me-3"},{default:G((()=>[J(v,{icon:A(e.type||e.department),color:D(e.type||e.department)},null,8,["icon","color"])])),_:2},1032,["color"])])),default:G((()=>[J(u,{class:"font-weight-medium d-flex align-center"},{default:G((()=>[X(Z(e.title||e.name)+" ",1),null!==w(e)?(F(),P(m,{key:0,size:"x-small",color:k(e),class:"ml-2",variant:"elevated"},{default:G((()=>[X(Z(b(e)),1)])),_:2},1032,["color"])):Q("",!0)])),_:2},1024),J(f,{class:"d-flex align-center flex-wrap"},{default:G((()=>[ee("span",ne,[J(v,{size:"x-small",color:"grey",class:"mr-1"},{default:G((()=>a[2]||(a[2]=[X("mdi-calendar")]))),_:1,__:[2]}),X(" "+Z(g(e.start_date||e.start_time)),1)]),a[4]||(a[4]=ee("span",{class:"mx-1"},"•",-1)),ee("span",oe,[J(v,{size:"x-small",color:"grey",class:"mr-1"},{default:G((()=>a[3]||(a[3]=[X("mdi-clock-outline")]))),_:1,__:[3]}),X(" "+Z(x(e.start_time)),1)]),J(m,{size:"x-small",color:D(e.type||e.department),class:"ml-2",variant:"tonal"},{default:G((()=>[X(Z(e.type||e.department||"其他"),1)])),_:2},1032,["color"])])),_:2,__:[4]},1024),e.location?(F(),P(f,{key:0,class:"d-flex align-center text-caption"},{default:G((()=>[J(v,{size:"x-small",color:"grey",class:"mr-1"},{default:G((()=>a[5]||(a[5]=[X(" mdi-map-marker ")]))),_:1,__:[5]}),X(" "+Z(e.location),1)])),_:2},1024)):Q("",!0)])),_:2},1032,["to"])))),128))])),_:1})):n.value?(F(),P(_,{key:1,type:"error",variant:"tonal",class:"ma-4",border:"start"},{default:G((()=>[ee("div",ce,[J(v,{size:"large",color:"error",class:"mb-2"},{default:G((()=>a[6]||(a[6]=[X(" mdi-alert-circle ")]))),_:1,__:[6]}),ee("div",de,Z(n.value),1),J(h,{color:"error",variant:"text",class:"mt-2",onClick:z},{default:G((()=>[J(v,{start:""},{default:G((()=>a[7]||(a[7]=[X(" mdi-refresh ")]))),_:1,__:[7]}),a[8]||(a[8]=X(" 重试 "))])),_:1,__:[8]})])])),_:1})):r.value?Q("",!0):(F(),P(_,{key:2,type:"info",variant:"tonal",class:"ma-4",border:"start"},{default:G((()=>[ee("div",ue,[J(v,{size:"large",color:"info",class:"mb-2"},{default:G((()=>a[9]||(a[9]=[X(" mdi-calendar-blank ")]))),_:1,__:[9]}),a[12]||(a[12]=ee("div",{class:"text-subtitle-1"}," 暂无即将开始的事件 ",-1)),a[13]||(a[13]=ee("div",{class:"text-body-2 mt-1"}," 您可以前往事件页面创建新的事件 ",-1)),J(h,{color:"primary",variant:"text",class:"mt-2",to:"/events"},{default:G((()=>[J(v,{start:""},{default:G((()=>a[10]||(a[10]=[X(" mdi-calendar-plus ")]))),_:1,__:[10]}),a[11]||(a[11]=X(" 管理事件 "))])),_:1,__:[11]})])])),_:1}))])),_:1},8,["loading"])}}},[["__scopeId","data-v-682e6332"]]),fe={class:"text-caption d-flex align-center"},ve={class:"text-caption"},pe={class:"text-center"},_e={class:"text-subtitle-1"},he={class:"text-center"},ye={class:"text-h5 mb-3 d-flex align-center activity-detail-title"},ge={key:0,class:"mt-4"},xe={class:"text-caption changes-content"},we={class:"text-caption changes-content"},be={class:"d-flex flex-column flex-sm-row"},ke={class:"flex-grow-1 mr-0 mr-sm-2 mb-2 mb-sm-0"},De={class:"text-caption changes-content"},Ae={class:"flex-grow-1"},Ee={class:"text-caption changes-content"},Ie=a({__name:"RecentActivities",props:{title:{type:String,default:"最近活动"},titleIcon:{type:String,default:"mdi-history"},titleIconColor:{type:String,default:"primary"},limit:{type:Number,default:5},department:{type:String,default:null},userId:{type:Number,default:null},type:{type:String,default:null},autoRefresh:{type:Boolean,default:!1},refreshInterval:{type:Number,default:6e4}},setup(e){const t=e,a=se(),i=V(!1),s=V(null),r=V("after");let n=null;const o=V(null),L=j((()=>{let e=a.activities;return t.department&&(e=a.activitiesByDepartment(t.department)),t.userId&&(e=a.activitiesByUser(t.userId)),t.type&&(e=a.activitiesByType(t.type)),e.filter((e=>e&&e.id&&(e.title||e.action)&&e.user))})),N=j((()=>a.isLoading)),C=e=>{if(!e)return"未知时间";try{const t=new Date(e);return isNaN(t.getTime())?"无效日期":B(t,"yyyy-MM-dd HH:mm:ss")}catch(t){return"日期格式错误"}},H=async()=>{N.value=!0,o.value=null;try{await a.fetchActivities(),a.activities.length}catch(e){o.value="获取数据失败，请稍后重试"}finally{N.value=!1}},M=e=>{if(!e)return{before:"无变更记录",after:"无变更记录"};try{let a=e.before,l=e.after;if("string"==typeof a)try{a=JSON.parse(a)}catch(t){}if("string"==typeof l)try{l=JSON.parse(l)}catch(t){}const i=a?JSON.stringify(a,null,2):"无数据";return{before:i,after:l?JSON.stringify(l,null,2):"无数据"}}catch(t){return{before:"数据格式错误",after:"数据格式错误"}}},T=()=>{n&&(clearInterval(n),n=null)};return q((async()=>{o.value=null;try{0===a.activities.length&&await H(),t.autoRefresh&&t.refreshInterval>0&&(T(),n=setInterval(H,t.refreshInterval))}catch(e){o.value="加载活动数据失败，请稍后重试"}})),te((()=>{T()})),(t,a)=>{const n=l;return F(),P(D,{height:"100%",class:"activities-card d-flex flex-column"},{default:G((()=>[J(y,{class:"d-flex align-center flex-shrink-0"},{default:G((()=>[J(v,{class:"mr-2",color:e.titleIconColor},{default:G((()=>[X(Z(e.titleIcon),1)])),_:1},8,["color"]),X(" "+Z(e.title)+" ",1),J(g),J(h,{icon:"mdi-refresh",variant:"text",size:"small",disabled:N.value,loading:N.value,class:"refresh-btn",onClick:H},null,8,["disabled","loading"])])),_:1}),J(x,{class:"flex-shrink-0"}),J(n,{loading:N.value},null,8,["loading"]),J(w,{class:"activities-container flex-grow-1 pa-0"},{default:G((()=>[L.value.slice(0,e.limit).length>0?(F(),P(c,{key:0,class:"py-0"},{default:G((()=>[(F(!0),W(Y,null,K(L.value.slice(0,e.limit),(e=>(F(),P(d,{key:e.id,link:"",class:"activity-item mb-2",onClick:t=>(e=>{s.value=e,i.value=!0})(e)},{prepend:G((()=>[J(p,{color:`${e.color||"grey"}-lighten-4`,size:"40",class:"me-3"},{default:G((()=>[J(v,{icon:e.icon||"mdi-history",color:e.color||"grey"},null,8,["icon","color"])])),_:2},1032,["color"])])),default:G((()=>[J(u,{class:"font-weight-medium activity-title"},{default:G((()=>[X(Z(e.title||e.action),1)])),_:2},1024),J(f,{class:"activity-subtitle"},{default:G((()=>[ee("span",fe,[J(v,{size:"x-small",color:"grey",class:"mr-1"},{default:G((()=>a[5]||(a[5]=[X("mdi-account")]))),_:1,__:[5]}),X(" "+Z(e.user),1)]),a[6]||(a[6]=ee("span",{class:"mx-1 d-none d-sm-inline"},"•",-1)),ee("span",ve,Z(e.action||e.details),1)])),_:2,__:[6]},1024),J(f,{class:"text-caption text-grey d-flex align-center"},{default:G((()=>[J(v,{size:"x-small",color:"grey",class:"mr-1"},{default:G((()=>a[7]||(a[7]=[X(" mdi-clock-outline ")]))),_:1,__:[7]}),X(" "+Z(e.time)+" ",1),J(b,{location:"bottom"},{activator:G((({props:e})=>[J(v,ae({size:"x-small",color:"grey",class:"ml-2"},{ref_for:!0},e),{default:G((()=>a[8]||(a[8]=[X(" mdi-calendar ")]))),_:2,__:[8]},1040)])),default:G((()=>[ee("span",null,Z(C(e.timestamp)),1)])),_:2},1024),e.details?(F(),P(b,{key:0,location:"bottom"},{activator:G((({props:e})=>[J(v,ae({size:"x-small",color:"grey",class:"ml-2"},{ref_for:!0},e),{default:G((()=>a[9]||(a[9]=[X(" mdi-information-outline ")]))),_:2,__:[9]},1040)])),default:G((()=>[ee("span",null,Z(e.details),1)])),_:2},1024)):Q("",!0)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):o.value?(F(),P(_,{key:1,type:"error",variant:"tonal",class:"ma-4",border:"start"},{default:G((()=>[ee("div",pe,[J(v,{size:"large",color:"error",class:"mb-2"},{default:G((()=>a[10]||(a[10]=[X(" mdi-alert-circle ")]))),_:1,__:[10]}),ee("div",_e,Z(o.value),1),J(h,{color:"error",variant:"text",class:"mt-2",onClick:H},{default:G((()=>[J(v,{start:""},{default:G((()=>a[11]||(a[11]=[X(" mdi-refresh ")]))),_:1,__:[11]}),a[12]||(a[12]=X(" 重试 "))])),_:1,__:[12]})])])),_:1})):N.value?Q("",!0):(F(),P(_,{key:2,type:"info",variant:"tonal",class:"ma-4",border:"start"},{default:G((()=>[ee("div",he,[J(v,{size:"large",color:"info",class:"mb-2"},{default:G((()=>a[13]||(a[13]=[X(" mdi-information ")]))),_:1,__:[13]}),a[14]||(a[14]=ee("div",{class:"text-subtitle-1"}," 暂无活动记录 ",-1))])])),_:1}))])),_:1}),J(k,{modelValue:i.value,"onUpdate:modelValue":a[4]||(a[4]=e=>i.value=e),"max-width":"600"},{default:G((()=>[s.value?(F(),P(D,{key:0,class:"activity-details-card"},{default:G((()=>[J(A,{color:s.value.color||"primary",dark:"",flat:""},{default:G((()=>[J(E,null,{default:G((()=>a[15]||(a[15]=[X("活动详情")]))),_:1,__:[15]}),J(g),J(h,{icon:"mdi-close",variant:"text",onClick:a[0]||(a[0]=e=>i.value=!1)})])),_:1},8,["color"]),J(w,{class:"pt-4"},{default:G((()=>[ee("h2",ye,[J(v,{color:s.value.color||"primary",class:"mr-2"},{default:G((()=>[X(Z(s.value.icon||"mdi-history"),1)])),_:1},8,["color"]),X(" "+Z(s.value.title||s.value.action),1)]),J(c,{density:"compact"},{default:G((()=>[J(d,null,{prepend:G((()=>[J(v,{color:"primary"},{default:G((()=>a[16]||(a[16]=[X(" mdi-account ")]))),_:1,__:[16]})])),default:G((()=>[J(u,null,{default:G((()=>a[17]||(a[17]=[X("操作人员")]))),_:1,__:[17]}),J(f,null,{default:G((()=>[X(Z(s.value.user),1)])),_:1})])),_:1}),J(d,null,{prepend:G((()=>[J(v,{color:"primary"},{default:G((()=>a[18]||(a[18]=[X(" mdi-office-building ")]))),_:1,__:[18]})])),default:G((()=>[J(u,null,{default:G((()=>a[19]||(a[19]=[X("所属部门")]))),_:1,__:[19]}),J(f,null,{default:G((()=>[X(Z(s.value.department),1)])),_:1})])),_:1}),J(d,null,{prepend:G((()=>[J(v,{color:"primary"},{default:G((()=>a[20]||(a[20]=[X(" mdi-clock-outline ")]))),_:1,__:[20]})])),default:G((()=>[J(u,null,{default:G((()=>a[21]||(a[21]=[X("操作时间")]))),_:1,__:[21]}),J(f,null,{default:G((()=>[X(Z(C(s.value.timestamp)),1)])),_:1})])),_:1}),J(d,null,{prepend:G((()=>[J(v,{color:"primary"},{default:G((()=>a[22]||(a[22]=[X(" mdi-tag ")]))),_:1,__:[22]})])),default:G((()=>[J(u,null,{default:G((()=>a[23]||(a[23]=[X("操作类型")]))),_:1,__:[23]}),J(f,null,{default:G((()=>[J(m,{color:s.value.color||"primary",size:"small"},{default:G((()=>[X(Z(s.value.type),1)])),_:1},8,["color"])])),_:1})])),_:1}),s.value.details?(F(),P(d,{key:0},{prepend:G((()=>[J(v,{color:"primary"},{default:G((()=>a[24]||(a[24]=[X(" mdi-text-box ")]))),_:1,__:[24]})])),default:G((()=>[J(u,null,{default:G((()=>a[25]||(a[25]=[X("操作描述")]))),_:1,__:[25]}),J(f,null,{default:G((()=>[X(Z(s.value.details),1)])),_:1})])),_:1})):Q("",!0),s.value.action&&s.value.title&&s.value.action!==s.value.title?(F(),P(d,{key:1},{prepend:G((()=>[J(v,{color:"primary"},{default:G((()=>a[26]||(a[26]=[X(" mdi-text-box-outline ")]))),_:1,__:[26]})])),default:G((()=>[J(u,null,{default:G((()=>a[27]||(a[27]=[X("操作动作")]))),_:1,__:[27]}),J(f,null,{default:G((()=>[X(Z(s.value.action),1)])),_:1})])),_:1})):Q("",!0)])),_:1}),J(x,{class:"my-3"}),s.value.changes?(F(),W("div",ge,[a[33]||(a[33]=ee("h3",{class:"text-subtitle-1 mb-2"}," 数据变更记录 ",-1)),J(I,{modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=e=>r.value=e),density:"comfortable",class:"changes-tabs"},{default:G((()=>[J(z,{value:"before"},{default:G((()=>a[28]||(a[28]=[X(" 变更前 ")]))),_:1,__:[28]}),J(z,{value:"after"},{default:G((()=>a[29]||(a[29]=[X(" 变更后 ")]))),_:1,__:[29]}),J(z,{value:"diff"},{default:G((()=>a[30]||(a[30]=[X(" 对比 ")]))),_:1,__:[30]})])),_:1},8,["modelValue"]),J(S,{modelValue:r.value,"onUpdate:modelValue":a[2]||(a[2]=e=>r.value=e),class:"mt-2"},{default:G((()=>[J(U,{value:"before"},{default:G((()=>[J(D,{variant:"outlined",class:"pa-2 changes-card"},{default:G((()=>[ee("pre",xe,Z(M(s.value.changes).before),1)])),_:1})])),_:1}),J(U,{value:"after"},{default:G((()=>[J(D,{variant:"outlined",class:"pa-2 changes-card"},{default:G((()=>[ee("pre",we,Z(M(s.value.changes).after),1)])),_:1})])),_:1}),J(U,{value:"diff"},{default:G((()=>[J(D,{variant:"outlined",class:"pa-2 changes-card"},{default:G((()=>[ee("div",be,[ee("div",ke,[a[31]||(a[31]=ee("div",{class:"text-caption text-center mb-1"}," 变更前 ",-1)),J(D,{variant:"tonal",color:"grey-lighten-3",class:"pa-2"},{default:G((()=>[ee("pre",De,Z(M(s.value.changes).before),1)])),_:1})]),ee("div",Ae,[a[32]||(a[32]=ee("div",{class:"text-caption text-center mb-1"}," 变更后 ",-1)),J(D,{variant:"tonal",color:"primary-lighten-5",class:"pa-2"},{default:G((()=>[ee("pre",Ee,Z(M(s.value.changes).after),1)])),_:1})])])])),_:1})])),_:1})])),_:1},8,["modelValue"])])):Q("",!0)])),_:1}),J($,null,{default:G((()=>[J(g),J(h,{color:"grey-darken-1",variant:"text",onClick:a[3]||(a[3]=e=>i.value=!1)},{default:G((()=>a[34]||(a[34]=[X(" 关闭 ")]))),_:1,__:[34]}),s.value.target?(F(),P(h,{key:0,color:"primary",variant:"tonal",to:s.value.target},{default:G((()=>[J(v,{class:"mr-1"},{default:G((()=>a[35]||(a[35]=[X(" mdi-arrow-right ")]))),_:1,__:[35]}),a[36]||(a[36]=X(" 前往相关页面 "))])),_:1,__:[36]},8,["to"])):Q("",!0)])),_:1})])),_:1})):Q("",!0)])),_:1},8,["modelValue"])])),_:1})}}},[["__scopeId","data-v-ff4561e9"]]),ze={class:"mb-4"},Se={class:"pa-4"},Ue=a({__name:"Dashboard",setup(a){t();const o=se(),c=(new Date).getMonth()+1,d=V(!1),u=V("month"),m=V([]),f=V(null),p=V({quality:!1,trend:!1}),y={standard:["swi","rwh","w01","hf","lc"],scrap:["scrapswi","scraprwh","scrapw01","scraphf","scraplc"]},x=async(t="month")=>{p.value.trend=!0;try{const a=await e.get("/dashboard/trend",{period:t});f.value=(null==a?void 0:a.data)||{legend:["生产","质量","EHS"],xAxis:["1月","2月","3月","4月","5月","6月","7月"],series:[{name:"生产",type:"line",data:[120,132,101,134,90,230,210]},{name:"质量",type:"line",data:[220,182,191,234,290,330,310]},{name:"EHS",type:"line",data:[15,12,11,14,9,23,21]}]}}catch(a){f.value={legend:["生产","质量","EHS"],xAxis:["1月","2月","3月","4月","5月","6月","7月"],series:[{name:"生产",type:"line",data:[120,132,101,134,90,230,210]},{name:"质量",type:"line",data:[220,182,191,234,290,330,310]},{name:"EHS",type:"line",data:[15,12,11,14,9,23,21]}]}}finally{p.value.trend=!1}},w=async()=>{p.value.quality=!0;const t=await(async(e,t,a=null)=>{try{const t=await e();return(null==t?void 0:t.data)||a}catch(l){return s.error(`${t}: ${l.message||"未知错误"}`),a}})((()=>e.get("/qa/",{params:{month:c.toString()}})),"获取质量数据失败");if(t){const e=new Date((new Date).getFullYear(),c,0).getDate(),a=Array.from({length:e},((e,t)=>({date:(t+1).toString(),...Object.fromEntries([...y.standard,...y.scrap].map((e=>[e,0]))),welding:0,stamping:0})));t.forEach((e=>{const t=a.find((t=>t.date===e.day));if(t){const a=e.line.toLowerCase();t[e.scrapflag?`scrap${a}`:a]=parseInt(e.value,10),t.welding=t.swi+t.rwh+t.w01,t.stamping=t.hf+t.lc}})),m.value=a}p.value.quality=!1},b=e=>j((()=>m.value.reduce(((t,a)=>t+(a[e]||0)),0))),k=b("welding"),D=b("stamping"),A=j((()=>k.value+D.value)),E=j((()=>m.value.reduce(((e,t)=>e+y.scrap.reduce(((e,a)=>e+(parseInt(t[a])||0)),0)),0))),I=j((()=>{if(0===A.value)return"0.00";return(E.value/(A.value+E.value)*100).toFixed(2)})),z=j((()=>{var e,t,a;return{tooltip:{trigger:"axis"},legend:{data:(null==(e=f.value)?void 0:e.legend)||["生产","质量","EHS"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:(null==(t=f.value)?void 0:t.xAxis)||[]},yAxis:{type:"value"},series:(null==(a=f.value)?void 0:a.series)||[]}})),S=[{title:"生产计划完成率",value:"94.5%",icon:"mdi-chart-line",color:"success",change:"+2.5%"},{title:"质量合格率",value:"99.2%",icon:"mdi-check-circle",color:"primary",change:"+0.3%"},{title:"设备稼动率",value:"87.8%",icon:"mdi-cog",color:"warning",change:"-1.2%"},{title:"安全无事故天数",value:"128",icon:"mdi-shield-check",color:"info",change:"+1"}],U=e=>{u.value=e,x(e)},$=async()=>{d.value=!0;try{await Promise.all([w(),x(u.value),o.fetchActivities()]),s.success("数据刷新成功")}catch(e){s.error("数据刷新失败: "+(e.message||"未知错误"))}finally{d.value=!1}};return q((async()=>{await Promise.all([w(),x("month"),o.fetchActivities()])})),(e,t)=>{const a=l,s=n,o=le("v-chart"),c=i,m=r;return F(),P(m,{title:"仪表盘",icon:"mdi-view-dashboard",color:"primary","show-breadcrumbs":!1,class:"dashboard-template"},{"header-actions":G((()=>[J(h,{"prepend-icon":"mdi-refresh",variant:"outlined",disabled:d.value,loading:d.value,class:"mr-2 refresh-btn",color:"primary",onClick:$},{default:G((()=>t[1]||(t[1]=[X(" 刷新数据 ")]))),_:1,__:[1]},8,["disabled","loading"]),J(h,{"prepend-icon":"mdi-calendar-today",color:"primary",variant:"elevated",class:"today-btn"},{default:G((()=>t[2]||(t[2]=[X(" 今日数据 ")]))),_:1,__:[2]})])),default:G((()=>[J(a,{loading:d.value,message:"加载数据中..."},null,8,["loading"]),J(L,{class:"fill-height"},{default:G((()=>[J(N,{cols:"12",md:"8",order:"4","order-md":"1",class:"d-flex flex-column"},{default:G((()=>[J(L,{class:"match-height"},{default:G((()=>[(F(),W(Y,null,K(S,(e=>J(N,{key:e.title,cols:"12",sm:"6",md:"4",lg:"3"},{default:G((()=>[J(s,{title:e.title,value:e.value,icon:e.icon,color:e.color,change:e.change,"show-change":"","show-progress":"",elevation:"1",class:"h-100"},null,8,["title","value","icon","color","change"])])),_:2},1024))),64))])),_:1}),J(L,{class:"mt-4"},{default:G((()=>[J(N,{cols:"12"},{default:G((()=>[J(c,{title:"数据趋势","hide-default-footer":"",icon:"mdi-chart-line","no-padding":""},{actions:G((()=>[J(C,{modelValue:u.value,"onUpdate:modelValue":[t[0]||(t[0]=e=>u.value=e),U],density:"comfortable",variant:"outlined",rounded:"lg",class:"pt-1"},{default:G((()=>[J(h,{value:"day"},{default:G((()=>t[3]||(t[3]=[X(" 日 ")]))),_:1,__:[3]}),J(h,{value:"week"},{default:G((()=>t[4]||(t[4]=[X(" 周 ")]))),_:1,__:[4]}),J(h,{value:"month",selected:""},{default:G((()=>t[5]||(t[5]=[X(" 月 ")]))),_:1,__:[5]}),J(h,{value:"year"},{default:G((()=>t[6]||(t[6]=[X(" 年 ")]))),_:1,__:[6]})])),_:1},8,["modelValue"])])),default:G((()=>[J(a,{loading:e.isLoadingTrendData},null,8,["loading"]),J(o,{class:"chart",option:z.value,autoresize:""},null,8,["option"])])),_:1})])),_:1})])),_:1}),J(L,{class:"mt-4"},{default:G((()=>[J(N,{cols:"12"},{default:G((()=>[J(c,{title:"质量数据总览",icon:"mdi-chart-areaspline","hide-default-footer":"","content-class":"data-overview"},{actions:G((()=>[J(g),J(h,{variant:"text",size:"small",to:"/quality",color:"primary"},{default:G((()=>[t[8]||(t[8]=X(" 查看详情 ")),J(v,{end:""},{default:G((()=>t[7]||(t[7]=[X(" mdi-chevron-right ")]))),_:1,__:[7]})])),_:1,__:[8]})])),default:G((()=>[J(a,{loading:e.isLoadingQualityData},null,8,["loading"]),J(L,{class:"quality-stats-row g-1"},{default:G((()=>[J(N,{cols:"12",sm:"6",md:"3"},{default:G((()=>[J(s,{title:"本月焊接GP12总数",value:ie(k),icon:"mdi-chart-line",color:"primary",subtitle:"SWI, RWH, W01"},null,8,["value"])])),_:1}),J(N,{cols:"12",sm:"6",md:"3"},{default:G((()=>[J(s,{title:"本月冲压GP12总数",value:ie(D),icon:"mdi-stamper",color:"secondary",subtitle:"HF, LC"},null,8,["value"])])),_:1}),J(N,{cols:"12",sm:"6",md:"3"},{default:G((()=>[J(s,{title:"报废率",value:I.value+"%",icon:"mdi-recycle",color:"error",subtitle:"本月累计"},null,8,["value"])])),_:1}),J(N,{cols:"12",sm:"6",md:"3"},{default:G((()=>[J(s,{title:"本月GP12总数",value:A.value,icon:"mdi-package-variant",color:"success",subtitle:"所有生产线"},null,8,["value"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),J(L,{class:"mt-4 flex-grow-1"},{default:G((()=>[J(N,{cols:"12",class:"d-flex"},{default:G((()=>[J(Ie,{title:"最近活动",limit:5,"auto-refresh":"","refresh-interval":12e4,class:"flex-grow-1"})])),_:1})])),_:1})])),_:1}),J(N,{cols:"12",md:"4",lg:"4",order:"1","order-md":"2",class:"d-flex flex-column"},{default:G((()=>[ee("div",ze,[J(me,{limit:5})]),J(c,{title:"系统公告",icon:"mdi-bullhorn",headers:[],items:[1,2],"hide-default-footer":"",loading:!1,"hide-no-data":""},{"pre-table":G((()=>[ee("div",Se,[J(_,{color:"info",icon:"mdi-information",title:"系统更新",text:"数据上报系统将不定时进行例行维护，维护时间为上午10点至中午12点。",variant:"tonal",class:"mb-4",border:"start",density:"comfortable"}),J(_,{color:"success",icon:"mdi-check-circle",title:"质量模块更新",text:"如果在使用过程中遇到任何bug或疑问，请联系管理员noah.yin@magna.com。",variant:"tonal",border:"start",density:"comfortable"})])])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-9836ca91"]]);export{Ue as default};
